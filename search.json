[{"title":"Dockerä»å…¥é—¨åˆ°å¹²æ´»ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³çŸ£","path":"/2023/12/24/Dockerä»å…¥é—¨åˆ°å¹²æ´»ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³çŸ£/","content":"1. å®¹å™¨ç®€ä»‹1.1. ä»€ä¹ˆæ˜¯ Linux å®¹å™¨Linuxå®¹å™¨æ˜¯ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€çš„ä¸€ç³»åˆ—è¿›ç¨‹ï¼Œä»å¦ä¸€ä¸ªé•œåƒè¿è¡Œï¼Œå¹¶ç”±è¯¥é•œåƒæä¾›æ”¯æŒè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ã€‚ å®¹å™¨æä¾›çš„é•œåƒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› è€Œåœ¨ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½å…·æœ‰å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚ æ›´åŠ è¯¦ç»†åœ°æ¥è¯´ï¼Œè¯·æ‚¨å‡å®šæ‚¨åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ã€‚æ‚¨ä½¿ç”¨çš„æ˜¯ä¸€å°ç¬”è®°æœ¬ç”µè„‘ï¼Œè€Œä¸”æ‚¨çš„å¼€å‘ç¯å¢ƒå…·æœ‰ç‰¹å®šçš„é…ç½®ã€‚å…¶ä»–å¼€å‘äººå‘˜èº«å¤„çš„ç¯å¢ƒé…ç½®å¯èƒ½ç¨æœ‰ä¸åŒã€‚æ‚¨æ­£åœ¨å¼€å‘çš„åº”ç”¨ä¾èµ–äºæ‚¨å½“å‰çš„é…ç½®ï¼Œè¿˜è¦ä¾èµ–äºæŸäº›ç‰¹å®šæ–‡ä»¶ã€‚ ä¸æ­¤åŒæ—¶ï¼Œæ‚¨çš„ä¼ä¸šè¿˜æ‹¥æœ‰æ ‡å‡†åŒ–çš„æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒï¼Œä¸”å…·æœ‰è‡ªèº«çš„é…ç½®å’Œä¸€ç³»åˆ—æ”¯æŒæ–‡ä»¶ã€‚ æ‚¨å¸Œæœ›å°½å¯èƒ½å¤šåœ¨æœ¬åœ°æ¨¡æ‹Ÿè¿™äº›ç¯å¢ƒï¼Œè€Œä¸äº§ç”Ÿé‡æ–°åˆ›å»ºæœåŠ¡å™¨ç¯å¢ƒçš„å¼€é”€ã€‚ å› æ­¤ï¼Œæ‚¨è¦å¦‚ä½•ç¡®ä¿åº”ç”¨èƒ½å¤Ÿåœ¨è¿™äº›ç¯å¢ƒä¸­è¿è¡Œå’Œé€šè¿‡è´¨é‡æ£€æµ‹ï¼Œå¹¶ä¸”åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­ä¸å‡ºç°ä»¤äººå¤´ç–¼çš„é—®é¢˜ï¼Œä¹Ÿæ— éœ€é‡æ–°ç¼–å†™ä»£ç å’Œè¿›è¡Œæ•…éšœä¿®å¤ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨å®¹å™¨ã€‚ å®¹å™¨å¯ä»¥ç¡®ä¿æ‚¨çš„åº”ç”¨æ‹¥æœ‰å¿…éœ€çš„é…ç½®å’Œæ–‡ä»¶ï¼Œä½¿å¾—è¿™äº›åº”ç”¨èƒ½å¤Ÿåœ¨ä»å¼€å‘åˆ°æµ‹è¯•ã€å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªæµç¨‹ä¸­é¡ºåˆ©è¿è¡Œï¼Œè€Œä¸å‡ºç°ä»»ä½•ä¸è‰¯é—®é¢˜ã€‚è¿™æ ·å¯ä»¥é¿å…å±æœºï¼Œåšåˆ°çš†å¤§æ¬¢å–œã€‚ è™½ç„¶è¿™åªæ˜¯ç®€åŒ–çš„ç¤ºä¾‹ï¼Œä½†åœ¨éœ€è¦å¾ˆé«˜çš„å¯ç§»æ¤æ€§ã€å¯é…ç½®æ€§å’Œéš”ç¦»çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Linux å®¹å™¨é€šè¿‡å¾ˆå¤šæ–¹å¼è§£å†³éš¾é¢˜ã€‚ æ— è®ºåŸºç¡€æ¶æ„æ˜¯åœ¨ä¼ä¸šå†…éƒ¨è¿˜æ˜¯åœ¨äº‘ç«¯ï¼Œæˆ–è€…æ··åˆä½¿ç”¨ä¸¤è€…ï¼Œå®¹å™¨éƒ½èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ 1.2. å®¹å™¨ä¸å°±æ˜¯è™šæ‹ŸåŒ–å—æ˜¯ï¼Œä½†ä¹Ÿä¸ç«Ÿç„¶ã€‚æˆ‘ä»¬ç”¨ä¸€ç§ç®€å•æ–¹å¼æ¥æ€è€ƒä¸€ä¸‹ï¼š è™šæ‹ŸåŒ–ä½¿å¾—è®¸å¤šæ“ä½œç³»ç»Ÿå¯åŒæ—¶åœ¨å•ä¸ªç³»ç»Ÿä¸Šè¿è¡Œã€‚ å®¹å™¨åˆ™å¯å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå°†åº”ç”¨è¿›ç¨‹ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€ã€‚ å›¾ - æ™®é€šè™šæ‹ŸåŒ–æŠ€æœ¯å’ŒDockerçš„å¯¹æ¯” è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿé¦–å…ˆï¼Œè®©å¤šä¸ªæ“ä½œç³»ç»Ÿåœ¨å•ä¸ªè™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¸Šè¿è¡Œä»¥å®ç°è™šæ‹ŸåŒ–ï¼Œå¹¶ä¸èƒ½è¾¾æˆå’Œä½¿ç”¨å®¹å™¨åŒç­‰çš„è½»é‡çº§æ•ˆæœã€‚ äº‹å®ä¸Šï¼Œåœ¨ä»…æ‹¥æœ‰å®¹é‡æœ‰é™çš„æœ‰é™èµ„æºæ—¶ï¼Œæ‚¨éœ€è¦èƒ½å¤Ÿå¯ä»¥è¿›è¡Œå¯†é›†éƒ¨ç½²çš„è½»é‡çº§åº”ç”¨ã€‚ Linux å®¹å™¨å¯ä»å•ä¸ªæ“ä½œç³»ç»Ÿè¿è¡Œï¼Œåœ¨æ‰€æœ‰å®¹å™¨ä¸­å…±äº«è¯¥æ“ä½œç³»ç»Ÿï¼Œå› æ­¤åº”ç”¨å’ŒæœåŠ¡èƒ½å¤Ÿä¿æŒè½»é‡çº§ï¼Œå¹¶è¡Œå¿«é€Ÿè¿è¡Œã€‚ 1.3. å®¹å™¨å‘å±•ç®€å² æˆ‘ä»¬ç°åœ¨ç§°ä¸ºå®¹å™¨æŠ€æœ¯çš„æ¦‚å¿µæœ€åˆå‡ºç°åœ¨ 2000 å¹´ï¼Œå½“æ—¶ç§°ä¸º FreeBSD jailï¼Œè¿™ç§æŠ€æœ¯å¯å°† FreeBSD ç³»ç»Ÿåˆ†åŒºä¸ºå¤šä¸ªå­ç³»ç»Ÿï¼ˆä¹Ÿç§°ä¸º Jailï¼‰ã€‚ Jail æ˜¯ä½œä¸ºå®‰å…¨ç¯å¢ƒè€Œå¼€å‘çš„ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä¸ä¼ä¸šå†…éƒ¨æˆ–å¤–éƒ¨çš„å¤šä¸ªç”¨æˆ·å…±äº«è¿™äº› Jailã€‚ Jail çš„ç›®çš„æ˜¯è®©è¿›ç¨‹åœ¨ç»è¿‡ä¿®æ”¹çš„ chroot ç¯å¢ƒä¸­åˆ›å»ºï¼Œè€Œä¸ä¼šè„±ç¦»å’Œå½±å“æ•´ä¸ªç³»ç»Ÿ â€” åœ¨ chroot ç¯å¢ƒä¸­ï¼Œå¯¹æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œç”¨æˆ·çš„è®¿é—®éƒ½å®ç°äº†è™šæ‹ŸåŒ–ã€‚ å°½ç®¡ Jail åœ¨å®æ–½æ–¹é¢å­˜åœ¨å±€é™æ€§ï¼Œä½†æœ€ç»ˆäººä»¬æ‰¾åˆ°äº†è„±ç¦»è¿™ç§éš”ç¦»ç¯å¢ƒçš„æ–¹æ³•ã€‚ ä½†è¿™ä¸ªæ¦‚å¿µéå¸¸æœ‰å¸å¼•åŠ›ã€‚ 2001 å¹´ï¼Œé€šè¿‡ Jacques GÃ©linas çš„ VServer é¡¹ç›®ï¼Œéš”ç¦»ç¯å¢ƒçš„å®æ–½è¿›å…¥äº† Linux é¢†åŸŸã€‚ æ­£å¦‚ GÃ©linas æ‰€è¯´ï¼Œè¿™é¡¹å·¥ä½œçš„ç›®çš„æ˜¯â€œåœ¨é«˜åº¦ç‹¬ç«‹ä¸”å®‰å…¨çš„å•ä¸€ç¯å¢ƒä¸­è¿è¡Œå¤šä¸ªé€šç”¨ Linux æœåŠ¡å™¨ [sic]ã€‚â€ åœ¨å®Œæˆäº†è¿™é¡¹é’ˆå¯¹ Linux ä¸­å¤šä¸ªå—æ§åˆ¶ç”¨æˆ·ç©ºé—´çš„åŸºç¡€æ€§å·¥ä½œåï¼ŒLinux å®¹å™¨å¼€å§‹é€æ¸æˆå½¢å¹¶æœ€ç»ˆå‘å±•æˆäº†ç°åœ¨çš„æ¨¡æ ·ã€‚ 2. ä»€ä¹ˆæ˜¯ Dockerï¼Ÿâ€œDockerâ€ ä¸€è¯æŒ‡ä»£å¤šç§äº‹ç‰©ï¼ŒåŒ…æ‹¬å¼€æºç¤¾åŒºé¡¹ç›®ã€å¼€æºé¡¹ç›®ä½¿ç”¨çš„å·¥å…·ã€ä¸»å¯¼æ”¯æŒæ­¤ç±»é¡¹ç›®çš„å…¬å¸ Docker Inc. ä»¥åŠè¯¥å…¬å¸å®˜æ–¹æ”¯æŒçš„å·¥å…·ã€‚æŠ€æœ¯äº§å“å’Œå…¬å¸ä½¿ç”¨åŒä¸€åç§°ï¼Œçš„ç¡®è®©äººæœ‰ç‚¹å›°æƒ‘ã€‚ ğŸ IT è½¯ä»¶ä¸­æ‰€è¯´çš„ â€œDockerâ€ ï¼Œæ˜¯æŒ‡å®¹å™¨åŒ–æŠ€æœ¯ï¼Œç”¨äºæ”¯æŒåˆ›å»ºå’Œä½¿ç”¨ Linux å®¹å™¨ã€‚ ğŸ å¼€æº Docker ç¤¾åŒºè‡´åŠ›äºæ”¹è¿›è¿™ç±»æŠ€æœ¯ï¼Œå¹¶å…è´¹æä¾›ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œä½¿ä¹‹è·ç›Šã€‚ ğŸ Docker Inc. å…¬å¸å‡­å€Ÿ Docker ç¤¾åŒºäº§å“èµ·å®¶ï¼Œå®ƒä¸»è¦è´Ÿè´£æå‡ç¤¾åŒºç‰ˆæœ¬çš„å®‰å…¨æ€§ï¼Œå¹¶å°†æ”¹è¿›åçš„ç‰ˆæœ¬ä¸æ›´å¹¿æ³›çš„æŠ€æœ¯ç¤¾åŒºåˆ†äº«ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ä¸“é—¨å¯¹è¿™äº›æŠ€æœ¯äº§å“è¿›è¡Œå®Œå–„å’Œå®‰å…¨å›ºåŒ–ï¼Œä»¥æœåŠ¡äºä¼ä¸šå®¢æˆ·ã€‚ å€ŸåŠ© Docker ï¼Œæ‚¨å¯å°†å®¹å™¨å½“åšé‡é‡è½»ã€æ¨¡å—åŒ–çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚åŒæ—¶ï¼Œæ‚¨è¿˜å°†è·å¾—é«˜åº¦çš„çµæ´»æ€§ï¼Œä»è€Œå®ç°å¯¹å®¹å™¨çš„é«˜æ•ˆåˆ›å»ºã€éƒ¨ç½²åŠå¤åˆ¶ï¼Œå¹¶èƒ½å°†å…¶ä»ä¸€ä¸ªç¯å¢ƒé¡ºåˆ©è¿ç§»è‡³å¦ä¸€ä¸ªç¯å¢ƒã€‚ 2.1. Docker å¦‚ä½•å·¥ä½œï¼ŸDocker æŠ€æœ¯ä½¿ç”¨ Linux å†…æ ¸å’Œå†…æ ¸åŠŸèƒ½ï¼ˆä¾‹å¦‚ Cgroups å’Œ namespacesï¼‰æ¥åˆ†éš”è¿›ç¨‹ï¼Œä»¥ä¾¿å„è¿›ç¨‹ç›¸äº’ç‹¬ç«‹è¿è¡Œã€‚ è¿™ç§ç‹¬ç«‹æ€§æ­£æ˜¯é‡‡ç”¨å®¹å™¨çš„ç›®çš„æ‰€åœ¨ï¼›å®ƒå¯ä»¥ç‹¬ç«‹è¿è¡Œå¤šç§è¿›ç¨‹ã€å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ›´åŠ å……åˆ†åœ°å‘æŒ¥åŸºç¡€è®¾æ–½çš„ä½œç”¨ï¼ŒåŒæ—¶ä¿æŒå„ä¸ªç‹¬ç«‹ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ å®¹å™¨å·¥å…·ï¼ˆåŒ…æ‹¬ Dockerï¼‰å¯æä¾›åŸºäºé•œåƒçš„éƒ¨ç½²æ¨¡å¼ã€‚è¿™ä½¿å¾—å®ƒèƒ½å¤Ÿè½»æ¾è·¨å¤šç§ç¯å¢ƒï¼Œä¸å…¶ä¾èµ–ç¨‹åºå…±äº«åº”ç”¨æˆ–æœåŠ¡ç»„ã€‚Docker è¿˜å¯åœ¨è¿™ä¸€å®¹å™¨ç¯å¢ƒä¸­è‡ªåŠ¨éƒ¨ç½²åº”ç”¨ç¨‹åºï¼ˆæˆ–è€…åˆå¹¶å¤šç§æµç¨‹ï¼Œä»¥æ„å»ºå•ä¸ªåº”ç”¨ç¨‹åºï¼‰ã€‚ æ­¤å¤–ï¼Œç”±äºè¿™äº›å·¥å…·åŸºäº Linux å®¹å™¨æ„å»ºï¼Œä½¿å¾— Docker æ—¢æ˜“äºä½¿ç”¨ï¼Œåˆåˆ«å…·ä¸€æ ¼ â€”â€” å®ƒå¯ä¸ºç”¨æˆ·æä¾›å‰æ‰€æœªæœ‰çš„é«˜åº¦åº”ç”¨ç¨‹è®¿é—®æƒé™ã€å¿«é€Ÿéƒ¨ç½²ä»¥åŠç‰ˆæœ¬æ§åˆ¶å’Œåˆ†å‘èƒ½åŠ›ã€‚ 2.2. Docker æŠ€æœ¯æ˜¯å¦ä¸ä¼ ç»Ÿçš„ Linux å®¹å™¨ç›¸åŒï¼Ÿå¦ã€‚Docker æŠ€æœ¯æœ€åˆæ˜¯åŸºäº LXC æŠ€æœ¯æ„å»ºï¼ˆå¤§å¤šæ•°äººéƒ½ä¼šå°†è¿™ä¸€æŠ€æœ¯ä¸â€œä¼ ç»Ÿçš„â€ Linux å®¹å™¨è”ç³»åœ¨ä¸€èµ·ï¼‰ï¼Œä½†åæ¥å®ƒé€æ¸æ‘†è„±äº†å¯¹è¿™ç§æŠ€æœ¯çš„ä¾èµ–ã€‚ å°±è½»é‡çº§ è™šæ‹ŸåŒ– è¿™ä¸€åŠŸèƒ½æ¥çœ‹ï¼ŒLXC éå¸¸æœ‰ç”¨ï¼Œä½†å®ƒæ— æ³•æä¾›å‡ºè‰²çš„å¼€å‘äººå‘˜æˆ–ç”¨æˆ·ä½“éªŒã€‚é™¤äº†è¿è¡Œå®¹å™¨ä¹‹å¤–ï¼ŒDocker æŠ€æœ¯è¿˜å…·å¤‡å…¶ä»–å¤šé¡¹åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç®€åŒ–ç”¨äºæ„å»ºå®¹å™¨ã€ä¼ è¾“é•œåƒä»¥åŠæ§åˆ¶é•œåƒç‰ˆæœ¬çš„æµç¨‹ã€‚ ä¼ ç»Ÿçš„ Linux å®¹å™¨ä½¿ç”¨ init ç³»ç»Ÿæ¥ç®¡ç†å¤šç§è¿›ç¨‹ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿è¡Œã€‚ä¸æ­¤ç›¸åï¼ŒDocker æŠ€æœ¯é¼“åŠ±åº”ç”¨ç¨‹åºå„è‡ªç‹¬ç«‹è¿è¡Œå…¶è¿›ç¨‹ï¼Œå¹¶æä¾›ç›¸åº”å·¥å…·ä»¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚è¿™ç§ç²¾ç»†åŒ–è¿ä½œæ¨¡å¼è‡ªæœ‰å…¶ä¼˜åŠ¿ã€‚ 2.3. dockerçš„ç›®æ ‡dockerçš„ä¸»è¦ç›®æ ‡æ˜¯â€Build,Ship and Run any App,Angwhereâ€,æ„å»ºï¼Œè¿è¾“ï¼Œå¤„å¤„è¿è¡Œ æ„å»ºï¼šåšä¸€ä¸ªdockeré•œåƒ è¿è¾“ï¼šdocker pull è¿è¡Œï¼šå¯åŠ¨ä¸€ä¸ªå®¹å™¨ æ¯ä¸€ä¸ªå®¹å™¨ï¼Œä»–éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿrootfs. 3. å®‰è£…Dockerç¯å¢ƒè¯´æ˜ 123456789# éœ€è¦ä¸¤å°å‡ ç‚¹è¿›è¡Œå®‰è£…[root@docker01 ~]# cat /etc/redhat-release CentOS Linux release 7.2.1511 (Core) [root@docker01 ~]# uname -r 3.10.0-327.el7.x86_64[root@docker01 ~]# hostname -I10.0.0.100 172.16.1.100 [root@docker02 ~]# hostname -I10.0.0.101 172.16.1.101 åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿›è¡Œæ“ä½œ 123wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.reposed -i &#x27;s#download.docker.com#mirrors.ustc.edu.cn/docker-ce#g&#x27; /etc/yum.repos.d/docker-ce.repoyum install docker-ce -y ä¿®æ”¹åœ¨docker01é…ç½®ï¼š 1234567# ä¿®æ”¹å¯åŠ¨æ–‡ä»¶ï¼Œç›‘å¬è¿œç¨‹ç«¯å£vim /usr/lib/systemd/system/docker.serviceExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://10.0.0.100:2375systemctl daemon-reloadsystemctl enable docker.service systemctl restart docker.service# ps -efæ£€æŸ¥è¿›è¡Œï¼Œæ˜¯å¦å¯åŠ¨ åœ¨docker02æµ‹è¯• 123456789[root@docker02 ~]# docker -H 10.0.0.100 infoContainers: 0 Running: 0 Paused: 0 Stopped: 0Images: 0Server Version: 17.12.0-ceStorage Driver: devicemapperÂ·Â·Â· 3.1. DockeråŸºç¡€å‘½ä»¤æ“ä½œæŸ¥çœ‹dockerç›¸å…³ä¿¡æ¯ 1234567891011121314151617[root@docker01 ~]# docker version Client: Version: 17.12.0-ce API version: 1.35 Go version: go1.9.2 Git commit: c97c6d6 Built: Wed Dec 27 20:10:14 2017 OS/Arch: linux/amd64Server: Engine: Version: 17.12.0-ce API version: 1.35 (minimum version 1.12) Go version: go1.9.2 Git commit: c97c6d6 Built: Wed Dec 27 20:12:46 2017 OS/Arch: linux/amd64 Experimental: false é…ç½®dockeré•œåƒåŠ é€Ÿ 1234vi /etc/docker/daemon.json&#123; &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]&#125; 3.2. å¯åŠ¨ç¬¬ä¸€ä¸ªå®¹å™¨12345678910[root@docker01 ~]# docker run -d -p 80:80 nginxUnable to find image &#x27;nginx:latest&#x27; locallylatest: Pulling from library/nginxe7bb522d92ff: Pull complete 6edc05228666: Pull complete cd866a17e81f: Pull complete Digest: sha256:285b49d42c703fdf257d1e2422765c4ba9d3e37768d6ea83d7fe2043dad6e63dStatus: Downloaded newer image for nginx:latest8d8f81da12b5c10af6ba1a5d07f4abc041cb95b01f3d632c3d638922800b0b4d# å®¹å™¨å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨è¿›è¡Œè®¿é—®æµ‹è¯• å‚æ•°è¯´æ˜ 3.3. Dockeré•œåƒç”Ÿå‘½å‘¨æœŸ 4. Dockeré•œåƒç›¸å…³æ“ä½œ4.1. æœç´¢å®˜æ–¹ä»“åº“é•œåƒ1234[root@docker01 ~]# docker search centosNAME DESCRIPTION STARS OFFICIAL AUTOMATEDcentos The official build of CentOS. 3992 [OK] ansible/centos7-ansible Ansible on Centos7 105 [OK] åˆ—è¡¨è¯´æ˜ 4.2. è·å–é•œåƒæ ¹æ®é•œåƒåç§°æ‹‰å–é•œåƒ 1234[root@docker01 ~]# docker pull centosUsing default tag: latestlatest: Pulling from library/centosaf4b0a2388c6: Downloading 34.65MB/73.67MB æŸ¥çœ‹å½“å‰ä¸»æœºé•œåƒåˆ—è¡¨ 1234[root@docker01 ~]# docker image list REPOSITORY TAG IMAGE ID CREATED SIZEcentos latest ff426288ea90 3 weeks ago 207MBnginx latest 3f8a4339aadd 5 weeks ago 108MB æ‹‰ç¬¬ä¸‰æ–¹é•œåƒæ–¹æ³• 1docker pull index.tenxcloud.com/tenxcloud/httpd 4.3. å¯¼å‡ºé•œåƒ123456[root@docker01 ~]# docker image list REPOSITORY TAG IMAGE ID CREATED SIZEcentos latest ff426288ea90 3 weeks ago 207MBnginx latest 3f8a4339aadd 5 weeks ago 108MB# å¯¼å‡º[root@docker01 ~]# docker image save centos &gt; docker-centos.tar.gz 4.4. åˆ é™¤é•œåƒ1234[root@docker01 ~]# docker image rm centos:latest[root@docker01 ~]# docker image list REPOSITORY TAG IMAGE ID CREATED SIZEnginx latest 3f8a4339aadd 5 weeks ago 108MB 4.5. å¯¼å…¥é•œåƒ1234567[root@docker01 ~]# docker image load -i docker-centos.tar.gz e15afa4858b6: Loading layer 215.8MB/215.8MBLoaded image: centos:latest[root@docker01 ~]# docker image list REPOSITORY TAG IMAGE ID CREATED SIZEcentos latest ff426288ea90 3 weeks ago 207MBnginx latest 3f8a4339aadd 5 weeks ago 108MB 4.6. æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯1[root@docker01 ~]# docker image inspect centos 5. å®¹å™¨çš„æ—¥å¸¸ç®¡ç†5.1. å®¹å™¨çš„èµ·&#x2F;åœæœ€ç®€å•çš„è¿è¡Œä¸€ä¸ªå®¹å™¨ 1[root@docker01 ~]# docker run nginx åˆ›å»ºå®¹å™¨ï¼Œä¸¤æ­¥èµ°ï¼ˆä¸å¸¸ç”¨ï¼‰ 1234[root@docker01 ~]# docker create centos:latest /bin/bashbb7f32368ecf0492adb59e20032ab2e6cf6a563a0e6751e58930ee5f7aaef204[root@docker01 ~]# docker start stupefied_nobelstupefied_nobel å¿«é€Ÿå¯åŠ¨å®¹å™¨æ–¹æ³• 1[root@docker01 ~]# docker run centos:latest /usr/bin/sleep 20; å®¹å™¨å†…çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹å¿…é¡»ä¸€ç›´å¤„äºè¿è¡Œçš„çŠ¶æ€ï¼Œå¦åˆ™è¿™ä¸ªå®¹å™¨ï¼Œå°±ä¼šå¤„äºé€€å‡ºçŠ¶æ€ï¼ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ 12345[root@docker01 ~]# docker container ls æˆ–[root@docker01 ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES8708e93fd767 nginx &quot;nginx -g &#x27;daemon ofâ€¦&quot; 6 seconds ago Up 4 seconds 80/tcp keen_lewin æŸ¥çœ‹ä½ å®¹å™¨è¯¦ç»†ä¿¡æ¯&#x2F;ip 1[root@docker01 ~]# docker container inspect å®¹å™¨åç§°/id æŸ¥çœ‹ä½ æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬æœªè¿è¡Œçš„ï¼‰ 12345[root@docker01 ~]# docker ps -aCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES8708e93fd767 nginx &quot;nginx -g &#x27;daemon ofâ€¦&quot; 4 minutes ago Exited (0) 59 seconds ago keen_lewinf9f3e6af7508 nginx &quot;nginx -g &#x27;daemon ofâ€¦&quot; 5 minutes ago Exited (0) 5 minutes ago optimistic_haibt8d8f81da12b5 nginx &quot;nginx -g &#x27;daemon ofâ€¦&quot; 3 hours ago Exited (0) 3 hours ago lucid_bohr åœæ­¢å®¹å™¨ 123[root@docker01 ~]# docker stop å®¹å™¨åç§°/id æˆ–[root@docker01 ~]# docker container kill å®¹å™¨åç§°/id 5.2. è¿›å…¥å®¹å™¨æ–¹æ³•å¯åŠ¨æ—¶è¿›å»æ–¹æ³• 123[root@docker01 ~]# docker run -it #å‚æ•°ï¼š-it å¯äº¤äº’ç»ˆç«¯[root@docker01 ~]# docker run -it nginx:latest /bin/bashroot@79241093859e:/# é€€å‡º&#x2F;ç¦»å¼€å®¹å™¨ 1ctrl+p &amp; ctrl+q å¯åŠ¨åè¿›å…¥å®¹å™¨çš„æ–¹æ³• å¯åŠ¨ä¸€ä¸ªdocker 12345[root@docker01 ~]# docker run -it centos:latest [root@1bf0f43c4d2f /]# ps -ef UID PID PPID C STIME TTY TIME CMDroot 1 0 0 15:47 pts/0 00:00:00 /bin/bashroot 13 1 0 15:47 pts/0 00:00:00 ps -ef attachè¿›å…¥å®¹å™¨ï¼Œä½¿ç”¨pts&#x2F;0 ï¼Œä¼šè®©æ‰€ç”¨é€šè¿‡æ­¤æ–¹æ³•è¿›å¦‚æ”¾å…¥ç”¨æˆ·çœ‹åˆ°åŒæ ·çš„æ“ä½œã€‚ 12345[root@docker01 ~]# docker attach 1bf0f43c4d2f[root@1bf0f43c4d2f /]# ps -ef UID PID PPID C STIME TTY TIME CMDroot 1 0 0 15:47 pts/0 00:00:00 /bin/bashroot 14 1 0 15:49 pts/0 00:00:00 ps -ef è‡ªå‘½åå¯åŠ¨ä¸€ä¸ªå®¹å™¨ â€“name 12345[root@docker01 ~]# docker attach 1bf0f43c4d2f[root@1bf0f43c4d2f /]# ps -ef UID PID PPID C STIME TTY TIME CMDroot 1 0 0 15:47 pts/0 00:00:00 /bin/bashroot 14 1 0 15:49 pts/0 00:00:00 ps -ef exec è¿›å…¥å®¹å™¨æ–¹æ³•ï¼ˆæ¨èä½¿ç”¨ï¼‰ 1234567[root@docker01 ~]# docker exec -it clsn1 /bin/bash [root@b20fa75b4b40 /]# é‡æ–°åˆ†é…ä¸€ä¸ªç»ˆç«¯[root@b20fa75b4b40 /]# ps -ef UID PID PPID C STIME TTY TIME CMDroot 1 0 0 16:11 pts/0 00:00:00 /bin/bashroot 13 0 0 16:14 pts/1 00:00:00 /bin/bashroot 26 13 0 16:14 pts/1 00:00:00 ps -ef 5.3. åˆ é™¤æ‰€æœ‰å®¹å™¨12[root@docker01 ~]# docker rm -f `docker ps -a -q`# -f å¼ºåˆ¶åˆ é™¤ 5.4. å¯åŠ¨æ—¶è¿›è¡Œç«¯å£æ˜ å°„-på‚æ•°ç«¯å£æ˜ å°„ 12[root@docker01 ~]# docker run -d -p 8888:80 nginx:latest 287bec5c60263166c03e1fc5b0b8262fe76507be3dfae4ce5cd2ee2d1e8a89a9 ä¸åŒæŒ‡å®šæ˜ å°„æ–¹æ³• éšæœºæ˜ å°„ 1docker run -P ï¼ˆå¤§Pï¼‰# éœ€è¦é•œåƒæ”¯æŒ 6. Docker æ•°æ®å·çš„ç®¡ç†6.1. æŒ‚è½½æ—¶åˆ›å»ºå·æŒ‚è½½å· 12[root@docker01 ~]# docker run -d -p 80:80 -v /data:/usr/share/nginx/html nginx:latest079786c1e297b5c5031e7a841160c74e91d4ad06516505043c60dbb78a259d09 å®¹å™¨å†…ç«™ç‚¹ç›®å½•: &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html åœ¨å®¿ä¸»æœºå†™å…¥æ•°æ®ï¼ŒæŸ¥çœ‹ 123[root@docker01 ~]# echo &quot;http://www.nmtui.com&quot; &gt;/data/index.html[root@docker01 ~]# curl 10.0.0.100http://www.nmtui.com è®¾ç½®å…±äº«å·ï¼Œä½¿ç”¨åŒä¸€ä¸ªå·å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ 1234[root@docker01 ~]# docker run -d -p 8080:80 -v /data:/usr/share/nginx/html nginx:latest 351f0bd78d273604bd0971b186979aa0f3cbf45247274493d2490527babb4e42[root@docker01 ~]# curl 10.0.0.100:8080http://www.nmtui.com æŸ¥çœ‹å·åˆ—è¡¨ 12[root@docker01 ~]# docker volume lsDRIVER VOLUME NAME 6.2. åˆ›å»ºå·åæŒ‚è½½åˆ›å»ºä¸€ä¸ªå· 12345[root@docker01 ~]# docker volume create f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521[root@docker01 ~]# docker volume ls DRIVER VOLUME NAMElocal f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521 æŒ‡å®šå·å 1234[root@docker01 ~]# docker volume ls DRIVER VOLUME NAMElocal clsnlocal f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521 æŸ¥çœ‹å·è·¯å¾„ 123456789101112[root@docker01 ~]# docker volume inspect clsn [ &#123; &quot;CreatedAt&quot;: &quot;2018-02-01T00:39:25+08:00&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Labels&quot;: &#123;&#125;, &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/clsn/_data&quot;, &quot;Name&quot;: &quot;clsn&quot;, &quot;Options&quot;: &#123;&#125;, &quot;Scope&quot;: &quot;local&quot; &#125;] ä½¿ç”¨å·åˆ›å»º 123456[root@docker01 ~]# docker run -d -p 9000:80 -v clsn:/usr/share/nginx/html nginx:latest 1434559cff996162da7ce71820ed8f5937fb7c02113bbc84e965845c219d3503# å®¿ä¸»æœºæµ‹è¯•[root@docker01 ~]# echo &#x27;blog.nmtui.com&#x27; &gt;/var/lib/docker/volumes/clsn/_data/index.html [root@docker01 ~]# curl 10.0.0.100:9000blog.nmtui.com è®¾ç½®å· 12[root@docker01 ~]# docker run -d -P --volumes-from 079786c1e297 nginx:latest b54b9c9930b417ab3257c6e4a8280b54fae57043c0b76b9dc60b4788e92369fb æŸ¥çœ‹ä½¿ç”¨çš„ç«¯å£ 123456789101112[root@docker01 ~]# netstat -lntup Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1400/sshd tcp 0 0 10.0.0.100:2375 0.0.0.0:* LISTEN 26218/dockerd tcp6 0 0 :::9000 :::* LISTEN 32015/docker-proxy tcp6 0 0 :::8080 :::* LISTEN 31853/docker-proxy tcp6 0 0 :::80 :::* LISTEN 31752/docker-proxy tcp6 0 0 :::22 :::* LISTEN 1400/sshd tcp6 0 0 :::32769 :::* LISTEN 32300/docker-proxy [root@docker01 ~]# curl 10.0.0.100:32769http://www.nmtui.com 6.3. æ‰‹åŠ¨å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒæœ¬æ¬¡æ˜¯åŸºäºdockerå®˜æ–¹centos 6.8 é•œåƒåˆ›å»º å®˜æ–¹é•œåƒåˆ—è¡¨ï¼š https://hub.docker.com/explore/ å¯åŠ¨ä¸€ä¸ªcentos6.8çš„é•œåƒ 123456[root@docker01 ~]# docker pull centos:6.8[root@docker01 ~]# docker run -it -p 1022:22 centos:6.8 /bin/bash# åœ¨å®¹å™¨ç§å®‰è£…sshdæœåŠ¡ï¼Œå¹¶ä¿®æ”¹ç³»ç»Ÿå¯†ç [root@582051b2b92b ~]# yum install openssh-server -y [root@582051b2b92b ~]# echo &quot;root:123456&quot; |chpasswd[root@582051b2b92b ~]# /etc/init.d/sshd start å¯åŠ¨å®Œæˆåé•œåƒsshè¿æ¥æµ‹è¯• å°†å®¹å™¨æäº¤ä¸ºé•œåƒ 1[root@docker01 ~]# docker commit brave_mcclintock centos6-ssh ä½¿ç”¨æ–°çš„é•œåƒå¯åŠ¨å®¹å™¨ 12[root@docker01 ~]# docker run -d -p 1122:22 centos6-ssh:latest /usr/sbin/sshd -D 5b8161fda2a9f2c39c196c67e2eb9274977e7723fe51c4f08a0190217ae93094 åœ¨å®¹å™¨å®‰è£…httpdæœåŠ¡ 1[root@5b8161fda2a9 /]# yum install httpd -y ç¼–å†™å¯åŠ¨è„šæœ¬è„šæœ¬ 123456[root@5b8161fda2a9 /]# cat init.sh #!/bin/bash /etc/init.d/httpd start /usr/sbin/sshd -D[root@5b8161fda2a9 /]# chmod +x init.sh # æ³¨æ„æ‰§è¡Œæƒé™ å†æ¬¡æäº¤ä¸ºæ–°çš„é•œåƒ 12[root@docker01 ~]# docker commit 5b8161fda2a9 centos6-httpd sha256:705d67a786cac040800b8485cf046fd57b1828b805c515377fc3e9cea3a481c1 å¯åŠ¨é•œåƒï¼Œåšå¥½ç«¯å£æ˜ å°„ã€‚å¹¶åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•è®¿é—® 12[root@docker01 ~]# docker run -d -p 1222:22 -p 80:80 centos6-httpd /init.sh 46fa6a06644e31701dc019fb3a8c3b6ef008d4c2c10d46662a97664f838d8c2c 7. Dockerfileè‡ªåŠ¨æ„å»ºdockeré•œåƒå®˜æ–¹æ„å»ºdockerffileæ–‡ä»¶å‚è€ƒ https://github.com/CentOS/CentOS-Dockerfiles 7.1. DockerfileæŒ‡ä»¤é›†dockerfileä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š åŸºç¡€é•œåƒä¿¡æ¯ FROM centos:6.8 åˆ¶ä½œé•œåƒæ“ä½œæŒ‡ä»¤RUN yum insatll openssh-server -y å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ CMD [â€œ&#x2F;bin&#x2F;bashâ€] dockerfileå¸¸ç”¨æŒ‡ä»¤ï¼š FROM è¿™ä¸ªé•œåƒçš„å¦ˆå¦ˆæ˜¯è°ï¼Ÿï¼ˆæŒ‡å®šåŸºç¡€é•œåƒï¼‰ MAINTAINER å‘Šè¯‰åˆ«äººï¼Œè°è´Ÿè´£å…»å®ƒï¼Ÿï¼ˆæŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯ï¼Œå¯ä»¥æ²¡æœ‰ï¼‰ RUN ä½ æƒ³è®©å®ƒå¹²å•¥ï¼ˆåœ¨å‘½ä»¤å‰é¢åŠ ä¸ŠRUNå³å¯ï¼‰ ADD ç»™å®ƒç‚¹åˆ›ä¸šèµ„é‡‘ï¼ˆCOPYæ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨è§£å‹ï¼‰ WORKDIR æˆ‘æ˜¯cd,ä»Šå¤©åˆšåŒ–äº†å¦†ï¼ˆè®¾ç½®å½“å‰å·¥ä½œç›®å½•ï¼‰ VOLUME ç»™å®ƒä¸€ä¸ªå­˜æ”¾è¡Œæçš„åœ°æ–¹ï¼ˆè®¾ç½®å·ï¼ŒæŒ‚è½½ä¸»æœºç›®å½•ï¼‰ EXPOSE å®ƒè¦æ‰“å¼€çš„é—¨æ˜¯å•¥ï¼ˆæŒ‡å®šå¯¹å¤–çš„ç«¯å£ï¼‰ CMD å¥”è·‘å§ï¼Œå…„å¼Ÿï¼ï¼ˆæŒ‡å®šå®¹å™¨å¯åŠ¨åçš„è¦å¹²çš„äº‹æƒ…ï¼‰ dockerfileå…¶ä»–æŒ‡ä»¤ï¼š COPY å¤åˆ¶æ–‡ä»¶ ENV ç¯å¢ƒå˜é‡ ENTRYPOINT å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ 7.2. åˆ›å»ºä¸€ä¸ªDockerfileåˆ›å»ºç¬¬ä¸€ä¸ªDockerfileæ–‡ä»¶ 123456789# åˆ›å»ºç›®å½•[root@docker01 base]# cd /opt/base# åˆ›å»ºDcokerfileæ–‡ä»¶ï¼Œæ³¨æ„å¤§å°å†™[root@docker01 base]# vim DockerfileFROM centos:6.8RUN yum install openssh-server -y RUN echo &quot;root:123456&quot; |chpasswdRUN /etc/init.d/sshd start CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;] ä½¿ç”¨è‡ªæ„å»ºçš„é•œåƒå¯åŠ¨ 12[root@docker01 base]# docker image build -t centos6.8-ssh . -t ä¸ºé•œåƒæ ‡ç­¾æ‰“æ ‡ç­¾ . è¡¨ç¤ºå½“å‰è·¯å¾„ ä½¿ç”¨è‡ªæ„å»ºçš„é•œåƒå¯åŠ¨ 12[root@docker01 base]# docker run -d -p 2022:22 centos6.8-ssh-b dc3027d3c15dac881e8e2aeff80724216f3ac725f142daa66484f7cb5d074e7a 7.3. ä½¿ç”¨Dcokerfileå®‰è£…kodexplorerDockerfileæ–‡ä»¶å†…å®¹ 12345678FROM centos:6.8RUN yum install wget unzip php php-gd php-mbstring -y &amp;&amp; yum clean all# è®¾ç½®å·¥ä½œç›®å½•ï¼Œä¹‹åçš„æ“ä½œéƒ½åœ¨è¿™ä¸ªç›®å½•ä¸­WORKDIR /var/www/html/RUN wget -c http://static.kodcloud.com/update/download/kodexplorer4.25.zipRUN unzip kodexplorer4.25.zip &amp;&amp; rm -f kodexplorer4.25.zipRUN chown -R apache.apache .CMD [&quot;/usr/sbin/apachectl&quot;,&quot;-D&quot;,&quot;FOREGROUND&quot;] æ›´å¤šçš„Dockerfileå¯ä»¥å‚è€ƒå®˜æ–¹æ–¹æ³•ã€‚ 8. Dockerä¸­çš„é•œåƒåˆ†å±‚å‚è€ƒæ–‡æ¡£ï¼š http://www.maiziedu.com/wiki/cloud/dockerimage/ Docker æ”¯æŒé€šè¿‡æ‰©å±•ç°æœ‰é•œåƒï¼Œåˆ›å»ºæ–°çš„é•œåƒã€‚å®é™…ä¸Šï¼ŒDocker Hub ä¸­ 99% çš„é•œåƒéƒ½æ˜¯é€šè¿‡åœ¨ base é•œåƒä¸­å®‰è£…å’Œé…ç½®éœ€è¦çš„è½¯ä»¶æ„å»ºå‡ºæ¥çš„ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ–°é•œåƒæ˜¯ä» base é•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€å±‚ã€‚ 8.1. Docker é•œåƒä¸ºä»€ä¹ˆåˆ†å±‚é•œåƒåˆ†å±‚æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å…±äº«èµ„æºã€‚ æ¯”å¦‚è¯´æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„ base é•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆ Docker Host åªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½ base é•œåƒï¼›åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½ base é•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚ å¦‚æœå¤šä¸ªå®¹å™¨å…±äº«ä¸€ä»½åŸºç¡€é•œåƒï¼Œå½“æŸä¸ªå®¹å™¨ä¿®æ”¹äº†åŸºç¡€é•œåƒçš„å†…å®¹ï¼Œæ¯”å¦‚ &#x2F;etc ä¸‹çš„æ–‡ä»¶ï¼Œè¿™æ—¶å…¶ä»–å®¹å™¨çš„ &#x2F;etc æ˜¯ä¸ä¼šè¢«ä¿®æ”¹çš„ï¼Œä¿®æ”¹åªä¼šè¢«é™åˆ¶åœ¨å•ä¸ªå®¹å™¨å†…ã€‚è¿™å°±æ˜¯å®¹å™¨ Copy-on-Write ç‰¹æ€§ã€‚ 8.2. å¯å†™çš„å®¹å™¨å±‚å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚è¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€œå®¹å™¨å±‚â€ï¼Œâ€œå®¹å™¨å±‚â€ä¹‹ä¸‹çš„éƒ½å«â€œé•œåƒå±‚â€ã€‚ æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ - æ— è®ºæ·»åŠ ã€åˆ é™¤ã€è¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ã€‚ 8.3. å®¹å™¨å±‚çš„ç»†èŠ‚è¯´æ˜é•œåƒå±‚æ•°é‡å¯èƒ½ä¼šå¾ˆå¤šï¼Œæ‰€æœ‰é•œåƒå±‚ä¼šè”åˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœä¸åŒå±‚ä¸­æœ‰ä¸€ä¸ªç›¸åŒè·¯å¾„çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ &#x2F;aï¼Œä¸Šå±‚çš„ &#x2F;a ä¼šè¦†ç›–ä¸‹å±‚çš„ &#x2F;aï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·åªèƒ½è®¿é—®åˆ°ä¸Šå±‚ä¸­çš„æ–‡ä»¶ &#x2F;aã€‚åœ¨å®¹å™¨å±‚ä¸­ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªå åŠ ä¹‹åçš„æ–‡ä»¶ç³»ç»Ÿã€‚ æ–‡ä»¶æ“ä½œçš„ åªæœ‰å½“éœ€è¦ä¿®æ”¹æ—¶æ‰å¤åˆ¶ä¸€ä»½æ•°æ®ï¼Œè¿™ç§ç‰¹æ€§è¢«ç§°ä½œ Copy-on-Writeã€‚å¯è§ï¼Œå®¹å™¨å±‚ä¿å­˜çš„æ˜¯é•œåƒå˜åŒ–çš„éƒ¨åˆ†ï¼Œä¸ä¼šå¯¹é•œåƒæœ¬èº«è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚ è¿™æ ·å°±è§£é‡Šäº†æˆ‘ä»¬å‰é¢æå‡ºçš„é—®é¢˜ï¼šå®¹å™¨å±‚è®°å½•å¯¹é•œåƒçš„ä¿®æ”¹ï¼Œæ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œä¸ä¼šè¢«å®¹å™¨ä¿®æ”¹ï¼Œæ‰€ä»¥é•œåƒå¯ä»¥è¢«å¤šä¸ªå®¹å™¨å…±äº«ã€‚ 9. ä½¿ç”¨dockerè¿è¡Œzabbix-server9.1. å®¹å™¨é—´çš„äº’è”åœ¨è¿è¡Œzabbixä¹‹å‰åŠ¡å¿…è¦äº†è§£å®¹å™¨é—´äº’è”çš„æ–¹æ³• 123456# åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨docker run -d -p 80:80 nginx# åˆ›å»ºå®¹å™¨ï¼Œåšlinkï¼Œå¹¶è¿›å…¥å®¹å™¨ä¸­docker run -it --link quirky_brown:web01 centos-ssh /bin/bash# åœ¨å®¹å™¨ä¸­è®¿é—®nginxå®¹å™¨å¯ä»¥pingé€šping web01 å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ 12345678910111213141516171819# å¯åŠ¨apacheå®¹å™¨[root@docker01 ~]# docker run -d httpd:2.4 3f1f7fc554720424327286bd2b04aeab1b084a3fb011a785b0deab6a34e56955^[[A[root@docker01 docker ps -aCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES3f1f7fc55472 httpd:2.4 &quot;httpd-foreground&quot; 6 seconds ago Up 5 seconds 80/tcp determined_clarke# æ‹‰å–ä¸€ä¸ªbusybox é•œåƒ[root@docker01 ~]# docker pull busybox # å¯åŠ¨å®¹å™¨[root@docker01 ~]# docker run -it --link determined_clarke:web busybox:latest /bin/sh / # # ä½¿ç”¨æ–°çš„å®¹å™¨è®¿é—®æœ€åˆçš„webå®¹å™¨/ # ping web PING web (172.17.0.2): 56 data bytes64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.058 ms^C--- web ping statistics ---1 packets transmitted, 1 packets received, 0% packet lossround-trip min/avg/max = 0.058/0.058/0.058 ms 9.2. å¯åŠ¨zabbixå®¹å™¨1ã€å¯åŠ¨ä¸€ä¸ªmysqlçš„å®¹å™¨ 1234567docker run --name mysql-server -t \\ -e MYSQL_DATABASE=&quot;zabbix&quot; \\ -e MYSQL_USER=&quot;zabbix&quot; \\ -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \\ -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \\ -d mysql:5.7 \\ --character-set-server=utf8 --collation-server=utf8_bin 2ã€å¯åŠ¨java-gatewayå®¹å™¨ç›‘æ§javaæœåŠ¡ 12docker run --name zabbix-java-gateway -t \\ -d zabbix/zabbix-java-gateway:latest 3ã€å¯åŠ¨zabbix-mysqlå®¹å™¨ä½¿ç”¨linkè¿æ¥mysqlä¸java-gatewayã€‚ 1234567891011docker run --name zabbix-server-mysql -t \\ -e DB_SERVER_HOST=&quot;mysql-server&quot; \\ -e MYSQL_DATABASE=&quot;zabbix&quot; \\ -e MYSQL_USER=&quot;zabbix&quot; \\ -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \\ -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \\ -e ZBX_JAVAGATEWAY=&quot;zabbix-java-gateway&quot; \\ --link mysql-server:mysql \\ --link zabbix-java-gateway:zabbix-java-gateway \\ -p 10051:10051 \\ -d zabbix/zabbix-server-mysql:latest 4ã€å¯åŠ¨zabbix webæ˜¾ç¤ºï¼Œä½¿ç”¨linkè¿æ¥zabbix-mysqlä¸mysqlã€‚ 12345678910docker run --name zabbix-web-nginx-mysql -t \\ -e DB_SERVER_HOST=&quot;mysql-server&quot; \\ -e MYSQL_DATABASE=&quot;zabbix&quot; \\ -e MYSQL_USER=&quot;zabbix&quot; \\ -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \\ -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \\ --link mysql-server:mysql \\ --link zabbix-server-mysql:zabbix-server \\ -p 80:80 \\ -d zabbix/zabbix-web-nginx-mysql:latest 9.3. å…³äºzabbix APIå…³äºzabbix APIå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://www.zabbix.com/documentation/3.4/zh/manual/api 1ã€è·å–tokenæ–¹æ³• 123456789101112# è·å–token[root@docker02 ~]# curl -s -X POST -H &#x27;Content-Type:application/json&#x27; -d &#x27;&#123;&quot;jsonrpc&quot;: &quot;2.0&quot;,&quot;method&quot;: &quot;user.login&quot;,&quot;params&quot;: &#123;&quot;user&quot;: &quot;Admin&quot;,&quot;password&quot;: &quot;zabbix&quot;&#125;,&quot;id&quot;: 1&#125;&#x27; http://10.0.0.100/api_jsonrpc.php&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;d3be707f9e866ec5d0d1c242292cbebd&quot;,&quot;id&quot;:1&#125; 10. docker ä»“åº“ï¼ˆregistryï¼‰10.1. åˆ›å»ºä¸€ä¸ªæ™®é€šä»“åº“1ã€åˆ›å»ºä»“åº“ 1docker run -d -p 5000:5000 --restart=always --name registry -v /opt/myregistry:/var/lib/registry registry 2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½¿ä¹‹æ”¯æŒhttp 12345[root@docker01 ~]# cat /etc/docker/daemon.json &#123; &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;], &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;]&#125; é‡å¯dockerè®©ä¿®æ”¹ç”Ÿæ•ˆ 1[root@docker01 ~]# systemctl restart docker.service 3ã€ä¿®æ”¹é•œåƒæ ‡ç­¾ 123456[root@docker01 ~]# docker tag busybox:latest 10.0.0.100:5000/clsn/busybox:1.0[root@docker01 ~]# docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEcentos6-ssh latest 3c2b1e57a0f5 18 hours ago 393MBhttpd 2.4 2e202f453940 6 days ago 179MB10.0.0.100:5000/clsn/busybox 1.0 5b0d59026729 8 days ago 1.15MB 4ã€å°†æ–°æ‰“æ ‡ç­¾çš„é•œåƒä¸Šä¼ é•œåƒåˆ°ä»“åº“ 1[root@docker01 ~]# docker push 10.0.0.100:5000/clsn/busybox 10.2. å¸¦basicè®¤è¯çš„ä»“åº“1ã€å®‰è£…åŠ å¯†å·¥å…· 1[root@docker01 clsn]# yum install httpd-tools -y 2ã€è®¾ç½®è®¤è¯å¯†ç  12mkdir /opt/registry-var/auth/ -phtpasswd -Bbn clsn 123456 &gt; /opt/registry-var/auth/htpasswd 3ã€å¯åŠ¨å®¹å™¨ï¼Œåœ¨å¯åŠ¨æ—¶ä¼ å…¥è®¤è¯å‚æ•° 1docker run -d -p 5000:5000 -v /opt/registry-var/auth/:/auth/ -e &quot;REGISTRY_AUTH=htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd registry 4ã€ä½¿ç”¨éªŒè¯ç”¨æˆ·æµ‹è¯• 12345678910111213141516171819202122232425# ç™»é™†ç”¨æˆ·[root@docker01 ~]# docker login 10.0.0.100:5000 Username: clsn Password: 123456Login Succeeded# æ¨é€é•œåƒåˆ°ä»“åº“[root@docker01 ~]# docker push 10.0.0.100:5000/clsn/busybox The push refers to repository [10.0.0.100:5000/clsn/busybox]4febd3792a1f: Pushed 1.0: digest: sha256:4cee1979ba0bf7db9fc5d28fb7b798ca69ae95a47c5fecf46327720df4ff352d size: 527#è®¤è¯æ–‡ä»¶çš„ä¿å­˜ä½ç½®[root@docker01 ~]# cat .docker/config.json &#123; &quot;auths&quot;: &#123; &quot;10.0.0.100:5000&quot;: &#123; &quot;auth&quot;: &quot;Y2xzbjoxMjM0NTY=&quot; &#125;, &quot;https://index.docker.io/v1/&quot;: &#123; &quot;auth&quot;: &quot;Y2xzbjpIenNAMTk5Ng==&quot; &#125; &#125;, &quot;HttpHeaders&quot;: &#123; &quot;User-Agent&quot;: &quot;Docker-Client/17.12.0-ce (linux)&quot; &#125;&#125; è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„dockeré•œåƒä»“åº“æ­å»ºå®Œæˆ 11. docker-composeç¼–æ’å·¥å…·11.1. å®‰è£…docker-compose1234# ä¸‹è½½pipè½¯ä»¶yum install -y python2-pip# ä¸‹è½½ docker-composepip install docker-compose å›½å†…å¼€å¯pip ä¸‹è½½åŠ é€Ÿï¼š http://mirrors.aliyun.com/help/pypi 1234567mkdir ~/.pip/cat &gt; ~/.pip/pip.conf &lt;&lt;&#x27;EOF&#x27;[global]index-url = https://mirrors.aliyun.com/pypi/simple/[install]trusted-host=mirrors.aliyun.comEOF 11.2. ç¼–æ’å¯åŠ¨é•œåƒ1ã€åˆ›å»ºæ–‡ä»¶ç›®å½• 12[root@docker01 ~]# mkdir /opt/my_wordpress/[root@docker01 ~]# cd /opt/my_wordpress/ 2ã€ç¼–å†™ç¼–æ’æ–‡ä»¶ 1234567891011121314151617181920212223242526[root@docker01 my_wordpress]# vim docker-compose.ymlversion: &#x27;3&#x27;services: db: image: mysql:5.7 volumes: - /data/db_data:/var/lib/mysql restart: always environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress wordpress: depends_on: - db image: wordpress:latest volumes: - /data/web_data:/var/www/html ports: - &quot;8000:80&quot; restart: always environment: WORDPRESS_DB_HOST: db:3306 WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress 3ã€å¯åŠ¨ 123[root@docker01 my_wordpress]# docker-compose up #å¯åŠ¨æ–¹æ³•ï¼šdocker-compose up #åå°å¯åŠ¨æ–¹æ³•ï¼šdocker-compose up -d 4ã€æµè§ˆå™¨ä¸Šè®¿é—®http://10.0.0.100:8000 è¿›è¡Œwordpressçš„å®‰è£…å³å¯ 11.3. haproxyä»£ç†åç«¯dockerå®¹å™¨1ã€ä¿®æ”¹ç¼–æ’è„šæœ¬ 1234567891011121314151617181920212223242526[root@docker01 my_wordpress]# cat docker-compose.yml version: &#x27;3&#x27;services: db: image: mysql:5.7 volumes: - /data/db_data:/var/lib/mysql restart: always environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress wordpress: depends_on: - db image: wordpress:latest volumes: - /data/web_data:/var/www/html ports: - &quot;80&quot; restart: always environment: WORDPRESS_DB_HOST: db:3306 WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress 2ã€åŒæ—¶å¯åŠ¨ä¸¤å°wordpress 1234[root@docker01 my_wordpress]# docker-compose scale wordpress=2 WARNING: The scale command is deprecated. Use the up command with the --scale flag instead.Starting mywordpress_wordpress_1 ... doneCreating mywordpress_wordpress_2 ... done 3ã€å®‰è£…haproxy 1[root@docker01 ~]# yum install haproxy -y 4ã€ä¿®æ”¹haproxyé…ç½®æ–‡ä»¶ å…³äºé…ç½®æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜ï¼Œå‚è€ƒï¼š https://www.cnblogs.com/MacoLee/p/5853413.html 12345678910111213141516171819202122232425262728293031323334353637383940414243444546[root@docker01 ~]#cp /etc/haproxy/haproxy.cfg&#123;,.bak&#125;[root@docker01 ~]# vim /etc/haproxy/haproxy.cfgglobal log 127.0.0.1 local2 chroot /var/lib/haproxy pidfile /var/run/haproxy.pid maxconn 4000 user haproxy group haproxy daemon stats socket /var/lib/haproxy/stats level admin #æ”¯æŒå‘½ä»¤è¡Œæ§åˆ¶defaults mode http log global option httplog option dontlognull option http-server-close option forwardfor except 127.0.0.0/8 option redispatch retries 3 timeout http-request 10s timeout queue 1m timeout connect 10s timeout client 1m timeout server 1m timeout http-keep-alive 10s timeout check 10s maxconn 3000listen stats mode http bind 0.0.0.0:8888 stats enable stats uri /haproxy-status stats auth admin:123456frontend frontend_www_example_com bind 10.0.0.100:8000 mode http option httplog log global default_backend backend_www_example_combackend backend_www_example_com option forwardfor header X-REAL-IP option httpchk HEAD / HTTP/1.0 balance roundrobin server web-node1 10.0.0.100:32768 check inter 2000 rise 30 fall 15 server web-node2 10.0.0.100:32769 check inter 2000 rise 30 fall 15 5ã€å¯åŠ¨haproxy 12systemctl start haproxysystemctl enable haproxy 6ã€ä½¿ç”¨æµè§ˆå™¨è®¿é—®hapeoxyç›‘å¬çš„8000ç«¯å£å¯ä»¥çœ‹åˆ°è´Ÿè½½çš„æƒ…å†µ 7ã€ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://10.0.0.100:8888/haproxy-status å¯ä»¥çœ‹åˆ°åç«¯èŠ‚ç‚¹çš„ç›‘æ§çŠ¶å†µï¼Œ 11.4. å®‰è£…socat ç›´æ¥æ“ä½œsocketæ§åˆ¶haproxy1ã€å®‰è£…è½¯ä»¶ 1yum install socat.x86_64 -y 2ã€æŸ¥çœ‹å¸®åŠ© 1[root@docker01 web_data]# echo &quot;help&quot;|socat stdio /var/lib/haproxy/stats 3ã€ä¸‹çº¿åç«¯èŠ‚ç‚¹ 1echo &quot;disable server backend_www_example_com/web-node2&quot;|socat stdio /var/lib/haproxy/stats 4ã€ä¸Šçº¿åç«¯èŠ‚ç‚¹ 1echo &quot;enable server backend_www_example_com/web-node3&quot;|socat stdio /var/lib/haproxy/stats 5ã€ç¼–å†™phpæµ‹è¯•é¡µï¼Œæ”¾åˆ°&#x2F;data&#x2F;web_dataä¸‹ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®å¯ä»¥æŸ¥çœ‹å½“å‰çš„èŠ‚ç‚¹ 123456789101112[root@docker01 web_data]# vim check.php&lt;html&gt; &lt;head&gt; &lt;title&gt;PHPæµ‹è¯•&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;?php echo &#x27;&lt;p&gt;Hello World &lt;/p&gt;&#x27;; ?&gt; &lt;?php echo &quot;è®¿é—®çš„æœåŠ¡å™¨åœ°å€æ˜¯:&quot;.&quot;&lt;fontcolor=red&gt;&quot;.$_SERVER[&#x27;SERVER_ADDR&#x27;].&quot;&lt;/font&gt;&quot;.&quot;&lt;br&gt;&quot;; echo&quot;è®¿é—®çš„æœåŠ¡å™¨åŸŸåæ˜¯:&quot;.&quot;&lt;fontcolor=red&gt;&quot;.$_SERVER[&#x27;SERVER_NAME&#x27;].&quot;&lt;/font&gt;&quot;.&quot;&lt;br&gt;&quot;; ?&gt; &lt;/body&gt;&lt;/html&gt; 12. é‡å¯dockeræœåŠ¡ï¼Œå®¹å™¨å…¨éƒ¨é€€å‡ºçš„è§£å†³åŠæ³•12.1. åœ¨å¯åŠ¨æ˜¯æŒ‡å®šè‡ªåŠ¨é‡å¯1docker run --restart=always 12.1. ä¿®æ”¹dockeré»˜è®¤é…ç½®æ–‡ä»¶12# æ·»åŠ ä¸Šä¸‹é¢è¿™è¡Œ&quot;live-restore&quot;: true docker serveré…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;docker&#x2F;daemon.json å‚è€ƒ 1234567[root@docker02 ~]# cat /etc/docker/daemon.json &#123; &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;], &quot;graph&quot;: &quot;/opt/mydocker&quot;, # ä¿®æ”¹æ•°æ®çš„å­˜æ”¾ç›®å½•åˆ°/opt/mydocker/ï¼ŒåŸ/var/lib/docker/ &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;], &quot;live-restore&quot;: true&#125; é‡å¯ç”Ÿæ•ˆï¼Œåªå¯¹åœ¨æ­¤ä¹‹åå¯åŠ¨çš„å®¹å™¨ç”Ÿæ•ˆ 1[root@docker01 ~]# systemctl restart docker.service 13. Dockerç½‘ç»œç±»å‹ 13.1. dockerçš„ç½‘ç»œç±»å‹ Bridgeé»˜è®¤dockerç½‘ç»œéš”ç¦»åŸºäºç½‘ç»œå‘½åç©ºé—´ï¼Œåœ¨ç‰©ç†æœºä¸Šåˆ›å»ºdockerå®¹å™¨æ—¶ä¼šä¸ºæ¯ä¸€ä¸ªdockerå®¹å™¨åˆ†é…ç½‘ç»œå‘½åç©ºé—´ï¼Œå¹¶ä¸”æŠŠå®¹å™¨IPæ¡¥æ¥åˆ°ç‰©ç†æœºçš„è™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚ 13.2. ä¸ä¸ºå®¹å™¨é…ç½®ç½‘ç»œåŠŸèƒ½æ­¤æ¨¡å¼ä¸‹åˆ›å»ºå®¹å™¨æ˜¯ä¸ä¼šä¸ºå®¹å™¨é…ç½®ä»»ä½•ç½‘ç»œå‚æ•°çš„ï¼Œå¦‚ï¼šå®¹å™¨ç½‘å¡ã€IPã€é€šä¿¡è·¯ç”±ç­‰ï¼Œå…¨éƒ¨éœ€è¦è‡ªå·±å»é…ç½®ã€‚ 123456[root@docker01 ~]# docker run -it --network none busybox:latest /bin/sh / # ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 13.3. ä¸å…¶ä»–å®¹å™¨å…±äº«ç½‘ç»œé…ç½®(Containerï¼‰æ­¤æ¨¡å¼å’Œhostæ¨¡å¼å¾ˆç±»ä¼¼ï¼Œåªæ˜¯æ­¤æ¨¡å¼åˆ›å»ºå®¹å™¨å…±äº«çš„æ˜¯å…¶ä»–å®¹å™¨çš„IPå’Œç«¯å£è€Œä¸æ˜¯ç‰©ç†æœºï¼Œæ­¤æ¨¡å¼å®¹å™¨è‡ªèº«æ˜¯ä¸ä¼šé…ç½®ç½‘ç»œå’Œç«¯å£ï¼Œåˆ›å»ºæ­¤æ¨¡å¼å®¹å™¨è¿›å»åï¼Œä½ ä¼šå‘ç°é‡Œè¾¹çš„IPæ˜¯ä½ æ‰€æŒ‡å®šçš„é‚£ä¸ªå®¹å™¨IPå¹¶ä¸”ç«¯å£ä¹Ÿæ˜¯å…±äº«çš„ï¼Œè€Œä¸”å…¶å®ƒè¿˜æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œå¦‚è¿›ç¨‹ç­‰ã€‚ 12345678910[root@docker01 ~]# docker run -it --network container:mywordpress_db_1 busybox:latest /bin/sh / # ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever105: eth0@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff inet 172.18.0.3/16 brd 172.18.255.255 scope global eth0 valid_lft forever preferred_lft forever 13.4. ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œæ­¤æ¨¡å¼åˆ›å»ºçš„å®¹å™¨æ²¡æœ‰è‡ªå·±ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œæ˜¯å’Œç‰©ç†æœºå…±äº«ä¸€ä¸ªNetwork Namespaceï¼Œå¹¶ä¸”å…±äº«ç‰©ç†æœºçš„æ‰€æœ‰ç«¯å£ä¸IPï¼Œå¹¶ä¸”è¿™ä¸ªæ¨¡å¼è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ã€‚ 1[root@docker01 ~]# docker run -it --network host busybox:latest /bin/shshell 13.5. æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨123456[root@docker01 ~]# docker network list NETWORK ID NAME DRIVER SCOPEb15e8a720d3b bridge bridge local345d65b4c2a0 host host localbc5e2a32bb55 mywordpress_default bridge localebf76eea91bb none null local ç”¨PIPEWORKä¸ºdockerå®¹å™¨é…ç½®ç‹¬ç«‹IP å‚è€ƒæ–‡æ¡£ï¼š blog.csdn.net&#x2F;design321&#x2F;article&#x2F;details&#x2F;48264825 å®˜æ–¹ç½‘ç«™ï¼š github.com&#x2F;jpetazzo&#x2F;pipework å®¿ä¸»ç¯å¢ƒï¼šcentos7.2 1ã€å®‰è£…pipework 1234wget https://github.com/jpetazzo/pipework/archive/master.zipunzip master.zip cp pipework-master/pipework /usr/local/bin/chmod +x /usr/local/bin/pipework 2ã€é…ç½®æ¡¥æ¥ç½‘å¡ å®‰è£…æ¡¥æ¥å·¥å…· 1yum install bridge-utils.x86_64 -y ä¿®æ”¹ç½‘å¡é…ç½®ï¼Œå®ç°æ¡¥æ¥ 1234567891011121314151617181920# ä¿®æ”¹eth0é…ç½®ï¼Œè®©br0å®ç°æ¡¥æ¥[root@docker01 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0 TYPE=EthernetBOOTPROTO=staticNAME=eth0DEVICE=eth0ONBOOT=yesBRIDGE=br0[root@docker01 ~]# cat /etc/sysconfig/network-scripts/ifcfg-br0 TYPE=BridgeBOOTPROTO=staticNAME=br0DEVICE=br0ONBOOT=yesIPADDR=10.0.0.100NETMASK=255.255.255.0GATEWAY=10.0.0.254DNS1=223.5.5.5# é‡å¯ç½‘ç»œ[root@docker01 ~]# /etc/init.d/network restart 3ã€è¿è¡Œä¸€ä¸ªå®¹å™¨é•œåƒæµ‹è¯•ï¼š 1pipework br0 $(docker run -d -it -p 6880:80 --name httpd_pw httpd) 10.0.0.220/24@10.0.0.254 åœ¨å…¶ä»–ä¸»æœºä¸Šæµ‹è¯•ç«¯å£åŠè¿é€šæ€§ 12345[root@docker01 ~]# curl 10.0.0.220&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;[root@docker01 ~]# ping 10.0.0.220 -c 1PING 10.0.0.220 (10.0.0.220) 56(84) bytes of data.64 bytes from 10.0.0.220: icmp_seq=1 ttl=64 time=0.043 ms 4ã€å†è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œè®¾ç½®ç½‘è·¯ç±»å‹ä¸ºnoneï¼š 1pipework br0 $(docker run -d -it --net=none --name test httpd:2.4) 10.0.0.221/24@10.0.0.254 è¿›è¡Œè®¿é—®æµ‹è¯• 12[root@docker01 ~]# curl 10.0.0.221&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; 5ã€é‡å¯å®¹å™¨åéœ€è¦å†æ¬¡æŒ‡å®šï¼š 12pipework br0 testduliip 172.16.146.113/24@172.16.146.1pipework br0 testduliip01 172.16.146.112/24@172.16.146.1 Dcokerè·¨ä¸»æœºé€šä¿¡ä¹‹overlayå¯ä»¥å‚è€ƒï¼š cnblogs.com&#x2F;CloudMan6&#x2F;p&#x2F;7270551.html 13.6. Dockerè·¨ä¸»æœºé€šä¿¡ä¹‹macvlanåˆ›å»ºç½‘ç»œ 12[root@docker01 ~]# docker network create --driver macvlan --subnet 10.1.0.0/24 --gateway 10.1.0.254 -o parent=eth0 macvlan_133a1f41dcc074f91b5bd45e7dfedabfb2b8ec82db16542f05213839a119b62ca è®¾ç½®ç½‘å¡ä¸ºæ··æ‚æ¨¡å¼ 1ip link set eth0 promisc on åˆ›å»ºä½¿ç”¨macvlanç½‘ç»œå®¹å™¨ 1[root@docker02 ~]# docker run -it --network macvlan_1 --ip=10.1.0.222 busybox /b 14. dockerä¼ä¸šçº§é•œåƒä»“åº“harborå®¹å™¨ç®¡ç† 123[root@docker01 harbor]# pwd/opt/harbor[root@docker01 harbor]# docker-compose stop 1ã€å®‰è£…dockerã€docker-compose ä¸‹è½½ harbor 12cd /opt &amp;&amp; https://storage.googleapis.com/harbor-releases/harbor-offline-installer-v1.3.0.tgztar xf harbor-offline-installer-v1.3.0.tgz 2ã€ä¿®æ”¹ä¸»æœºåŠwebç•Œé¢å¯†ç  12345[root@docker01 harbor]# vim harbor.cfg Â·Â·Â· hostname = 10.0.0.100 harbor_admin_password = Harbor12345 Â·Â·Â· 3ã€æ‰§è¡Œå®‰è£…è„šæœ¬ 1[root@docker01 harbor]# ./install.sh æµè§ˆå™¨è®¿é—® http://10.0.0.11 æ·»åŠ ä¸€ä¸ªé¡¹ç›® 4ã€é•œåƒæ¨é€åˆ°ä»“åº“çš„æŒ‡å®šé¡¹ç›® 1234567891011[root@docker02 ~]# docker tag centos:6.8 10.0.0.100/clsn/centos6.8:1.0[root@docker02 ~]# [root@docker02 ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZEbusybox latest 5b0d59026729 8 days ago 1.15MB10.0.0.100/clsn/centos6.8 1.0 6704d778b3ba 2 months ago 195MBcentos 6.8 6704d778b3ba 2 months ago 195MB[root@docker02 ~]# docker login 10.0.0.100Username: adminPassword: Login Succeeded 5ã€æ¨é€é•œåƒ 123[root@docker02 ~]# docker push 10.0.0.100/clsn/centos6.8 The push refers to repository [10.0.0.100/clsn/centos6.8]e00c9229b481: Pushing 13.53MB/194.5MB 6ã€åœ¨webç•Œé¢é‡ŒæŸ¥çœ‹ 14.1. ä½¿ç”¨å®¹å™¨çš„å»ºè®® ä¸è¦ä»¥æ‹†åˆ†æ–¹å¼è¿›è¡Œåº”ç”¨ç¨‹åºå‘å¸ƒ ä¸è¦åˆ›å»ºå¤§å‹é•œåƒ ä¸è¦åœ¨å•ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªè¿›ç¨‹ ä¸è¦å†é•œåƒå†…ä¿å­˜å‡­è¯ï¼Œä¸è¦ä¾èµ–IPåœ°å€ ä»¥érootç”¨æˆ·è¿è¡Œè¿›ç¨‹ ä¸è¦ä½¿ç”¨â€œæœ€æ–°â€æ ‡ç­¾ ä¸è¦åˆ©ç”¨è¿è¡Œä¸­çš„å®¹å™¨åˆ›å»ºé•œåƒ ä¸è¦ä½¿ç”¨å•å±‚é•œåƒ ä¸è¦å°†æ•°æ®å­˜æ”¾åœ¨å®¹å™¨å†… 14.2. å…³äºDockerå®¹å™¨çš„ç›‘æ§å®¹å™¨çš„åŸºæœ¬ä¿¡æ¯ åŒ…æ‹¬å®¹å™¨çš„æ•°é‡ã€IDã€åç§°ã€é•œåƒã€å¯åŠ¨å‘½ä»¤ã€ç«¯å£ç­‰ä¿¡æ¯ å®¹å™¨çš„è¿è¡ŒçŠ¶æ€ ç»Ÿè®¡å„çŠ¶æ€çš„å®¹å™¨çš„æ•°é‡ï¼ŒåŒ…æ‹¬è¿è¡Œä¸­ã€æš‚åœã€åœæ­¢åŠå¼‚å¸¸é€€å‡º å®¹å™¨çš„ç”¨é‡ä¿¡æ¯ ç»Ÿè®¡å®¹å™¨çš„CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€å—è®¾å¤‡I&#x2F;Oä½¿ç”¨é‡ã€ç½‘ç»œä½¿ç”¨æƒ…å†µç­‰èµ„æºçš„ä½¿ç”¨æƒ…å†µ å‚è€ƒæ–‡çŒ® redhat.com&#x2F;zh&#x2F;topics&#x2F;containers&#x2F;whats-a-linux-container redhat.com&#x2F;zh&#x2F;topics&#x2F;containers&#x2F;what-is-docker blog.51cto.com&#x2F;dihaifeng&#x2F;1713512 cnblogs.com&#x2F;Bourbon-tian&#x2F;p&#x2F;6867796.html cnblogs.com&#x2F;CloudMan6&#x2F;p&#x2F;6806193.html","tags":["å¼€å‘å·¥å…·","Docker"],"categories":["å¼€å‘å·¥å…·"]},{"title":"MySQLå¤§è¡¨ä¼˜åŒ–æ–¹æ¡ˆ","path":"/2023/12/24/MySQLå¤§è¡¨ä¼˜åŒ–æ–¹æ¡ˆ/","content":"å½“MySQLå•è¡¨è®°å½•æ•°è¿‡å¤§æ—¶ï¼Œå¢åˆ æ”¹æŸ¥æ€§èƒ½éƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ­¥éª¤æ¥ä¼˜åŒ–ï¼š å•è¡¨ä¼˜åŒ–é™¤éå•è¡¨æ•°æ®æœªæ¥ä¼šä¸€ç›´ä¸æ–­ä¸Šæ¶¨ï¼Œå¦åˆ™ä¸è¦ä¸€å¼€å§‹å°±è€ƒè™‘æ‹†åˆ†ï¼Œæ‹†åˆ†ä¼šå¸¦æ¥é€»è¾‘ã€éƒ¨ç½²ã€è¿ç»´çš„å„ç§å¤æ‚åº¦ï¼Œä¸€èˆ¬ä»¥æ•´å‹å€¼ä¸ºä¸»çš„è¡¨åœ¨åƒä¸‡çº§ä»¥ä¸‹ï¼Œå­—ç¬¦ä¸²ä¸ºä¸»çš„è¡¨åœ¨äº”ç™¾ä¸‡ä»¥ä¸‹æ˜¯æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ã€‚è€Œäº‹å®ä¸Šå¾ˆå¤šæ—¶å€™MySQLå•è¡¨çš„æ€§èƒ½ä¾ç„¶æœ‰ä¸å°‘ä¼˜åŒ–ç©ºé—´ï¼Œç”šè‡³èƒ½æ­£å¸¸æ”¯æ’‘åƒä¸‡çº§ä»¥ä¸Šçš„æ•°æ®é‡ï¼š å­—æ®µ å°½é‡ä½¿ç”¨TINYINTã€SMALLINTã€MEDIUM_INTä½œä¸ºæ•´æ•°ç±»å‹è€ŒéINTï¼Œå¦‚æœéè´Ÿåˆ™åŠ ä¸ŠUNSIGNED VARCHARçš„é•¿åº¦åªåˆ†é…çœŸæ­£éœ€è¦çš„ç©ºé—´ ä½¿ç”¨æšä¸¾æˆ–æ•´æ•°ä»£æ›¿å­—ç¬¦ä¸²ç±»å‹ å°½é‡ä½¿ç”¨TIMESTAMPè€ŒéDATETIMEï¼Œ å•è¡¨ä¸è¦æœ‰å¤ªå¤šå­—æ®µï¼Œå»ºè®®åœ¨20ä»¥å†… é¿å…ä½¿ç”¨NULLå­—æ®µï¼Œå¾ˆéš¾æŸ¥è¯¢ä¼˜åŒ–ä¸”å ç”¨é¢å¤–ç´¢å¼•ç©ºé—´ ç”¨æ•´å‹æ¥å­˜IP ç´¢å¼• ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¦æ ¹æ®æŸ¥è¯¢æœ‰é’ˆå¯¹æ€§çš„åˆ›å»ºï¼Œè€ƒè™‘åœ¨WHEREå’ŒORDER BYå‘½ä»¤ä¸Šæ¶‰åŠçš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œå¯æ ¹æ®EXPLAINæ¥æŸ¥çœ‹æ˜¯å¦ç”¨äº†ç´¢å¼•è¿˜æ˜¯å…¨è¡¨æ‰«æ åº”å°½é‡é¿å…åœ¨WHEREå­å¥ä¸­å¯¹å­—æ®µè¿›è¡ŒNULLå€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ å€¼åˆ†å¸ƒå¾ˆç¨€å°‘çš„å­—æ®µä¸é€‚åˆå»ºç´¢å¼•ï¼Œä¾‹å¦‚â€æ€§åˆ«â€è¿™ç§åªæœ‰ä¸¤ä¸‰ä¸ªå€¼çš„å­—æ®µ å­—ç¬¦å­—æ®µåªå»ºå‰ç¼€ç´¢å¼• å­—ç¬¦å­—æ®µæœ€å¥½ä¸è¦åšä¸»é”® ä¸ç”¨å¤–é”®ï¼Œç”±ç¨‹åºä¿è¯çº¦æŸ å°½é‡ä¸ç”¨UNIQUEï¼Œç”±ç¨‹åºä¿è¯çº¦æŸ ä½¿ç”¨å¤šåˆ—ç´¢å¼•æ—¶ä¸»æ„é¡ºåºå’ŒæŸ¥è¯¢æ¡ä»¶ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶åˆ é™¤ä¸å¿…è¦çš„å•åˆ—ç´¢å¼• æŸ¥è¯¢SQL å¯é€šè¿‡å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—æ¥æ‰¾å‡ºè¾ƒæ…¢çš„SQL ä¸åšåˆ—è¿ç®—ï¼šSELECT id WHERE age + 1 &#x3D; 10ï¼Œä»»ä½•å¯¹åˆ—çš„æ“ä½œéƒ½å°†å¯¼è‡´è¡¨æ‰«æï¼Œå®ƒåŒ…æ‹¬æ•°æ®åº“æ•™ç¨‹å‡½æ•°ã€è®¡ç®—è¡¨è¾¾å¼ç­‰ç­‰ï¼ŒæŸ¥è¯¢æ—¶è¦å°½å¯èƒ½å°†æ“ä½œç§»è‡³ç­‰å·å³è¾¹ sqlè¯­å¥å°½å¯èƒ½ç®€å•ï¼šä¸€æ¡sqlåªèƒ½åœ¨ä¸€ä¸ªcpuè¿ç®—ï¼›å¤§è¯­å¥æ‹†å°è¯­å¥ï¼Œå‡å°‘é”æ—¶é—´ï¼›ä¸€æ¡å¤§sqlå¯ä»¥å µæ­»æ•´ä¸ªåº“ ä¸ç”¨SELECT * ORæ”¹å†™æˆINï¼šORçš„æ•ˆç‡æ˜¯nçº§åˆ«ï¼ŒINçš„æ•ˆç‡æ˜¯log(n)çº§åˆ«ï¼Œinçš„ä¸ªæ•°å»ºè®®æ§åˆ¶åœ¨200ä»¥å†… ä¸ç”¨å‡½æ•°å’Œè§¦å‘å™¨ï¼Œåœ¨åº”ç”¨ç¨‹åºå®ç° é¿å…%xxxå¼æŸ¥è¯¢ å°‘ç”¨JOIN ä½¿ç”¨åŒç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¦‚ç”¨â€™123â€™å’Œâ€™123â€™æ¯”ï¼Œ123å’Œ123æ¯” å°½é‡é¿å…åœ¨WHEREå­å¥ä¸­ä½¿ç”¨!&#x3D;æˆ–&lt;&gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ å¯¹äºè¿ç»­æ•°å€¼ï¼Œä½¿ç”¨BETWEENä¸ç”¨INï¼šSELECT id FROM t WHERE num BETWEEN 1 AND 5 åˆ—è¡¨æ•°æ®ä¸è¦æ‹¿å…¨è¡¨ï¼Œè¦ä½¿ç”¨LIMITæ¥åˆ†é¡µï¼Œæ¯é¡µæ•°é‡ä¹Ÿä¸è¦å¤ªå¤§ å¼•æ“ç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯MyISAMå’ŒInnoDBä¸¤ç§å¼•æ“ï¼š MyISAMMyISAMå¼•æ“æ˜¯MySQL 5.1åŠä¹‹å‰ç‰ˆæœ¬çš„é»˜è®¤å¼•æ“ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š ä¸æ”¯æŒè¡Œé”ï¼Œè¯»å–æ—¶å¯¹éœ€è¦è¯»åˆ°çš„æ‰€æœ‰è¡¨åŠ é”ï¼Œå†™å…¥æ—¶åˆ™å¯¹è¡¨åŠ æ’å®ƒé” ä¸æ”¯æŒäº‹åŠ¡ ä¸æ”¯æŒå¤–é”® ä¸æ”¯æŒå´©æºƒåçš„å®‰å…¨æ¢å¤ åœ¨è¡¨æœ‰è¯»å–æŸ¥è¯¢çš„åŒæ—¶ï¼Œæ”¯æŒå¾€è¡¨ä¸­æ’å…¥æ–°çºªå½• æ”¯æŒBLOBå’ŒTEXTçš„å‰500ä¸ªå­—ç¬¦ç´¢å¼•ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼• æ”¯æŒå»¶è¿Ÿæ›´æ–°ç´¢å¼•ï¼Œæå¤§æå‡å†™å…¥æ€§èƒ½ å¯¹äºä¸ä¼šè¿›è¡Œä¿®æ”¹çš„è¡¨ï¼Œæ”¯æŒå‹ç¼©è¡¨ï¼Œæå¤§å‡å°‘ç£ç›˜ç©ºé—´å ç”¨ InnoDBInnoDBåœ¨MySQL 5.5åæˆä¸ºé»˜è®¤ç´¢å¼•ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š æ”¯æŒè¡Œé”ï¼Œé‡‡ç”¨MVCCæ¥æ”¯æŒé«˜å¹¶å‘ æ”¯æŒäº‹åŠ¡ æ”¯æŒå¤–é”® æ”¯æŒå´©æºƒåçš„å®‰å…¨æ¢å¤ ä¸æ”¯æŒå…¨æ–‡ç´¢å¼• æ€»ä½“æ¥è®²ï¼ŒMyISAMé€‚åˆSELECTå¯†é›†å‹çš„è¡¨ï¼Œè€ŒInnoDBé€‚åˆINSERTå’ŒUPDATEå¯†é›†å‹çš„è¡¨ ç³»ç»Ÿè°ƒä¼˜å‚æ•°å¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªå·¥å…·æ¥åšåŸºå‡†æµ‹è¯•ï¼š sysbenchï¼šä¸€ä¸ªæ¨¡å—åŒ–ï¼Œè·¨å¹³å°ä»¥åŠå¤šçº¿ç¨‹çš„æ€§èƒ½æµ‹è¯•å·¥å…· iibench-mysqlï¼šåŸºäº Java çš„ MySQL&#x2F;Percona&#x2F;MariaDB ç´¢å¼•è¿›è¡Œæ’å…¥æ€§èƒ½æµ‹è¯•å·¥å…· tpcc-mysqlï¼šPerconaå¼€å‘çš„TPC-Cæµ‹è¯•å·¥å…· å…·ä½“çš„è°ƒä¼˜å‚æ•°å†…å®¹è¾ƒå¤šï¼Œå…·ä½“å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œä»‹ç»ä¸€äº›æ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼š back_logï¼šback_logå€¼æŒ‡å‡ºåœ¨MySQLæš‚æ—¶åœæ­¢å›ç­”æ–°è¯·æ±‚ä¹‹å‰çš„çŸ­æ—¶é—´å†…å¤šå°‘ä¸ªè¯·æ±‚å¯ä»¥è¢«å­˜åœ¨å †æ ˆä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœMySqlçš„è¿æ¥æ•°æ®è¾¾åˆ°max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºã€‚å¯ä»¥ä»é»˜è®¤çš„50å‡è‡³500 wait_timeoutï¼šæ•°æ®åº“è¿æ¥é—²ç½®æ—¶é—´ï¼Œé—²ç½®è¿æ¥ä¼šå ç”¨å†…å­˜èµ„æºã€‚å¯ä»¥ä»é»˜è®¤çš„8å°æ—¶å‡åˆ°åŠå°æ—¶ max_user_connection: æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º0æ— ä¸Šé™ï¼Œæœ€å¥½è®¾ä¸€ä¸ªåˆç†ä¸Šé™ thread_concurrencyï¼šå¹¶å‘çº¿ç¨‹æ•°ï¼Œè®¾ä¸ºCPUæ ¸æ•°çš„ä¸¤å€ skip_name_resolveï¼šç¦æ­¢å¯¹å¤–éƒ¨è¿æ¥è¿›è¡ŒDNSè§£æï¼Œæ¶ˆé™¤DNSè§£ææ—¶é—´ï¼Œä½†éœ€è¦æ‰€æœ‰è¿œç¨‹ä¸»æœºç”¨IPè®¿é—® key_buffer_sizeï¼šç´¢å¼•å—çš„ç¼“å­˜å¤§å°ï¼Œå¢åŠ ä¼šæå‡ç´¢å¼•å¤„ç†é€Ÿåº¦ï¼Œå¯¹MyISAMè¡¨æ€§èƒ½å½±å“æœ€å¤§ã€‚å¯¹äºå†…å­˜4Gå·¦å³ï¼Œå¯è®¾ä¸º256Mæˆ–384Mï¼Œé€šè¿‡æŸ¥è¯¢show status like â€˜key_read%â€™ï¼Œä¿è¯key_reads &#x2F; key_read_requestsåœ¨0.1%ä»¥ä¸‹æœ€å¥½ innodb_buffer_pool_sizeï¼šç¼“å­˜æ•°æ®å—å’Œç´¢å¼•å—ï¼Œå¯¹InnoDBè¡¨æ€§èƒ½å½±å“æœ€å¤§ã€‚é€šè¿‡æŸ¥è¯¢show status like â€˜Innodb_buffer_pool_read%â€™ï¼Œä¿è¯ (Innodb_buffer_pool_read_requests â€“ Innodb_buffer_pool_reads) &#x2F; Innodb_buffer_pool_read_requestsè¶Šé«˜è¶Šå¥½ innodb_additional_mem_pool_sizeï¼šInnoDBå­˜å‚¨å¼•æ“ç”¨æ¥å­˜æ”¾æ•°æ®å­—å…¸ä¿¡æ¯ä»¥åŠä¸€äº›å†…éƒ¨æ•°æ®ç»“æ„çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œå½“æ•°æ®åº“å¯¹è±¡éå¸¸å¤šçš„æ—¶å€™ï¼Œé€‚å½“è°ƒæ•´è¯¥å‚æ•°çš„å¤§å°ä»¥ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½èƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­æé«˜è®¿é—®æ•ˆç‡ï¼Œå½“è¿‡å°çš„æ—¶å€™ï¼ŒMySQLä¼šè®°å½•Warningä¿¡æ¯åˆ°æ•°æ®åº“çš„é”™è¯¯æ—¥å¿—ä¸­ï¼Œè¿™æ—¶å°±éœ€è¦è¯¥è°ƒæ•´è¿™ä¸ªå‚æ•°å¤§å° innodb_log_buffer_sizeï¼šInnoDBå­˜å‚¨å¼•æ“çš„äº‹åŠ¡æ—¥å¿—æ‰€ä½¿ç”¨çš„ç¼“å†²åŒºï¼Œä¸€èˆ¬æ¥è¯´ä¸å»ºè®®è¶…è¿‡32MB query_cache_sizeï¼šç¼“å­˜MySQLä¸­çš„ResultSetï¼Œä¹Ÿå°±æ˜¯ä¸€æ¡SQLè¯­å¥æ‰§è¡Œçš„ç»“æœé›†ï¼Œæ‰€ä»¥ä»…ä»…åªèƒ½é’ˆå¯¹selectè¯­å¥ã€‚å½“æŸä¸ªè¡¨çš„æ•°æ®æœ‰ä»»ä½•ä»»ä½•å˜åŒ–ï¼Œéƒ½ä¼šå¯¼è‡´æ‰€æœ‰å¼•ç”¨äº†è¯¥è¡¨çš„selectè¯­å¥åœ¨Query Cacheä¸­çš„ç¼“å­˜æ•°æ®å¤±æ•ˆã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬çš„æ•°æ®å˜åŒ–éå¸¸é¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨Query Cacheå¯èƒ½ä¼šå¾—ä¸å¿å¤±ã€‚æ ¹æ®å‘½ä¸­ç‡(Qcache_hits&#x2F;(Qcache_hits+Qcache_inserts)*100))è¿›è¡Œè°ƒæ•´ï¼Œä¸€èˆ¬ä¸å»ºè®®å¤ªå¤§ï¼Œ256MBå¯èƒ½å·²ç»å·®ä¸å¤šäº†ï¼Œå¤§å‹çš„é…ç½®å‹é™æ€æ•°æ®å¯é€‚å½“è°ƒå¤§.å¯ä»¥é€šè¿‡å‘½ä»¤show status like â€˜Qcache_%â€™æŸ¥çœ‹ç›®å‰ç³»ç»ŸQuery catchä½¿ç”¨å¤§å° read_buffer_sizeï¼šMySqlè¯»å…¥ç¼“å†²åŒºå¤§å°ã€‚å¯¹è¡¨è¿›è¡Œé¡ºåºæ‰«æçš„è¯·æ±‚å°†åˆ†é…ä¸€ä¸ªè¯»å…¥ç¼“å†²åŒºï¼ŒMySqlä¼šä¸ºå®ƒåˆ†é…ä¸€æ®µå†…å­˜ç¼“å†²åŒºã€‚å¦‚æœå¯¹è¡¨çš„é¡ºåºæ‰«æè¯·æ±‚éå¸¸é¢‘ç¹ï¼Œå¯ä»¥é€šè¿‡å¢åŠ è¯¥å˜é‡å€¼ä»¥åŠå†…å­˜ç¼“å†²åŒºå¤§å°æé«˜å…¶æ€§èƒ½ sort_buffer_sizeï¼šMySqlæ‰§è¡Œæ’åºä½¿ç”¨çš„ç¼“å†²å¤§å°ã€‚å¦‚æœæƒ³è¦å¢åŠ ORDER BYçš„é€Ÿåº¦ï¼Œé¦–å…ˆçœ‹æ˜¯å¦å¯ä»¥è®©MySQLä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯é¢å¤–çš„æ’åºé˜¶æ®µã€‚å¦‚æœä¸èƒ½ï¼Œå¯ä»¥å°è¯•å¢åŠ sort_buffer_sizeå˜é‡çš„å¤§å° read_rnd_buffer_sizeï¼šMySqlçš„éšæœºè¯»ç¼“å†²åŒºå¤§å°ã€‚å½“æŒ‰ä»»æ„é¡ºåºè¯»å–è¡Œæ—¶(ä¾‹å¦‚ï¼ŒæŒ‰ç…§æ’åºé¡ºåº)ï¼Œå°†åˆ†é…ä¸€ä¸ªéšæœºè¯»ç¼“å­˜åŒºã€‚è¿›è¡Œæ’åºæŸ¥è¯¢æ—¶ï¼ŒMySqlä¼šé¦–å…ˆæ‰«æä¸€éè¯¥ç¼“å†²ï¼Œä»¥é¿å…ç£ç›˜æœç´¢ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œå¦‚æœéœ€è¦æ’åºå¤§é‡æ•°æ®ï¼Œå¯é€‚å½“è°ƒé«˜è¯¥å€¼ã€‚ä½†MySqlä¼šä¸ºæ¯ä¸ªå®¢æˆ·è¿æ¥å‘æ”¾è¯¥ç¼“å†²ç©ºé—´ï¼Œæ‰€ä»¥åº”å°½é‡é€‚å½“è®¾ç½®è¯¥å€¼ï¼Œä»¥é¿å…å†…å­˜å¼€é”€è¿‡å¤§ã€‚ record_bufferï¼šæ¯ä¸ªè¿›è¡Œä¸€ä¸ªé¡ºåºæ‰«æçš„çº¿ç¨‹ä¸ºå…¶æ‰«æçš„æ¯å¼ è¡¨åˆ†é…è¿™ä¸ªå¤§å°çš„ä¸€ä¸ªç¼“å†²åŒºã€‚å¦‚æœä½ åšå¾ˆå¤šé¡ºåºæ‰«æï¼Œå¯èƒ½æƒ³è¦å¢åŠ è¯¥å€¼ thread_cache_sizeï¼šä¿å­˜å½“å‰æ²¡æœ‰ä¸è¿æ¥å…³è”ä½†æ˜¯å‡†å¤‡ä¸ºåé¢æ–°çš„è¿æ¥æœåŠ¡çš„çº¿ç¨‹ï¼Œå¯ä»¥å¿«é€Ÿå“åº”è¿æ¥çš„çº¿ç¨‹è¯·æ±‚è€Œæ— éœ€åˆ›å»ºæ–°çš„ table_cacheï¼šç±»ä¼¼äºthread_cache_sizeï¼Œä½†ç”¨æ¥ç¼“å­˜è¡¨æ–‡ä»¶ï¼Œå¯¹InnoDBæ•ˆæœä¸å¤§ï¼Œä¸»è¦ç”¨äºMyISAM å‡çº§ç¡¬ä»¶Scale upï¼Œè¿™ä¸ªä¸å¤šè¯´äº†ï¼Œæ ¹æ®MySQLæ˜¯CPUå¯†é›†å‹è¿˜æ˜¯I&#x2F;Oå¯†é›†å‹ï¼Œé€šè¿‡æå‡CPUå’Œå†…å­˜ã€ä½¿ç”¨SSDï¼Œéƒ½èƒ½æ˜¾è‘—æå‡MySQLæ€§èƒ½ è¯»å†™åˆ†ç¦»ä¹Ÿæ˜¯ç›®å‰å¸¸ç”¨çš„ä¼˜åŒ–ï¼Œä»åº“è¯»ä¸»åº“å†™ï¼Œä¸€èˆ¬ä¸è¦é‡‡ç”¨åŒä¸»æˆ–å¤šä¸»å¼•å…¥å¾ˆå¤šå¤æ‚æ€§ï¼Œå°½é‡é‡‡ç”¨æ–‡ä¸­çš„å…¶ä»–æ–¹æ¡ˆæ¥æé«˜æ€§èƒ½ã€‚åŒæ—¶ç›®å‰å¾ˆå¤šæ‹†åˆ†çš„è§£å†³æ–¹æ¡ˆåŒæ—¶ä¹Ÿå…¼é¡¾è€ƒè™‘äº†è¯»å†™åˆ†ç¦» ç¼“å­˜ç¼“å­˜å¯ä»¥å‘ç”Ÿåœ¨è¿™äº›å±‚æ¬¡ï¼š MySQLå†…éƒ¨ï¼šåœ¨ç³»ç»Ÿè°ƒä¼˜å‚æ•°ä»‹ç»äº†ç›¸å…³è®¾ç½® æ•°æ®è®¿é—®å±‚ï¼šæ¯”å¦‚MyBatisé’ˆå¯¹SQLè¯­å¥åšç¼“å­˜ï¼Œè€ŒHibernateå¯ä»¥ç²¾ç¡®åˆ°å•ä¸ªè®°å½•ï¼Œè¿™é‡Œç¼“å­˜çš„å¯¹è±¡ä¸»è¦æ˜¯æŒä¹…åŒ–å¯¹è±¡Persistence Object åº”ç”¨æœåŠ¡å±‚ï¼šè¿™é‡Œå¯ä»¥é€šè¿‡ç¼–ç¨‹æ‰‹æ®µå¯¹ç¼“å­˜åšåˆ°æ›´ç²¾å‡†çš„æ§åˆ¶å’Œæ›´å¤šçš„å®ç°ç­–ç•¥ï¼Œè¿™é‡Œç¼“å­˜çš„å¯¹è±¡æ˜¯æ•°æ®ä¼ è¾“å¯¹è±¡Data Transfer Object Webå±‚ï¼šé’ˆå¯¹webé¡µé¢åšç¼“å­˜ æµè§ˆå™¨å®¢æˆ·ç«¯ï¼šç”¨æˆ·ç«¯çš„ç¼“å­˜ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåœ¨ä¸€ä¸ªå±‚æ¬¡æˆ–å¤šä¸ªå±‚æ¬¡ç»“åˆåŠ å…¥ç¼“å­˜ã€‚è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸‹æœåŠ¡å±‚çš„ç¼“å­˜å®ç°ï¼Œç›®å‰ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š ç›´å†™å¼ï¼ˆWrite Throughï¼‰ï¼šåœ¨æ•°æ®å†™å…¥æ•°æ®åº“åï¼ŒåŒæ—¶æ›´æ–°ç¼“å­˜ï¼Œç»´æŒæ•°æ®åº“ä¸ç¼“å­˜çš„ä¸€è‡´æ€§ã€‚è¿™ä¹Ÿæ˜¯å½“å‰å¤§å¤šæ•°åº”ç”¨ç¼“å­˜æ¡†æ¶å¦‚Spring Cacheçš„å·¥ä½œæ–¹å¼ã€‚è¿™ç§å®ç°éå¸¸ç®€å•ï¼ŒåŒæ­¥å¥½ï¼Œä½†æ•ˆç‡ä¸€èˆ¬ã€‚ å›å†™å¼ï¼ˆWrite Backï¼‰ï¼šå½“æœ‰æ•°æ®è¦å†™å…¥æ•°æ®åº“æ—¶ï¼Œåªä¼šæ›´æ–°ç¼“å­˜ï¼Œç„¶åå¼‚æ­¥æ‰¹é‡çš„å°†ç¼“å­˜æ•°æ®åŒæ­¥åˆ°æ•°æ®åº“ä¸Šã€‚è¿™ç§å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è¾ƒå¤šçš„åº”ç”¨é€»è¾‘ï¼ŒåŒæ—¶å¯èƒ½ä¼šäº§ç”Ÿæ•°æ®åº“ä¸ç¼“å­˜çš„ä¸åŒæ­¥ï¼Œä½†æ•ˆç‡éå¸¸é«˜ã€‚ è¡¨åˆ†åŒºMySQLåœ¨5.1ç‰ˆå¼•å…¥çš„åˆ†åŒºæ˜¯ä¸€ç§ç®€å•çš„æ°´å¹³æ‹†åˆ†ï¼Œç”¨æˆ·éœ€è¦åœ¨å»ºè¡¨çš„æ—¶å€™åŠ ä¸Šåˆ†åŒºå‚æ•°ï¼Œå¯¹åº”ç”¨æ˜¯é€æ˜çš„æ— éœ€ä¿®æ”¹ä»£ç  å¯¹ç”¨æˆ·æ¥è¯´ï¼Œåˆ†åŒºè¡¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘è¡¨ï¼Œä½†æ˜¯åº•å±‚ç”±å¤šä¸ªç‰©ç†å­è¡¨ç»„æˆï¼Œå®ç°åˆ†åŒºçš„ä»£ç å®é™…ä¸Šæ˜¯é€šè¿‡å¯¹ä¸€ç»„åº•å±‚è¡¨çš„å¯¹è±¡å°è£…ï¼Œä½†å¯¹SQLå±‚æ¥è¯´æ˜¯ä¸€ä¸ªå®Œå…¨å°è£…åº•å±‚çš„é»‘ç›’å­ã€‚MySQLå®ç°åˆ†åŒºçš„æ–¹å¼ä¹Ÿæ„å‘³ç€ç´¢å¼•ä¹Ÿæ˜¯æŒ‰ç…§åˆ†åŒºçš„å­è¡¨å®šä¹‰ï¼Œæ²¡æœ‰å…¨å±€ç´¢å¼• ç”¨æˆ·çš„SQLè¯­å¥æ˜¯éœ€è¦é’ˆå¯¹åˆ†åŒºè¡¨åšä¼˜åŒ–ï¼ŒSQLæ¡ä»¶ä¸­è¦å¸¦ä¸Šåˆ†åŒºæ¡ä»¶çš„åˆ—ï¼Œä»è€Œä½¿æŸ¥è¯¢å®šä½åˆ°å°‘é‡çš„åˆ†åŒºä¸Šï¼Œå¦åˆ™å°±ä¼šæ‰«æå…¨éƒ¨åˆ†åŒºï¼Œå¯ä»¥é€šè¿‡EXPLAIN PARTITIONSæ¥æŸ¥çœ‹æŸæ¡SQLè¯­å¥ä¼šè½åœ¨é‚£äº›åˆ†åŒºä¸Šï¼Œä»è€Œè¿›è¡ŒSQLä¼˜åŒ–ï¼Œå¦‚ä¸‹å›¾5æ¡è®°å½•è½åœ¨ä¸¤ä¸ªåˆ†åŒºä¸Šï¼š 12345678mysql&gt; explain partitions select count(1) from user_partition where id in (1,2,3,4,5);+----+-------------+----------------+------------+-------+---------------+---------+---------+------+------+--------------------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+----------------+------------+-------+---------------+---------+---------+------+------+--------------------------+| 1 | SIMPLE | user_partition | p1,p4 | range | PRIMARY | PRIMARY | 8 | NULL | 5 | Using where; Using index |+----+-------------+----------------+------------+-------+---------------+---------+---------+------+------+--------------------------+1 row in set (0.00 sec) åˆ†åŒºçš„å¥½å¤„æ˜¯ï¼š å¯ä»¥è®©å•è¡¨å­˜å‚¨æ›´å¤šçš„æ•°æ® åˆ†åŒºè¡¨çš„æ•°æ®æ›´å®¹æ˜“ç»´æŠ¤ï¼Œå¯ä»¥é€šè¿‡æ¸…æ¥šæ•´ä¸ªåˆ†åŒºæ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®ï¼Œä¹Ÿå¯ä»¥å¢åŠ æ–°çš„åˆ†åŒºæ¥æ”¯æŒæ–°æ’å…¥çš„æ•°æ®ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥å¯¹ä¸€ä¸ªç‹¬ç«‹åˆ†åŒºè¿›è¡Œä¼˜åŒ–ã€æ£€æŸ¥ã€ä¿®å¤ç­‰æ“ä½œ éƒ¨åˆ†æŸ¥è¯¢èƒ½å¤Ÿä»æŸ¥è¯¢æ¡ä»¶ç¡®å®šåªè½åœ¨å°‘æ•°åˆ†åŒºä¸Šï¼Œé€Ÿåº¦ä¼šå¾ˆå¿« åˆ†åŒºè¡¨çš„æ•°æ®è¿˜å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡ä¸Šï¼Œä»è€Œæç¬‘åˆ©ç”¨å¤šä¸ªç¡¬ä»¶è®¾å¤‡ å¯ä»¥ä½¿ç”¨åˆ†åŒºè¡¨èµ–é¿å…æŸäº›ç‰¹æ®Šç“¶é¢ˆï¼Œä¾‹å¦‚InnoDBå•ä¸ªç´¢å¼•çš„äº’æ–¥è®¿é—®ã€ext3æ–‡ä»¶ç³»ç»Ÿçš„inodeé”ç«äº‰ å¯ä»¥å¤‡ä»½å’Œæ¢å¤å•ä¸ªåˆ†åŒº åˆ†åŒºçš„é™åˆ¶å’Œç¼ºç‚¹ï¼š ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰1024ä¸ªåˆ†åŒº å¦‚æœåˆ†åŒºå­—æ®µä¸­æœ‰ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•çš„åˆ—ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¸»é”®åˆ—å’Œå”¯ä¸€ç´¢å¼•åˆ—éƒ½å¿…é¡»åŒ…å«è¿›æ¥ åˆ†åŒºè¡¨æ— æ³•ä½¿ç”¨å¤–é”®çº¦æŸ NULLå€¼ä¼šä½¿åˆ†åŒºè¿‡æ»¤æ— æ•ˆ æ‰€æœ‰åˆ†åŒºå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“ åˆ†åŒºçš„ç±»å‹ï¼š RANGEåˆ†åŒºï¼šåŸºäºå±äºä¸€ä¸ªç»™å®šè¿ç»­åŒºé—´çš„åˆ—å€¼ï¼ŒæŠŠå¤šè¡Œåˆ†é…ç»™åˆ†åŒº LISTåˆ†åŒºï¼šç±»ä¼¼äºæŒ‰RANGEåˆ†åŒºï¼ŒåŒºåˆ«åœ¨äºLISTåˆ†åŒºæ˜¯åŸºäºåˆ—å€¼åŒ¹é…ä¸€ä¸ªç¦»æ•£å€¼é›†åˆä¸­çš„æŸä¸ªå€¼æ¥è¿›è¡Œé€‰æ‹© HASHåˆ†åŒºï¼šåŸºäºç”¨æˆ·å®šä¹‰çš„è¡¨è¾¾å¼çš„è¿”å›å€¼æ¥è¿›è¡Œé€‰æ‹©çš„åˆ†åŒºï¼Œè¯¥è¡¨è¾¾å¼ä½¿ç”¨å°†è¦æ’å…¥åˆ°è¡¨ä¸­çš„è¿™äº›è¡Œçš„åˆ—å€¼è¿›è¡Œè®¡ç®—ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥åŒ…å«MySQLä¸­æœ‰æ•ˆçš„ã€äº§ç”Ÿéè´Ÿæ•´æ•°å€¼çš„ä»»ä½•è¡¨è¾¾å¼ KEYåˆ†åŒºï¼šç±»ä¼¼äºæŒ‰HASHåˆ†åŒºï¼ŒåŒºåˆ«åœ¨äºKEYåˆ†åŒºåªæ”¯æŒè®¡ç®—ä¸€åˆ—æˆ–å¤šåˆ—ï¼Œä¸”MySQLæœåŠ¡å™¨æä¾›å…¶è‡ªèº«çš„å“ˆå¸Œå‡½æ•°ã€‚å¿…é¡»æœ‰ä¸€åˆ—æˆ–å¤šåˆ—åŒ…å«æ•´æ•°å€¼ åˆ†åŒºé€‚åˆçš„åœºæ™¯æœ‰ï¼š æœ€é€‚åˆçš„åœºæ™¯æ•°æ®çš„æ—¶é—´åºåˆ—æ€§æ¯”è¾ƒå¼ºï¼Œåˆ™å¯ä»¥æŒ‰æ—¶é—´æ¥åˆ†åŒºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314CREATE TABLE members ( firstname VARCHAR(25) NOT NULL, lastname VARCHAR(25) NOT NULL, username VARCHAR(16) NOT NULL, email VARCHAR(35), joined DATE NOT NULL)PARTITION BY RANGE( YEAR(joined) ) ( PARTITION p0 VALUES LESS THAN (1960), PARTITION p1 VALUES LESS THAN (1970), PARTITION p2 VALUES LESS THAN (1980), PARTITION p3 VALUES LESS THAN (1990), PARTITION p4 VALUES LESS THAN MAXVALUE); æŸ¥è¯¢æ—¶åŠ ä¸Šæ—¶é—´èŒƒå›´æ¡ä»¶æ•ˆç‡ä¼šéå¸¸é«˜ï¼ŒåŒæ—¶å¯¹äºä¸éœ€è¦çš„å†å²æ•°æ®èƒ½å¾ˆå®¹çš„æ‰¹é‡åˆ é™¤ã€‚ å¦‚æœæ•°æ®æœ‰æ˜æ˜¾çš„çƒ­ç‚¹ï¼Œè€Œä¸”é™¤äº†è¿™éƒ¨åˆ†æ•°æ®ï¼Œå…¶ä»–æ•°æ®å¾ˆå°‘è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯ä»¥å°†çƒ­ç‚¹æ•°æ®å•ç‹¬æ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œè®©è¿™ä¸ªåˆ†åŒºçš„æ•°æ®èƒ½å¤Ÿæœ‰æœºä¼šéƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢æ—¶åªè®¿é—®ä¸€ä¸ªå¾ˆå°çš„åˆ†åŒºè¡¨ï¼Œèƒ½å¤Ÿæœ‰æ•ˆä½¿ç”¨ç´¢å¼•å’Œç¼“å­˜ å¦å¤–MySQLæœ‰ä¸€ç§æ—©æœŸçš„ç®€å•çš„åˆ†åŒºå®ç° - åˆå¹¶è¡¨ï¼ˆmerge tableï¼‰ï¼Œé™åˆ¶è¾ƒå¤šä¸”ç¼ºä¹ä¼˜åŒ–ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œåº”è¯¥ç”¨æ–°çš„åˆ†åŒºæœºåˆ¶æ¥æ›¿ä»£ å‚ç›´æ‹†åˆ†å‚ç›´åˆ†åº“æ˜¯æ ¹æ®æ•°æ®åº“é‡Œé¢çš„æ•°æ®è¡¨çš„ç›¸å…³æ€§è¿›è¡Œæ‹†åˆ†ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªæ•°æ®åº“é‡Œé¢æ—¢å­˜åœ¨ç”¨æˆ·æ•°æ®ï¼Œåˆå­˜åœ¨è®¢å•æ•°æ®ï¼Œé‚£ä¹ˆå‚ç›´æ‹†åˆ†å¯ä»¥æŠŠç”¨æˆ·æ•°æ®æ”¾åˆ°ç”¨æˆ·åº“ã€æŠŠè®¢å•æ•°æ®æ”¾åˆ°è®¢å•åº“ã€‚å‚ç›´åˆ†è¡¨æ˜¯å¯¹æ•°æ®è¡¨è¿›è¡Œå‚ç›´æ‹†åˆ†çš„ä¸€ç§æ–¹å¼ï¼Œå¸¸è§çš„æ˜¯æŠŠä¸€ä¸ªå¤šå­—æ®µçš„å¤§è¡¨æŒ‰å¸¸ç”¨å­—æ®µå’Œéå¸¸ç”¨å­—æ®µè¿›è¡Œæ‹†åˆ†ï¼Œæ¯ä¸ªè¡¨é‡Œé¢çš„æ•°æ®è®°å½•æ•°ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯å­—æ®µä¸ä¸€æ ·ï¼Œä½¿ç”¨ä¸»é”®å…³è” æ¯”å¦‚åŸå§‹çš„ç”¨æˆ·è¡¨æ˜¯ï¼š å‚ç›´æ‹†åˆ†åæ˜¯ï¼š å‚ç›´æ‹†åˆ†çš„ä¼˜ç‚¹æ˜¯ï¼š å¯ä»¥ä½¿å¾—è¡Œæ•°æ®å˜å°ï¼Œä¸€ä¸ªæ•°æ®å—(Block)å°±èƒ½å­˜æ”¾æ›´å¤šçš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢æ—¶å°±ä¼šå‡å°‘I&#x2F;Oæ¬¡æ•°(æ¯æ¬¡æŸ¥è¯¢æ—¶è¯»å–çš„Block å°±å°‘) å¯ä»¥è¾¾åˆ°æœ€å¤§åŒ–åˆ©ç”¨Cacheçš„ç›®çš„ï¼Œå…·ä½“åœ¨å‚ç›´æ‹†åˆ†çš„æ—¶å€™å¯ä»¥å°†ä¸å¸¸å˜çš„å­—æ®µæ”¾ä¸€èµ·ï¼Œå°†ç»å¸¸æ”¹å˜çš„æ”¾ä¸€èµ· æ•°æ®ç»´æŠ¤ç®€å• ç¼ºç‚¹æ˜¯ï¼š ä¸»é”®å‡ºç°å†—ä½™ï¼Œéœ€è¦ç®¡ç†å†—ä½™åˆ— ä¼šå¼•èµ·è¡¨è¿æ¥JOINæ“ä½œï¼ˆå¢åŠ CPUå¼€é”€ï¼‰å¯ä»¥é€šè¿‡åœ¨ä¸šåŠ¡æœåŠ¡å™¨ä¸Šè¿›è¡Œjoinæ¥å‡å°‘æ•°æ®åº“å‹åŠ› ä¾ç„¶å­˜åœ¨å•è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ï¼ˆéœ€è¦æ°´å¹³æ‹†åˆ†ï¼‰ äº‹åŠ¡å¤„ç†å¤æ‚ æ°´å¹³æ‹†åˆ†æ¦‚è¿°æ°´å¹³æ‹†åˆ†æ˜¯é€šè¿‡æŸç§ç­–ç•¥å°†æ•°æ®åˆ†ç‰‡æ¥å­˜å‚¨ï¼Œåˆ†åº“å†…åˆ†è¡¨å’Œåˆ†åº“ä¸¤éƒ¨åˆ†ï¼Œæ¯ç‰‡æ•°æ®ä¼šåˆ†æ•£åˆ°ä¸åŒçš„MySQLè¡¨æˆ–åº“ï¼Œè¾¾åˆ°åˆ†å¸ƒå¼çš„æ•ˆæœï¼Œèƒ½å¤Ÿæ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡ã€‚ å‰é¢çš„è¡¨åˆ†åŒºæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„åº“å†…åˆ†è¡¨ åº“å†…åˆ†è¡¨ï¼Œä»…ä»…æ˜¯å•çº¯çš„è§£å†³äº†å•ä¸€è¡¨æ•°æ®è¿‡å¤§çš„é—®é¢˜ï¼Œç”±äºæ²¡æœ‰æŠŠè¡¨çš„æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œå› æ­¤å¯¹äºå‡è½»MySQLæœåŠ¡å™¨çš„å‹åŠ›æ¥è¯´ï¼Œå¹¶æ²¡æœ‰å¤ªå¤§çš„ä½œç”¨ï¼Œå¤§å®¶è¿˜æ˜¯ç«äº‰åŒä¸€ä¸ªç‰©ç†æœºä¸Šçš„IOã€CPUã€ç½‘ç»œï¼Œè¿™ä¸ªå°±è¦é€šè¿‡åˆ†åº“æ¥è§£å†³ å‰é¢å‚ç›´æ‹†åˆ†çš„ç”¨æˆ·è¡¨å¦‚æœè¿›è¡Œæ°´å¹³æ‹†åˆ†ï¼Œç»“æœæ˜¯ï¼š å®é™…æƒ…å†µä¸­å¾€å¾€ä¼šæ˜¯å‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†çš„ç»“åˆï¼Œå³å°†Users_A_Må’ŒUsers_N_Zå†æ‹†æˆUserså’ŒUserExtrasï¼Œè¿™æ ·ä¸€å…±å››å¼ è¡¨ æ°´å¹³æ‹†åˆ†çš„ä¼˜ç‚¹æ˜¯: ä¸å­˜åœ¨å•åº“å¤§æ•°æ®å’Œé«˜å¹¶å‘çš„æ€§èƒ½ç“¶é¢ˆ åº”ç”¨ç«¯æ”¹é€ è¾ƒå°‘ æé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œè´Ÿè½½èƒ½åŠ› ç¼ºç‚¹æ˜¯ï¼š åˆ†ç‰‡äº‹åŠ¡ä¸€è‡´æ€§éš¾ä»¥è§£å†³ è·¨èŠ‚ç‚¹Joinæ€§èƒ½å·®ï¼Œé€»è¾‘å¤æ‚ æ•°æ®å¤šæ¬¡æ‰©å±•éš¾åº¦è·Ÿç»´æŠ¤é‡æå¤§ åˆ†ç‰‡åŸåˆ™ èƒ½ä¸åˆ†å°±ä¸åˆ†ï¼Œå‚è€ƒå•è¡¨ä¼˜åŒ– åˆ†ç‰‡æ•°é‡å°½é‡å°‘ï¼Œåˆ†ç‰‡å°½é‡å‡åŒ€åˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®ç»“ç‚¹ä¸Šï¼Œå› ä¸ºä¸€ä¸ªæŸ¥è¯¢SQLè·¨åˆ†ç‰‡è¶Šå¤šï¼Œåˆ™æ€»ä½“æ€§èƒ½è¶Šå·®ï¼Œè™½ç„¶è¦å¥½äºæ‰€æœ‰æ•°æ®åœ¨ä¸€ä¸ªåˆ†ç‰‡çš„ç»“æœï¼Œåªåœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œæ‰©å®¹ï¼Œå¢åŠ åˆ†ç‰‡æ•°é‡ åˆ†ç‰‡è§„åˆ™éœ€è¦æ…é‡é€‰æ‹©åšå¥½æå‰è§„åˆ’ï¼Œåˆ†ç‰‡è§„åˆ™çš„é€‰æ‹©ï¼Œéœ€è¦è€ƒè™‘æ•°æ®çš„å¢é•¿æ¨¡å¼ï¼Œæ•°æ®çš„è®¿é—®æ¨¡å¼ï¼Œåˆ†ç‰‡å…³è”æ€§é—®é¢˜ï¼Œä»¥åŠåˆ†ç‰‡æ‰©å®¹é—®é¢˜ï¼Œæœ€è¿‘çš„åˆ†ç‰‡ç­–ç•¥ä¸ºèŒƒå›´åˆ†ç‰‡ï¼Œæšä¸¾åˆ†ç‰‡ï¼Œä¸€è‡´æ€§Hashåˆ†ç‰‡ï¼Œè¿™å‡ ç§åˆ†ç‰‡éƒ½æœ‰åˆ©äºæ‰©å®¹ å°½é‡ä¸è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­çš„SQLè·¨è¶Šå¤šä¸ªåˆ†ç‰‡ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸€ç›´æ˜¯ä¸ªä¸å¥½å¤„ç†çš„é—®é¢˜ æŸ¥è¯¢æ¡ä»¶å°½é‡ä¼˜åŒ–ï¼Œå°½é‡é¿å…Select * çš„æ–¹å¼ï¼Œå¤§é‡æ•°æ®ç»“æœé›†ä¸‹ï¼Œä¼šæ¶ˆè€—å¤§é‡å¸¦å®½å’ŒCPUèµ„æºï¼ŒæŸ¥è¯¢å°½é‡é¿å…è¿”å›å¤§é‡ç»“æœé›†ï¼Œå¹¶ä¸”å°½é‡ä¸ºé¢‘ç¹ä½¿ç”¨çš„æŸ¥è¯¢è¯­å¥å»ºç«‹ç´¢å¼•ã€‚ é€šè¿‡æ•°æ®å†—ä½™å’Œè¡¨åˆ†åŒºèµ–é™ä½è·¨åº“Joinçš„å¯èƒ½ è¿™é‡Œç‰¹åˆ«å¼ºè°ƒä¸€ä¸‹åˆ†ç‰‡è§„åˆ™çš„é€‰æ‹©é—®é¢˜ï¼Œå¦‚æœæŸä¸ªè¡¨çš„æ•°æ®æœ‰æ˜æ˜¾çš„æ—¶é—´ç‰¹å¾ï¼Œæ¯”å¦‚è®¢å•ã€äº¤æ˜“è®°å½•ç­‰ï¼Œåˆ™ä»–ä»¬é€šå¸¸æ¯”è¾ƒåˆé€‚ç”¨æ—¶é—´èŒƒå›´åˆ†ç‰‡ï¼Œå› ä¸ºå…·æœ‰æ—¶æ•ˆæ€§çš„æ•°æ®ï¼Œæˆ‘ä»¬å¾€å¾€å…³æ³¨å…¶è¿‘æœŸçš„æ•°æ®ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸­å¾€å¾€å¸¦æœ‰æ—¶é—´å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯ï¼Œå½“å‰æ´»è·ƒçš„æ•°æ®ï¼Œé‡‡ç”¨è·¨åº¦æ¯”è¾ƒçŸ­çš„æ—¶é—´æ®µè¿›è¡Œåˆ†ç‰‡ï¼Œè€Œå†å²æ€§çš„æ•°æ®ï¼Œåˆ™é‡‡ç”¨æ¯”è¾ƒé•¿çš„è·¨åº¦å­˜å‚¨ã€‚ æ€»ä½“ä¸Šæ¥è¯´ï¼Œåˆ†ç‰‡çš„é€‰æ‹©æ˜¯å–å†³äºæœ€é¢‘ç¹çš„æŸ¥è¯¢SQLçš„æ¡ä»¶ï¼Œå› ä¸ºä¸å¸¦ä»»ä½•Whereè¯­å¥çš„æŸ¥è¯¢SQLï¼Œä¼šéå†æ‰€æœ‰çš„åˆ†ç‰‡ï¼Œæ€§èƒ½ç›¸å¯¹æœ€å·®ï¼Œå› æ­¤è¿™ç§SQLè¶Šå¤šï¼Œå¯¹ç³»ç»Ÿçš„å½±å“è¶Šå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°½é‡é¿å…è¿™ç§SQLçš„äº§ç”Ÿã€‚ è§£å†³æ–¹æ¡ˆç”±äºæ°´å¹³æ‹†åˆ†ç‰µæ¶‰çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå½“å‰ä¹Ÿæœ‰äº†ä¸å°‘æ¯”è¾ƒæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚è¿™äº›æ–¹æ¡ˆåˆ†ä¸ºä¸¤å¤§ç±»ï¼šå®¢æˆ·ç«¯æ¶æ„å’Œä»£ç†æ¶æ„ã€‚ å®¢æˆ·ç«¯æ¶æ„é€šè¿‡ä¿®æ”¹æ•°æ®è®¿é—®å±‚ï¼Œå¦‚JDBCã€Data Sourceã€MyBatisï¼Œé€šè¿‡é…ç½®æ¥ç®¡ç†å¤šä¸ªæ•°æ®æºï¼Œç›´è¿æ•°æ®åº“ï¼Œå¹¶åœ¨æ¨¡å—å†…å®Œæˆæ•°æ®çš„åˆ†ç‰‡æ•´åˆï¼Œä¸€èˆ¬ä»¥JaråŒ…çš„æ–¹å¼å‘ˆç° è¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯æ¶æ„çš„ä¾‹å­ï¼š å¯ä»¥çœ‹åˆ°åˆ†ç‰‡çš„å®ç°æ˜¯å’Œåº”ç”¨æœåŠ¡å™¨åœ¨ä¸€èµ·çš„ï¼Œé€šè¿‡ä¿®æ”¹Spring JDBCå±‚æ¥å®ç° å®¢æˆ·ç«¯æ¶æ„çš„ä¼˜ç‚¹æ˜¯ï¼š åº”ç”¨ç›´è¿æ•°æ®åº“ï¼Œé™ä½å¤–å›´ç³»ç»Ÿä¾èµ–æ‰€å¸¦æ¥çš„å®•æœºé£é™© é›†æˆæˆæœ¬ä½ï¼Œæ— éœ€é¢å¤–è¿ç»´çš„ç»„ä»¶ ç¼ºç‚¹æ˜¯ï¼š é™äºåªèƒ½åœ¨æ•°æ®åº“è®¿é—®å±‚ä¸Šåšæ–‡ç« ï¼Œæ‰©å±•æ€§ä¸€èˆ¬ï¼Œå¯¹äºæ¯”è¾ƒå¤æ‚çš„ç³»ç»Ÿå¯èƒ½ä¼šåŠ›ä¸ä»å¿ƒ å°†åˆ†ç‰‡é€»è¾‘çš„å‹åŠ›æ”¾åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œé€ æˆé¢å¤–é£é™© ä»£ç†æ¶æ„é€šè¿‡ç‹¬ç«‹çš„ä¸­é—´ä»¶æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ•°æ®æºå’Œæ•°æ®åˆ†ç‰‡æ•´åˆï¼Œåç«¯æ•°æ®åº“é›†ç¾¤å¯¹å‰ç«¯åº”ç”¨ç¨‹åºé€æ˜ï¼Œéœ€è¦ç‹¬ç«‹éƒ¨ç½²å’Œè¿ç»´ä»£ç†ç»„ä»¶ è¿™æ˜¯ä¸€ä¸ªä»£ç†æ¶æ„çš„ä¾‹å­ï¼š ä»£ç†ç»„ä»¶ä¸ºäº†åˆ†æµå’Œé˜²æ­¢å•ç‚¹ï¼Œä¸€èˆ¬ä»¥é›†ç¾¤å½¢å¼å­˜åœ¨ï¼ŒåŒæ—¶å¯èƒ½éœ€è¦Zookeeperä¹‹ç±»çš„æœåŠ¡ç»„ä»¶æ¥ç®¡ç† ä»£ç†æ¶æ„çš„ä¼˜ç‚¹æ˜¯ï¼š èƒ½å¤Ÿå¤„ç†éå¸¸å¤æ‚çš„éœ€æ±‚ï¼Œä¸å—æ•°æ®åº“è®¿é—®å±‚åŸæ¥å®ç°çš„é™åˆ¶ï¼Œæ‰©å±•æ€§å¼º å¯¹äºåº”ç”¨æœåŠ¡å™¨é€æ˜ä¸”æ²¡æœ‰å¢åŠ ä»»ä½•é¢å¤–è´Ÿè½½ ç¼ºç‚¹æ˜¯ï¼š éœ€éƒ¨ç½²å’Œè¿ç»´ç‹¬ç«‹çš„ä»£ç†ä¸­é—´ä»¶ï¼Œæˆæœ¬é«˜ åº”ç”¨éœ€ç»è¿‡ä»£ç†æ¥è¿æ¥æ•°æ®åº“ï¼Œç½‘ç»œä¸Šå¤šäº†ä¸€è·³ï¼Œæ€§èƒ½æœ‰æŸå¤±ä¸”æœ‰é¢å¤–é£é™© å„æ–¹æ¡ˆæ¯”è¾ƒ å‡ºå“æ–¹ æ¶æ„æ¨¡å‹ æ”¯æŒæ•°æ®åº“ åˆ†åº“ åˆ†è¡¨ è¯»å†™åˆ†ç¦» å¤–éƒ¨ä¾èµ– æ˜¯å¦å¼€æº å®ç°è¯­è¨€ æ”¯æŒè¯­è¨€ æœ€åæ›´æ–° Githubæ˜Ÿæ•° MySQL Fabric MySQLå®˜æ–¹ ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ python æ— é™åˆ¶ 4ä¸ªæœˆå‰ 35 Cobar é˜¿é‡Œå·´å·´ ä»£ç†æ¶æ„ MySQL æœ‰ æ—  æ—  æ—  æ˜¯ Java æ— é™åˆ¶ ä¸¤å¹´å‰ 1287 Cobar Client é˜¿é‡Œå·´å·´ å®¢æˆ·ç«¯æ¶æ„ MySQL æœ‰ æ—  æ—  æ—  æ˜¯ Java Java ä¸‰å¹´å‰ 344 TDDL æ·˜å® å®¢æˆ·ç«¯æ¶æ„ æ— é™åˆ¶ æœ‰ æœ‰ æœ‰ Diamond åªå¼€æºéƒ¨åˆ† Java Java æœªçŸ¥ 519 Atlas å¥‡è™360 ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ C æ— é™åˆ¶ 10ä¸ªæœˆå‰ 1941 Heisenberg ç™¾åº¦ç†Šç…§ ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ Java æ— é™åˆ¶ 2ä¸ªæœˆå‰ 197 TribeDB ä¸ªäºº ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ NodeJS æ— é™åˆ¶ 3ä¸ªæœˆå‰ 126 ShardingJDBC å½“å½“ å®¢æˆ·ç«¯æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ Java Java å½“å¤© 1144 Shark ä¸ªäºº å®¢æˆ·ç«¯æ¶æ„ MySQL æœ‰ æœ‰ æ—  æ—  æ˜¯ Java Java ä¸¤å¤©å‰ 84 KingShard ä¸ªäºº ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ Golang æ— é™åˆ¶ ä¸¤å¤©å‰ 1836 OneProxy å¹³æ°‘è½¯ä»¶ ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  å¦ æœªçŸ¥ æ— é™åˆ¶ æœªçŸ¥ æœªçŸ¥ MyCat ç¤¾åŒº ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ Java æ— é™åˆ¶ ä¸¤å¤©å‰ 1270 Vitess Youtube ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æœ‰ æ—  æ˜¯ Golang æ— é™åˆ¶ å½“å¤© 3636 Mixer ä¸ªäºº ä»£ç†æ¶æ„ MySQL æœ‰ æœ‰ æ—  æ—  æ˜¯ Golang æ— é™åˆ¶ 9ä¸ªæœˆå‰ 472 JetPants Tumblr å®¢æˆ·ç«¯æ¶æ„ MySQL æœ‰ æœ‰ æ—  æ—  æ˜¯ Ruby Ruby 10ä¸ªæœˆå‰ 957 HibernateShard Hibernate å®¢æˆ·ç«¯æ¶æ„ æ— é™åˆ¶ æœ‰ æœ‰ æ—  æ—  æ˜¯ Java Java 4å¹´å‰ 57 MybatisShard MakerSoft å®¢æˆ·ç«¯æ¶æ„ æ— é™åˆ¶ æœ‰ æœ‰ æ—  æ—  æ˜¯ Java Java 11ä¸ªæœˆå‰ 119 Gizzard Twitter ä»£ç†æ¶æ„ æ— é™åˆ¶ æœ‰ æœ‰ æ—  æ—  æ˜¯ Java æ— é™åˆ¶ 3å¹´å‰ 2087 å¦‚æ­¤å¤šçš„æ–¹æ¡ˆï¼Œå¦‚ä½•è¿›è¡Œé€‰æ‹©ï¼Ÿå¯ä»¥æŒ‰ä»¥ä¸‹æ€è·¯æ¥è€ƒè™‘ï¼š ç¡®å®šæ˜¯ä½¿ç”¨ä»£ç†æ¶æ„è¿˜æ˜¯å®¢æˆ·ç«¯æ¶æ„ã€‚ä¸­å°å‹è§„æ¨¡æˆ–æ˜¯æ¯”è¾ƒç®€å•çš„åœºæ™¯å€¾å‘äºé€‰æ‹©å®¢æˆ·ç«¯æ¶æ„ï¼Œå¤æ‚åœºæ™¯æˆ–å¤§è§„æ¨¡ç³»ç»Ÿå€¾å‘é€‰æ‹©ä»£ç†æ¶æ„ å…·ä½“åŠŸèƒ½æ˜¯å¦æ»¡è¶³ï¼Œæ¯”å¦‚éœ€è¦è·¨èŠ‚ç‚¹ORDER BYï¼Œé‚£ä¹ˆæ”¯æŒè¯¥åŠŸèƒ½çš„ä¼˜å…ˆè€ƒè™‘ ä¸è€ƒè™‘ä¸€å¹´å†…æ²¡æœ‰æ›´æ–°çš„äº§å“ï¼Œè¯´æ˜å¼€å‘åœæ»ï¼Œç”šè‡³æ— äººç»´æŠ¤å’ŒæŠ€æœ¯æ”¯æŒ æœ€å¥½æŒ‰å¤§å…¬å¸-&gt;ç¤¾åŒº-&gt;å°å…¬å¸-&gt;ä¸ªäººè¿™æ ·çš„å‡ºå“æ–¹é¡ºåºæ¥é€‰æ‹© é€‰æ‹©å£ç¢‘è¾ƒå¥½çš„ï¼Œæ¯”å¦‚githubæ˜Ÿæ•°ã€ä½¿ç”¨è€…æ•°é‡è´¨é‡å’Œä½¿ç”¨è€…åé¦ˆ å¼€æºçš„ä¼˜å…ˆï¼Œå¾€å¾€é¡¹ç›®æœ‰ç‰¹æ®Šéœ€æ±‚å¯èƒ½éœ€è¦æ”¹åŠ¨æºä»£ç  æŒ‰ç…§ä¸Šè¿°æ€è·¯ï¼Œæ¨èä»¥ä¸‹é€‰æ‹©ï¼š å®¢æˆ·ç«¯æ¶æ„ï¼šShardingJDBC ä»£ç†æ¶æ„ï¼šMyCatæˆ–è€…Atlas å…¼å®¹MySQLä¸”å¯æ°´å¹³æ‰©å±•çš„æ•°æ®åº“ç›®å‰ä¹Ÿæœ‰ä¸€äº›å¼€æºæ•°æ®åº“å…¼å®¹MySQLåè®®ï¼Œå¦‚ï¼š TiDB Cubrid ä½†å…¶å·¥ä¸šå“è´¨å’ŒMySQLå°šæœ‰å·®è·ï¼Œä¸”éœ€è¦è¾ƒå¤§çš„è¿ç»´æŠ•å…¥ï¼Œå¦‚æœæƒ³å°†åŸå§‹çš„MySQLè¿ç§»åˆ°å¯æ°´å¹³æ‰©å±•çš„æ–°æ•°æ®åº“ä¸­ï¼Œå¯ä»¥è€ƒè™‘ä¸€äº›äº‘æ•°æ®åº“ï¼š é˜¿é‡Œäº‘PetaData é˜¿é‡Œäº‘OceanBase è…¾è®¯äº‘DCDB NoSQLåœ¨MySQLä¸ŠåšShardingæ˜¯ä¸€ç§æˆ´ç€é•£é“çš„è·³èˆï¼Œäº‹å®ä¸Šå¾ˆå¤šå¤§è¡¨æœ¬èº«å¯¹MySQLè¿™ç§RDBMSçš„éœ€æ±‚å¹¶ä¸å¤§ï¼Œå¹¶ä¸è¦æ±‚ACIDï¼Œå¯ä»¥è€ƒè™‘å°†è¿™äº›è¡¨è¿ç§»åˆ°NoSQLï¼Œå½»åº•è§£å†³æ°´å¹³æ‰©å±•é—®é¢˜ï¼Œä¾‹å¦‚ï¼š æ—¥å¿—ç±»ã€ç›‘æ§ç±»ã€ç»Ÿè®¡ç±»æ•°æ® éç»“æ„åŒ–æˆ–å¼±ç»“æ„åŒ–æ•°æ® å¯¹äº‹åŠ¡è¦æ±‚ä¸å¼ºï¼Œä¸”æ— å¤ªå¤šå…³è”æ“ä½œçš„æ•°æ®","tags":["MySQL","DataBase"],"categories":["DataBase"]},{"title":"MyBatis çš„æ‰§è¡Œæµç¨‹","path":"/2023/12/24/MyBatis-çš„æ‰§è¡Œæµç¨‹ï¼/","content":"æ¦‚è¦åœ¨MyBatisä¸­ï¼Œåˆ©ç”¨ç¼–ç¨‹å¼è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œä¸»è¦å°±æ˜¯ä¸‹é¢å‡ è¡Œä»£ç ï¼š 123SqlSession session = sqlSessionFactory.openSession();UserMapper userMapper = session.getMapper(UserMapper.class);List&lt;LwUser&gt; userList = userMapper.listUserByUserName(&quot;å­¤ç‹¼1å·&quot;); ç¬¬ä¸€è¡Œæ˜¯è·å–ä¸€ä¸ªSqlSessionå¯¹è±¡åœ¨ä¸Šä¸€ç¯‡æ–‡ç« åˆ†æè¿‡äº†ï¼Œç¬¬äºŒè¡Œå°±æ˜¯è·å–UserMapperæ¥å£ï¼Œç¬¬ä¸‰è¡Œä¸€è¡Œä»£ç å°±å®ç°äº†æ•´ä¸ªæŸ¥è¯¢è¯­å¥çš„æµç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»”ç»†åˆ†æä¸€ä¸‹ç¬¬äºŒå’Œç¬¬ä¸‰æ­¥ã€‚ è·å–Mapperæ¥å£(getMapper)ç¬¬äºŒæ­¥æ˜¯é€šè¿‡SqlSessionå¯¹è±¡æ˜¯è·å–ä¸€ä¸ªMapperæ¥å£ï¼Œè¿™ä¸ªæµç¨‹è¿˜æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œä¸‹é¢å°±æ˜¯æˆ‘ä»¬è°ƒç”¨session.getMapperæ–¹æ³•ä¹‹åçš„è¿è¡Œæ—¶åºå›¾ï¼š 1ã€åœ¨è°ƒç”¨getMapperä¹‹åï¼Œä¼šå»Configurationå¯¹è±¡ä¸­è·å–Mapperå¯¹è±¡ï¼Œå› ä¸ºåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™å°±ä¼šæŠŠMapperæ¥å£åŠ è½½å¹¶è§£æå­˜å‚¨åˆ°Configurationå¯¹è±¡ 2ã€é€šè¿‡Configurationå¯¹è±¡ä¸­çš„MapperRegistryå¯¹è±¡å±æ€§ï¼Œç»§ç»­è°ƒç”¨getMapperæ–¹æ³• 3ã€æ ¹æ®typeç±»å‹ï¼Œä»MapperRegistryå¯¹è±¡ä¸­çš„knownMappersè·å–åˆ°å½“å‰ç±»å‹å¯¹åº”çš„ä»£ç†å·¥å‚ç±»ï¼Œç„¶åé€šè¿‡ä»£ç†å·¥å‚ç±»ç”Ÿæˆå¯¹åº”Mapperçš„ä»£ç†ç±» 4ã€æœ€ç»ˆè·å–åˆ°æˆ‘ä»¬æ¥å£å¯¹åº”çš„ä»£ç†ç±»MapperProxyå¯¹è±¡ è€ŒMapperProxyå¯ä»¥çœ‹åˆ°å®ç°äº†InvocationHandlerï¼Œä½¿ç”¨çš„å°±æ˜¯JDKåŠ¨æ€ä»£ç†ã€‚ è‡³æ­¤è·å–Mapperæµç¨‹ç»“æŸäº†ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†MapperRegistryå¯¹è±¡å†…çš„HashMapå±æ€§knownMappersä¸­çš„æ•°æ®æ˜¯ä»€ä¹ˆæ—¶å€™å­˜è¿›å»çš„å‘¢ï¼Ÿ Mapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶æ˜¯ä½•æ—¶å…³è”çš„Mapperæ¥å£åŠå…¶æ˜ å°„æ–‡ä»¶æ˜¯åœ¨åŠ è½½mybatis-configé…ç½®æ–‡ä»¶çš„æ—¶å€™å­˜å‚¨è¿›å»çš„ï¼Œä¸‹é¢å°±æ˜¯æ—¶åºå›¾ï¼š 1ã€é¦–å…ˆæˆ‘ä»¬ä¼šæ‰‹åŠ¨è°ƒç”¨SqlSessionFactoryBuilderæ–¹æ³•ä¸­çš„build()æ–¹æ³•ï¼š 2ã€ç„¶åä¼šæ„é€ ä¸€ä¸ªXMLConfigBuilderå¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶parseæ–¹æ³•ï¼š 3ã€ç„¶åä¼šç»§ç»­è°ƒç”¨è‡ªå·±çš„parseConfigurationæ¥è§£æé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œé¢å°±ä¼šåˆ†åˆ«å»è§£æå…¨å±€é…ç½®æ–‡ä»¶çš„é¡¶çº§èŠ‚ç‚¹ï¼Œå…¶ä»–çš„æˆ‘ä»¬å…ˆä¸çœ‹ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æœ€åè§£æmappersèŠ‚ç‚¹ 4ã€ç»§ç»­è°ƒç”¨è‡ªå·±çš„mapperElementæ¥è§£æmappersæ–‡ä»¶ï¼ˆè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œä¸ºäº†æ–¹ä¾¿æˆªå›¾å®Œæ•´ï¼Œæ‰€ä»¥æŠŠå­—ä½“ç¼©å°äº†1å·ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢åˆ†äº†å››ç§æ–¹å¼æ¥è§£æmappersèŠ‚ç‚¹çš„é…ç½®ï¼Œå¯¹åº”äº†4ç§mapperé…ç½®æ–¹å¼ï¼Œè€Œå…¶ä¸­çº¢æ¡†å†…çš„ä¸¤ç§æ–¹å¼æ˜¯ç›´æ¥é…ç½®çš„xmlæ˜ å°„æ–‡ä»¶ï¼Œè“æ¡†å†…çš„ä¸¤ç§æ–¹å¼æ˜¯è§£æç›´æ¥é…ç½®Mapperæ¥å£çš„æ–¹å¼ï¼Œä»è¿™é‡Œä¹Ÿå¯ä»¥è¯´æ˜ï¼Œä¸è®ºé…ç½®å“ªç§æ–¹å¼ï¼Œæœ€ç»ˆMyBatiséƒ½ä¼šå°†xmlæ˜ å°„æ–‡ä»¶å’ŒMapperæ¥å£è¿›è¡Œå…³è”ã€‚ 5ã€æˆ‘ä»¬å…ˆçœ‹ç¬¬2ç§å’Œç¬¬3ä¸­ï¼ˆç›´æ¥é…ç½®xmlæ˜ å°„æ–‡ä»¶çš„è§£ææ–¹å¼ï¼‰ï¼Œä¼šæ„å»ºä¸€ä¸ªXMLMapperBuilderå¯¹è±¡å¹¶è°ƒç”¨å…¶parseæ–¹æ³•ã€‚ å½“ç„¶ï¼Œè¿™ä¸ªè¿˜æ˜¯ä¼šè¢«è§£æçš„ï¼Œåé¢æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ä¼šå†æ¬¡é€šè¿‡ä¸æ–­éå†å»å…¨éƒ¨è§£æå®Œæ¯•ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº’ç›¸å¼•ç”¨è¿™ç§æ˜¯ä¼šå¯¼è‡´è§£æå¤±è´¥æŠ¥é”™çš„ï¼Œæ‰€ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬åº”è¯¥é¿å…å¾ªç¯ä¾èµ–çš„äº§ç”Ÿã€‚ 6ã€è§£æå®Œæ˜ å°„æ–‡ä»¶ä¹‹åï¼Œè°ƒç”¨è‡ªèº«æ–¹æ³•bindMapperForNamespaceï¼Œå¼€å§‹ç»‘å®šMapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶ï¼š 7ã€è°ƒç”¨Configurationå¯¹è±¡çš„addMapper 8ã€è°ƒç”¨Configurationå¯¹è±¡çš„å±æ€§MapperRegistryå†…çš„addMapperæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æ­£å¼å°†Mapperæ¥å£æ·»åŠ åˆ°knownMappersï¼Œæ‰€ä»¥ä¸Šé¢getMapperå¯ä»¥ç›´æ¥è·å–ï¼š åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†Mapperæ¥å£å’Œxmlæ˜ å°„æ–‡ä»¶çš„ç»‘å®š 9ã€æ³¨æ„ä¸Šé¢çº¢æ¡†é‡Œé¢çš„ä»£ç ï¼Œåˆè°ƒç”¨äº†ä¸€æ¬¡parseæ–¹æ³•ï¼Œè¿™ä¸ªparseæ–¹æ³•ä¸»è¦æ˜¯è§£ææ³¨è§£ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¯­å¥ï¼š 12@Select(&quot;select * from lw_user&quot;)List&lt;LwUser&gt; listAllUser(); æ‰€ä»¥è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¼šå»è§£æ@Selectç­‰æ³¨è§£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œparseæ–¹æ³•é‡Œé¢ä¼šåŒæ—¶å†è§£æä¸€æ¬¡xmlæ˜ å°„æ–‡ä»¶ï¼Œå› ä¸ºä¸Šé¢æˆ‘ä»¬æåˆ°äº†mappersèŠ‚ç‚¹æœ‰4ç§é…ç½®æ–¹å¼ï¼Œå…¶ä¸­ä¸¤ç§é…ç½®çš„æ˜¯Mapperæ¥å£ï¼Œè€Œé…ç½®Mapperæ¥å£ä¼šç›´æ¥å…ˆè°ƒç”¨addMapperæ¥å£ï¼Œå¹¶æ²¡æœ‰è§£ææ˜ å°„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿›å…¥æ³¨è§£è§£ææ–¹æ³•parseä¹‹ä¸­ä¼šéœ€è¦å†å°è¯•è§£æä¸€æ¬¡XMLæ˜ å°„æ–‡ä»¶ã€‚ è§£æå®Œæˆä¹‹åï¼Œè¿˜ä¼šå¯¹Mapperæ¥å£ä¸­çš„æ–¹æ³•è¿›è¡Œè§£æï¼Œå¹¶å°†æ¯ä¸ªæ–¹æ³•çš„å…¨é™å®šç±»åä½œä¸ºkeyå­˜å…¥å­˜å…¥Configurationä¸­çš„mappedStatementså±æ€§ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™é‡Œå­˜å‚¨çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªvalueä¼šå­˜å‚¨2æ¬¡ï¼Œ**ä¸€ä¸ªå…¨é™å®šåä½œä¸ºkeyï¼Œå¦ä¸€ä¸ªå°±æ˜¯åªç”¨æ–¹æ³•å(sqlè¯­å¥çš„id)æ¥ä½œä¸ºkey**ï¼š æ‰€ä»¥æœ€ç»ˆmappedStatementsä¼šæ˜¯ä¸‹é¢çš„æƒ…å†µï¼š äº‹å®ä¸Šå¦‚æœæˆ‘ä»¬é€šè¿‡æ¥å£çš„æ–¹å¼æ¥ç¼–ç¨‹çš„è¯ï¼Œæœ€åæ¥getStatementçš„æ—¶å€™ï¼Œéƒ½æ˜¯æ ¹æ®å…¨é™å®šåæ¥å–çš„ï¼Œæ‰€ä»¥å³ä½¿æœ‰é‡åå¯¹æˆ‘ä»¬ä¹Ÿæ²¡æœ‰å½±å“ï¼Œè€Œä¹‹æ‰€ä»¥è¦è¿™ä¹ˆåšçš„åŸå› å…¶å®è¿˜æ˜¯ä¸ºäº†å…¼å®¹æ—©æœŸç‰ˆæœ¬çš„ç”¨æ³•ï¼Œé‚£å°±æ˜¯ä¸é€šè¿‡æ¥å£ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡æ–¹æ³•åçš„æ–¹å¼æ¥è¿›è¡ŒæŸ¥è¯¢ï¼š 1session.selectList(&quot;com.lonelyWolf.mybatis.mapper.UserMapper.listAllUser&quot;); è¿™é‡Œå¦‚æœshortNameæ²¡æœ‰é‡å¤çš„è¯ï¼Œæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡ç®€å†™æ¥æŸ¥è¯¢çš„ï¼š 1session.selectList(&quot;listAllUser&quot;); ä½†æ˜¯é€šè¿‡ç®€å†™æ¥æŸ¥è¯¢ä¸€æ—¦shortNameé‡å¤äº†å°±ä¼šæŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š è¿™é‡Œçš„å¼‚å¸¸å…¶å®å°±æ˜¯StrickMapçš„getæ–¹æ³•æŠ›å‡ºæ¥çš„ï¼š sqlæ‰§è¡Œæµç¨‹åˆ†æä¸Šé¢æˆ‘ä»¬è®²åˆ°äº†ï¼Œè·å–åˆ°çš„Mapperæ¥å£å®é™…ä¸Šè¢«åŒ…è£…æˆä¸ºäº†ä»£ç†å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰§è¡ŒæŸ¥è¯¢è¯­å¥è‚¯å®šæ˜¯æ‰§è¡Œçš„ä»£ç†å¯¹è±¡æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»¥Mapperæ¥å£çš„ä»£ç†å¯¹è±¡MapperProxyæ¥åˆ†æä¸€ä¸‹æŸ¥è¯¢æµç¨‹ã€‚ æ•´ä¸ªsqlæ‰§è¡Œæµç¨‹å¯ä»¥åˆ†ä¸ºä¸¤å¤§æ­¥éª¤ï¼š ä¸€ã€å¯»æ‰¾sql äºŒã€æ‰§è¡Œsqlè¯­å¥ å¯»æ‰¾sqlé¦–å…ˆè¿˜æ˜¯æ¥çœ‹ä¸€ä¸‹å¯»æ‰¾sqlè¯­å¥çš„æ—¶åºå›¾ï¼š 1ã€äº†è§£ä»£ç†æ¨¡å¼çš„åº”è¯¥éƒ½çŸ¥é“ï¼Œè°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¹‹åå®é™…ä¸Šæ‰§è¡Œçš„å°±æ˜¯ä»£ç†å¯¹è±¡çš„invokeæ–¹æ³• 2ã€å› ä¸ºæˆ‘ä»¬è¿™é‡Œå¹¶æ²¡æœ‰è°ƒç”¨Objectç±»ä¸­çš„æ–¹æ³•ï¼Œæ‰€ä»¥è‚¯å®šèµ°çš„elseã€‚elseä¸­ä¼šç»§ç»­è°ƒç”¨MapperProxyå†…éƒ¨ç±»MapperMethodInvokerä¸­çš„æ–¹æ³•cachedInvokerï¼Œè¿™é‡Œé¢ä¼šæœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­ä¸€ä¸‹æˆ‘ä»¬æ˜¯ä¸æ˜¯defaultæ–¹æ³•ï¼Œå› ä¸ºJdk1.8ä¸­æ¥å£ä¸­å¯ä»¥æ–°å¢defaultæ–¹æ³•ï¼Œè€Œdefaultæ–¹æ³•æ˜¯å¹¶ä¸æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆåˆšå¼€å§‹ä¼šä»ç¼“å­˜é‡Œé¢å–ï¼Œç¼“å­˜ç›¸å…³çŸ¥è¯†æˆ‘ä»¬è¿™é‡Œå…ˆä¸è®²ï¼Œåé¢ä¼šå•ç‹¬å†™ä¸€ç¯‡æ¥åˆ†æä¸€ä¸‹ç¼“å­˜)ï¼‰ã€‚ 3ã€æ¥ä¸‹æ¥ï¼Œæ˜¯æ„é€ ä¸€ä¸ªMapperMethodå¯¹è±¡,è¿™ä¸ªå¯¹è±¡å°è£…äº†Mapperæ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•ä¿¡æ¯ä»¥åŠå¯¹åº”çš„sqlè¯­å¥ä¿¡æ¯ï¼š è¿™é‡Œé¢å°±ä¼šæŠŠè¦æ‰§è¡Œçš„sqlè¯­å¥ï¼Œè¯·æ±‚å‚æ•°ï¼Œæ–¹æ³•è¿”å›å€¼å…¨éƒ¨è§£æå°è£…æˆMapperMethodå¯¹è±¡ï¼Œç„¶ååé¢å°±å¯ä»¥å¼€å§‹å‡†å¤‡æ‰§è¡Œsqlè¯­å¥äº† æ‰§è¡Œsqlè¯­å¥è¿˜æ˜¯å…ˆæ¥çœ‹ä¸€ä¸‹æ‰§è¡ŒSqlè¯­å¥çš„æ—¶åºå›¾ï¼š 1ã€æˆ‘ä»¬ç»§ç»­ä¸Šé¢çš„æµç¨‹è¿›å…¥executeæ–¹æ³•ï¼š 2ã€è¿™é‡Œé¢ä¼šæ ¹æ®è¯­å¥ç±»å‹ä»¥åŠè¿”å›å€¼ç±»å‹æ¥å†³å®šå¦‚ä½•æ‰§è¡Œï¼Œæœ¬äººè¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªé›†åˆï¼Œæ•…è€Œæˆ‘ä»¬è¿›å…¥executeForManyæ–¹æ³•ï¼š 3ã€è¿™é‡Œé¢é¦–å…ˆä¼šå°†å‰é¢å­˜å¥½çš„å‚æ•°è¿›è¡Œä¸€æ¬¡è½¬æ¢ï¼Œç„¶åç»•äº†è¿™ä¹ˆä¸€åœˆï¼Œå›åˆ°äº†èµ·ç‚¹SqlSessionå¯¹è±¡ï¼Œç»§ç»­è°ƒç”¨selectListæ–¹æ³•ï¼š 3ã€æ¥ä¸‹æ¥åˆè®²æµç¨‹å§”æ´¾ç»™äº†Executeå»æ‰§è¡Œqueryæ–¹æ³•ï¼Œæœ€ç»ˆåˆä¼šå»è°ƒç”¨queryFromDatabaseæ–¹æ³•ï¼š 4ã€åˆ°è¿™é‡Œä¹‹åï¼Œç»ˆäºè¦è¿›å…¥æ­£é¢˜äº†ï¼Œä¸€èˆ¬å¸¦äº†è¿™ç§doå¼€å¤´çš„æ–¹æ³•å°±æ˜¯çœŸæ­£åšäº‹çš„ï¼ŒSpringä¸­å¾ˆå¤šåœ°æ–¹ä¹Ÿæ˜¯é‡‡ç”¨çš„è¿™ç§å‘½åæ–¹å¼ï¼š æ³¨æ„ï¼Œå‰é¢æˆ‘ä»¬çš„sqlè¯­å¥è¿˜æ˜¯å ä½ç¬¦çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰å°†å‚æ•°è®¾ç½®è¿›å»ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨returnä¸Šé¢ä¸€è¡Œè°ƒç”¨prepareStatementæ–¹æ³•åˆ›å»ºStatementå¯¹è±¡çš„æ—¶å€™ä¼šå»è®¾ç½®å‚æ•°ï¼Œæ›¿æ¢å ä½ç¬¦ã€‚å‚æ•°å¦‚ä½•è®¾ç½®æˆ‘ä»¬å…ˆè·³è¿‡ï¼Œç­‰æŠŠæµç¨‹æ‰§è¡Œå®Œäº†æˆ‘ä»¬åœ¨å•ç‹¬åˆ†æå‚æ•°æ˜ å°„å’Œç»“æœé›†æ˜ å°„ã€‚ 5ã€ç»§ç»­è¿›å…¥PreparedStatementHandlerå¯¹è±¡çš„queryæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€æ­¥å°±æ˜¯è°ƒç”¨äº†jdbcæ“ä½œå¯¹è±¡PreparedStatementä¸­çš„executeæ–¹æ³•ï¼Œæœ€åä¸€æ­¥å°±æ˜¯è½¬æ¢ç»“æœé›†ç„¶åè¿”å›ã€‚ åˆ°è¿™é‡Œï¼Œæ•´ä¸ªSQLè¯­å¥æ‰§è¡Œæµç¨‹åˆ†æå°±ç»“æŸäº†ï¼Œä¸­é€”æœ‰ä¸€äº›å‚æ•°çš„å­˜å‚¨ä»¥åŠè½¬æ¢å¹¶æ²¡æœ‰æ·±å…¥è¿›å»ï¼Œå› ä¸ºå‚æ•°çš„è½¬æ¢å¹¶ä¸æ˜¯æ ¸å¿ƒï¼Œåªè¦æ¸…æ¥šæ•´ä¸ªæ•°æ®çš„æµè½¬æµç¨‹ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„å®ç°æ–¹å¼ï¼Œåªè¦å­˜èµ·æ¥æœ€åæˆ‘ä»¬èƒ½é‡æ–°è§£æè¯»å‡ºæ¥å°±è¡Œã€‚ å‚æ•°æ˜ å°„ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸Šé¢åœ¨æ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰å‚æ•°æ˜¯å¦‚ä½•è¿›è¡Œè®¾ç½®çš„ï¼Œæˆ‘ä»¬å…ˆè¿›å…¥prepareStatementæ–¹æ³•ï¼š æˆ‘ä»¬å‘ç°ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨äº†StatementHandlerä¸­çš„parameterizeè¿›è¡Œå‚æ•°è®¾ç½®ï¼Œæ¥ä¸‹æ¥è¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œæˆ‘ä»¬ä¸ä¼šä¸€æ­¥æ­¥ç‚¹è¿›å»ï¼Œç›´æ¥è¿›å…¥è®¾ç½®å‚æ•°çš„æ–¹æ³•ï¼š ä¸Šé¢çš„BaseTypeHandleræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒsetNonNullParameterå¹¶æ²¡æœ‰å®ç°ï¼Œéƒ½æ˜¯äº¤ç»™å­ç±»å»å®ç°ï¼Œè€Œæ¯ä¸€ä¸ªå­ç±»å°±æ˜¯å¯¹åº”äº†æ•°æ®åº“çš„ä¸€ç§ç±»å‹ã€‚ä¸‹å›¾ä¸­å°±æ˜¯é»˜è®¤çš„ä¸€ä¸ªå­ç±»StringTypeHandlerï¼Œé‡Œé¢æ²¡ä»€ä¹ˆå…¶ä»–é€»è¾‘ï¼Œå°±æ˜¯è®¾ç½®å‚æ•°ã€‚ å¯ä»¥çœ‹åˆ°Stringé‡Œé¢è°ƒç”¨äº†jdbcä¸­çš„setStringæ–¹æ³•ï¼Œè€Œå¦‚æœæ˜¯intä¹Ÿä¼šè°ƒç”¨setIntæ–¹æ³•ã€‚çœ‹åˆ°è¿™äº›å­ç±»å¦‚æœå¤§å®¶ä¹‹å‰é˜…è¯»è¿‡æˆ‘å‰é¢è®²çš„MyBatiså‚æ•°é…ç½®ï¼Œåº”è¯¥å°±å¾ˆæ˜æ˜¾å¯ä»¥çŸ¥é“ï¼Œè¿™äº›å­ç±»å°±æ˜¯ç³»ç»Ÿé»˜è®¤æä¾›çš„ä¸€äº›typeHandlerã€‚è€Œè¿™äº›é»˜è®¤çš„typeHandlerä¼šé»˜è®¤è¢«æ³¨å†Œå¹¶å’ŒJavaå¯¹è±¡è¿›è¡Œç»‘å®šï¼š æ­£æ˜¯å› ä¸ºMyBatisä¸­é»˜è®¤æä¾›äº†å¸¸ç”¨æ•°æ®ç±»å‹çš„æ˜ å°„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™Sqlçš„æ—¶å€™æ‰å¯ä»¥çœç•¥å‚æ•°æ˜ å°„å…³ç³»ï¼Œå¯ä»¥ç›´æ¥é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼ï¼Œç³»ç»Ÿå¯ä»¥æ ¹æ®æˆ‘ä»¬å‚æ•°çš„ç±»å‹ï¼Œè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„typeHanderè¿›è¡Œæ˜ å°„ï¼š 1select user_id,user_name from lw_user where user_name=#&#123;userName&#125; ä¸Šé¢è¿™æ¡è¯­å¥å®é™…ä¸Šå’Œä¸‹é¢è¿™æ¡æ˜¯ç­‰ä»·çš„ï¼š 1select user_id,user_name from lw_user where user_name=#&#123;userName,jdbcType=VARCHAR&#125; æˆ–è€…è¯´æˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®štypeHandlerï¼š 1select user_id,user_name from lw_user where user_name = #&#123;userName,jdbcType=VARCHAR,typeHandler=org.apache.ibatis.type.IntegerTypeHandler&#125; è¿™é‡Œå› ä¸ºæˆ‘ä»¬é…ç½®äº†typeHandlerï¼Œæ‰€ä»¥ä¼šä¼˜å…ˆä»¥é…ç½®çš„typeHandlerä¸ºä¸»ä¸ä¼šå†å»è¯»å–é»˜è®¤çš„æ˜ å°„ï¼Œå¦‚æœç±»å‹ä¸åŒ¹é…å°±ä¼šç›´æ¥æŠ¥é”™äº†ï¼š çœ‹åˆ°è¿™é‡Œå¾ˆå¤šäººåº”è¯¥å°±çŸ¥é“äº†ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±è‡ªå®šä¹‰ä¸€ä¸ªtypeHandlerï¼Œç„¶åå°±å¯ä»¥é…ç½®æˆæˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰ç±»ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªtypeHandler è‡ªå®šä¹‰typeHandlerè‡ªå®šä¹‰typeHandleréœ€è¦å®ç°BaseTypeHandleræ¥å£ï¼ŒBaseTypeHandleræœ‰4ä¸ªæ–¹æ³•ï¼ŒåŒ…æ‹¬ç»“æœé›†æ˜ å°„ï¼Œä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œä»£ç æ²¡æœ‰å†™ä¸Šæ¥ï¼š 1234567891011121314151617package com.lonelyWolf.mybatis.typeHandler;import org.apache.ibatis.type.BaseTypeHandler;import org.apache.ibatis.type.JdbcType;import java.sql.CallableStatement;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;public class MyTypeHandler extends BaseTypeHandler&lt;String&gt; &#123; @Override public void setNonNullParameter(PreparedStatement preparedStatement, int index, String param, JdbcType jdbcType) throws SQLException &#123; System.out.println(&quot;è‡ªå®šä¹‰typeHandlerç”Ÿæ•ˆäº†&quot;); preparedStatement.setString(index,param); &#125; ç„¶åæˆ‘ä»¬æ”¹å†™ä¸€ä¸‹ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼š 1select user_id,user_name from lw_user where user_name=#&#123;userName,jdbcType=VARCHAR,typeHandler=com.lonelyWolf.mybatis.typeHandler.MyTypeHandler&#125; ç„¶åæ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè‡ªå®šä¹‰çš„typeHandlerç”Ÿæ•ˆäº†ï¼š ç»“æœé›†æ˜ å°„æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹ç»“æœé›†çš„æ˜ å°„ï¼Œå›åˆ°ä¸Šé¢æ‰§è¡Œsqlæµç¨‹çš„æœ€åä¸€ä¸ªæ–¹æ³•ï¼š 1resultSetHandler.handleResultSets(ps) ç»“æœé›†æ˜ å°„é‡Œé¢çš„é€»è¾‘ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æŒºå¤æ‚çš„ï¼Œå› ä¸ºè¦è€ƒè™‘åˆ°éå¸¸å¤šçš„æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸ä¼šå»æ·±ç©¶æ¯ä¸€ä¸ªç»†èŠ‚ï¼Œç›´æ¥è¿›å…¥åˆ°æ­£å¼è§£æç»“æœé›†çš„ä»£ç ï¼Œä¸‹é¢çš„5ä¸ªä»£ç ç‰‡æ®µå°±æ˜¯ä¸€ä¸ªç®€å•çš„ä½†æ˜¯å®Œæ•´çš„è§£ææµç¨‹ï¼š ä»ä¸Šé¢çš„ä»£ç ç‰‡æ®µæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šè§£æç»“æœé›†è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œå°±å¦‚æˆ‘ä»¬ä¸Šä¸€ç¯‡ä»‹ç»çš„å¤æ‚æŸ¥è¯¢ä¸€æ ·ï¼Œä¸€ä¸ªæŸ¥è¯¢å¯ä»¥ä¸æ–­åµŒå¥—å…¶ä»–æŸ¥è¯¢ï¼Œè¿˜æœ‰å»¶è¿ŸåŠ è½½ç­‰ç­‰ä¸€äº›å¤æ‚çš„ç‰¹æ€§çš„å¤„ç†ï¼Œæ‰€ä»¥é€»è¾‘åˆ†æ”¯æ˜¯æœ‰å¾ˆå¤šï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆå¤„ç†ï¼Œæœ€åçš„æ ¸å¿ƒè¿˜æ˜¯ä¸Šé¢çš„ä¸€å¥—æµç¨‹ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šè°ƒç”¨typeHandleræ¥è·å–æŸ¥è¯¢åˆ°çš„ç»“æœã€‚ æ˜¯çš„ï¼Œä½ æ²¡çŒœé”™ï¼Œè¿™ä¸ªå°±æ˜¯ä¸Šé¢æˆ‘ä»¬æ˜ å°„å‚æ•°çš„typeHandlerï¼Œå› ä¸ºtypeHandleré‡Œé¢ä¸åªæ˜¯ä¸€ä¸ªè®¾ç½®å‚æ•°æ–¹æ³•ï¼Œè¿˜æœ‰è·å–ç»“æœé›†æ–¹æ³•(ä¸Šé¢è®¾ç½®å‚æ•°çš„æ—¶å€™çœç•¥äº†)ã€‚ è‡ªå®šä¹‰typeHandlerç»“æœé›†æ‰€ä»¥è¯´æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸Šé¢é‚£ä¸ªMyTypeHandler ä¾‹å­æ¥é‡å†™ä¸€ä¸‹å–å€¼æ–¹æ³•(çœç•¥äº†è®¾ç½®å‚æ•°æ–¹æ³•)ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.lonelyWolf.mybatis.typeHandler;import org.apache.ibatis.type.BaseTypeHandler;import org.apache.ibatis.type.JdbcType;import java.sql.CallableStatement;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;public class MyTypeHandler extends BaseTypeHandler&lt;String&gt; &#123; /** * è®¾ç½®å‚æ•° */ @Override public void setNonNullParameter(PreparedStatement preparedStatement, int index, String param, JdbcType jdbcType) throws SQLException &#123; System.out.println(&quot;è®¾ç½®å‚æ•°-&gt;è‡ªå®šä¹‰typeHandlerç”Ÿæ•ˆäº†&quot;); preparedStatement.setString(index,param); &#125; /** * æ ¹æ®åˆ—åè·å–ç»“æœ */ @Override public String getNullableResult(ResultSet resultSet, String columnName) throws SQLException &#123; System.out.println(&quot;æ ¹æ®columnNameè·å–ç»“æœ-&gt;è‡ªå®šä¹‰typeHandlerç”Ÿæ•ˆäº†&quot;); return resultSet.getString(columnName); &#125; /** * æ ¹æ®åˆ—çš„ä¸‹æ ‡æ¥è·å–ç»“æœ */ @Override public String getNullableResult(ResultSet resultSet, int columnIndex) throws SQLException &#123; System.out.println(&quot;æ ¹æ®columnIndexè·å–ç»“æœ-&gt;è‡ªå®šä¹‰typeHandlerç”Ÿæ•ˆäº†&quot;); return resultSet.getString(columnIndex); &#125; /** * å¤„ç†å­˜å‚¨è¿‡ç¨‹çš„ç»“æœé›† */ @Override public String getNullableResult(CallableStatement callableStatement, int columnIndex) throws SQLException &#123; return callableStatement.getString(columnIndex); &#125;&#125; æ”¹å†™Mapperæ˜ å°„æ–‡ä»¶é…ç½®ï¼š 12345678&lt;resultMap id=&quot;MyUserResultMap&quot; type=&quot;lwUser&quot;&gt; &lt;result column=&quot;user_id&quot; property=&quot;userId&quot; jdbcType=&quot;VARCHAR&quot; typeHandler=&quot;com.lonelyWolf.mybatis.typeHandler.MyTypeHandler&quot; /&gt; &lt;result column=&quot;user_name&quot; property=&quot;userName&quot; jdbcType=&quot;VARCHAR&quot; /&gt;&lt;/resultMap&gt;&lt;select id=&quot;listUserByUserName&quot; parameterType=&quot;String&quot; resultMap=&quot;MyUserResultMap&quot;&gt; select user_id,user_name from lw_user where user_name=#&#123;userName,jdbcType=VARCHAR,typeHandler=com.lonelyWolf.mybatis.typeHandler.MyTypeHandler&#125;&lt;/select&gt; æ‰§è¡Œä¹‹åè¾“å‡ºå¦‚ä¸‹ï¼š å› ä¸ºæˆ‘ä»¬å±æ€§ä¸Šé¢åªé…ç½®äº†ä¸€ä¸ªå±æ€§ï¼Œæ‰€ä»¥åªè¾“å‡ºäº†ä¸€æ¬¡ã€‚ å·¥ä½œæµç¨‹å›¾ä¸Šé¢ä»‹ç»äº†ä»£ç çš„æµè½¬ï¼Œå¯èƒ½ç»•æ¥ç»•å»æœ‰ç‚¹æ™•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ç”»ä¸€ä¸ªä¸»è¦çš„å¯¹è±¡ä¹‹é—´æµç¨‹å›¾æ¥æ›´åŠ æ¸…æ™°çš„å±•ç¤ºä¸€ä¸‹MyBatisä¸»è¦å·¥ä½œæµç¨‹ï¼š ä»ä¸Šé¢çš„å·¥ä½œæµç¨‹å›¾ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSqlSessionä¸‹é¢è¿˜æœ‰4å¤§å¯¹è±¡ï¼Œè¿™4å¤§å¯¹è±¡ä¹Ÿå¾ˆé‡è¦ï¼Œåé¢å­¦ä¹ æ‹¦æˆªå™¨çš„æ—¶å€™å°±æ˜¯é’ˆå¯¹è¿™4å¤§å¯¹è±¡è¿›è¡Œçš„æ‹¦æˆªï¼Œå…³äºè¿™4å¤§å¯¹è±¡çš„å…·ä½“è¯¦æƒ…ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« å†å±•å¼€åˆ†æã€‚ æ€»ç»“æœ¬æ–‡ä¸»è¦åˆ†æäº†MyBatisçš„SQLæ‰§è¡Œæµç¨‹ã€‚åœ¨åˆ†ææµç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸¾ä¾‹è®ºè¯äº†å¦‚ä½•è‡ªå®šä¹‰typeHandleræ¥å®ç°è‡ªå®šä¹‰çš„å‚æ•°æ˜ å°„å’Œç»“æœé›†æ˜ å°„ï¼Œä¸è¿‡MyBatisä¸­æä¾›çš„é»˜è®¤æ˜ å°„å…¶å®å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æŸäº›å±æ€§éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨è‡ªå®šä¹‰çš„typeHandleræ¥å®ç°ï¼Œç›¸ä¿¡å¦‚æœæœ¬æ–‡å¦‚æœè¯»æ‡‚äº†ï¼Œä»¥ä¸‹å‡ ç‚¹å¤§å®¶åº”è¯¥è‡³å°‘ä¼šæœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤è¯†ï¼š 1ã€Mapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶æ˜¯å¦‚ä½•è¿›è¡Œç»‘å®šçš„ 2ã€MyBatisä¸­SQLè¯­å¥çš„æ‰§è¡Œæµç¨‹ 3ã€è‡ªå®šä¹‰MyBatisä¸­çš„å‚æ•°è®¾ç½®å¤„ç†å™¨typeHandler 4ã€è‡ªå®šä¹‰MyBatisä¸­ç»“æœé›†å¤„ç†å™¨typeHandler å½“ç„¶ï¼Œå…¶ä¸­å¾ˆå¤šç»†èŠ‚å¹¶æ²¡æœ‰æåˆ°ï¼Œè€Œçœ‹æºç æˆ‘ä»¬ä¹Ÿå¹¶ä¸éœ€è¦è¿½æ±‚æ¯ä¸€è¡Œä»£ç éƒ½èƒ½çœ‹æ‡‚ï¼Œå°±æ¯”å¦‚æˆ‘ä»¬ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œå³ä½¿æˆ‘ä»¬æ˜¯é¡¹ç›®å¼€å‘è€…å¦‚æœæŸä¸€ä¸ªæ¨¡å—ä¸æ˜¯æœ¬äººè´Ÿè´£çš„ï¼Œææ€•ä¹Ÿå¾ˆéš¾ææ¸…æ¥šæ¯ä¸€è¡Œä»£ç çš„å«ä¹‰ã€‚æ‰€ä»¥å¯¹äºMyBatisåŠå…¶ä»–æ¡†æ¶çš„æºç ä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼Œé¦–å…ˆåº”è¯¥ä»å¤§å±€å…¥æ‰‹ï¼ŒæŒæ¡æ•´ä½“æµç¨‹å’Œè®¾è®¡æ€æƒ³ï¼Œç„¶åå¦‚æœå¯¹æŸäº›å®ç°ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œå†æ·±å…¥è¿›è¡Œäº†è§£ã€‚","tags":["MyBatis","æ¡†æ¶"],"categories":["æ¡†æ¶"]},{"title":"ç”¨â€œçŠ¶æ€æ¨¡å¼â€ä»£æ›¿if-else","path":"/2023/12/24/ç”¨â€œçŠ¶æ€æ¨¡å¼â€ä»£æ›¿if-else/","content":"ç®€ä»‹ çŠ¶æ€æ¨¡å¼æ˜¯è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼çš„ä¸€ç§ã€‚å…¶è®¾è®¡ç†å¿µæ˜¯å½“å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œéšä¹‹æ”¹å˜å…¶è¡Œä¸ºã€‚çŠ¶æ€å’Œè¡Œä¸ºä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ è¯¥æ¨¡å¼ä¸»è¦ç”¨äºï¼Œå¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å…¶è¡Œä¸ºæ˜¯éšç€çŠ¶æ€çš„æ”¹å˜è€Œåˆ‡æ¢æ—¶ã€‚ çŠ¶æ€æ¨¡å¼UMLç±»å›¾ç±»å›¾è®²è§£ Stateï¼šæŠ½è±¡çŠ¶æ€æ¥å£ï¼ˆä¹Ÿå¯ä»¥å®šä¹‰æˆæŠ½è±¡ç±»ï¼‰ï¼Œè¯¥æ¥å£å°è£…äº†æ‰€æœ‰çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚ConcreteStateA&#x2F;Bï¼šå…·ä½“çŠ¶æ€ç±»ï¼Œè¯¥ç±»å®ç°äº†æŠ½è±¡çŠ¶æ€æ¥å£ï¼Œä¼šæ ¹æ®è‡ªèº«å¯¹åº”çš„çŠ¶æ€æ¥å®ç°æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯æŒ‡æ˜å¦‚ä½•è¿‡æ¸¡åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚Contextï¼šç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰è§’è‰²ï¼Œè¯¥ç±»è´Ÿè´£çŠ¶æ€çš„åˆ‡æ¢ï¼Œè¿˜æŒæœ‰ä¸€ä¸ªStateå®ä¾‹ï¼Œä»£è¡¨å½“å‰ç¯å¢ƒæ‰€å¤„çŠ¶æ€ã€‚ æ¡ˆä¾‹è®²è§£æ¡ˆä¾‹ï¼šé€šè¿‡çŠ¶æ€æ¨¡å¼æ¥å®ç°è‡ªåŠ©å”®å–æœºçš„åŠŸèƒ½ã€‚ çŠ¶æ€æ¥å£12345678public interface State &#123; // æŒ‘é€‰å•†å“ void choose(); // ä»˜æ¬¾ boolean payment(); // åˆ†å‘å•†å“ void dispenseCommodity();&#125; æŒ‘é€‰å•†å“çŠ¶æ€ç±»123456789101112131415161718192021222324252627282930public class ChooseGoods implements State &#123; VendingMachine machine; public ChooseGoods(VendingMachine machine) &#123; this.machine = machine; &#125; @Override public void choose() &#123; if (machine.getCount() &gt; 0) &#123; System.out.println(&quot;å•†å“æŒ‘é€‰æˆåŠŸï¼Œè¯·åŠæ—¶ä»˜æ¬¾ï¼&quot;); machine.setState(machine.getPaymentState()); &#125; else &#123; System.out.println(&quot;å¾ˆé—æ†¾ï¼Œå•†å“å”®ç½„äº†ï¼&quot;); machine.setState(machine.getEmptyState()); &#125; &#125; @Override public boolean payment() &#123; System.out.println(&quot;è¯·å…ˆæŒ‘é€‰å•†å“ï¼&quot;); return false; &#125; @Override public void dispenseCommodity() &#123; System.out.println(&quot;è¯·å…ˆæŒ‘é€‰å•†å“ï¼&quot;); &#125;&#125; ä»˜æ¬¾çŠ¶æ€ç±»12345678910111213141516171819202122232425262728293031public class PaymentState implements State &#123; VendingMachine machine; public PaymentState(VendingMachine machine) &#123; this.machine = machine; &#125; @Override public void choose() &#123; System.out.println(&quot;å•†å“å·²é€‰è´­å®Œæˆè¯·å‹¿é‡å¤æŒ‘é€‰&quot;); &#125; @Override public boolean payment() &#123; Random random = new Random(); int num = random.nextInt(10); if(num % 2 == 0)&#123; System.out.println(&quot;ä»˜æ¬¾æˆåŠŸï¼&quot;); machine.setState(machine.getDispenseCommodityState()); return true; &#125; System.out.println(&quot;ä»˜æ¬¾å¤±è´¥ï¼Œè¯·é‡æ–°æ”¯ä»˜ï¼&quot;); return false; &#125; @Override public void dispenseCommodity() &#123; System.out.println(&quot;è¯·å…ˆå®Œæˆæ”¯ä»˜ï¼&quot;); &#125;&#125; å•†å“å”®ç½„çŠ¶æ€ç±»123456789101112131415161718192021222324public class EmptyState implements State &#123; VendingMachine machine; public EmptyState(VendingMachine machine) &#123; this.machine = machine; &#125; @Override public void choose() &#123; System.out.println(&quot;å¯¹ä¸èµ·å•†å“å·²å”®ç½„ï¼&quot;); &#125; @Override public boolean payment() &#123; System.out.println(&quot;å¯¹ä¸èµ·å•†å“å·²å”®ç½„ï¼&quot;); return false; &#125; @Override public void dispenseCommodity() &#123; System.out.println(&quot;å¯¹ä¸èµ·å•†å“å·²å”®ç½„ï¼&quot;); &#125;&#125; åˆ†å‘å•†å“çŠ¶æ€ç±»12345678910111213141516171819202122232425public class DispenseCommodityState implements State &#123; VendingMachine machine; public DispenseCommodityState(VendingMachine machine) &#123; this.machine = machine; &#125; @Override public void choose() &#123; System.out.println(&quot;è¯·åŠæ—¶å–èµ°æ‚¨çš„å•†å“ï¼&quot;); &#125; @Override public boolean payment() &#123; System.out.println(&quot;è¯·åŠæ—¶å–èµ°æ‚¨çš„å•†å“ï¼&quot;); return false; &#125; @Override public void dispenseCommodity() &#123; System.out.println(&quot;è¯·åŠæ—¶å–èµ°æ‚¨çš„å•†å“ï¼&quot;); machine.setState(machine.getChooseGoods()); &#125;&#125; è‡ªåŠ¨å”®è´§æœº &#x3D;&gt; Contextè§’è‰²123456789101112131415161718192021222324252627282930313233public class VendingMachine &#123; // è¡¨ç¤ºå½“å‰çŠ¶æ€ private State state = null; // å•†å“æ•°é‡ private int count = 0; private State chooseGoods = new ChooseGoods(this); private State paymentState = new PaymentState(this); private State dispenseCommodityState = new DispenseCommodityState(this); private State emptyState = new EmptyState(this); public VendingMachine(int count) &#123; this.count = count; this.state = this.getChooseGoods(); &#125; // è´­ä¹°å•†å“ public void purchase() &#123; // æŒ‘é€‰å•†å“ state.choose(); // æ”¯ä»˜æˆåŠŸ if (state.payment()) &#123; // åˆ†å‘å•†å“ state.dispenseCommodity(); &#125; &#125; // è·å–å•†å“åå°†å•†å“å‡ä¸€ public int getCount() &#123; return count--; &#125; // getå’Œsetæ–¹æ³• ... &#125; å®¢æˆ·ç«¯æµ‹è¯•ç±»12345678910public class Client &#123; public static void main(String[] args) &#123; VendingMachine machine = new VendingMachine(1); for (int i = 1; i &lt; 4; i++) &#123; System.out.println(&quot;ç¬¬&quot; + i + &quot;æ¬¡è´­ä¹°ã€‚&quot;); machine.purchase(); &#125; &#125;&#125; æ‰§è¡Œç»“æœæ€»ç»“1ã€çŠ¶æ€æ¨¡å¼å°†æ¯ä¸ªçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºå°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¤§å¤§æé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚å¹¶ä¸”é€šè¿‡è¿™æ ·çš„è®¾è®¡è¿˜å¯ä»¥æ¶ˆé™¤å¤šä½™çš„if-elseè¯­å¥ï¼Œæ–¹ä¾¿ä»£ç çš„ç»´æŠ¤ã€‚ 2ã€çŠ¶æ€æ¨¡å¼ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ï¼Œå®¹æ˜“å¢åŠ å’Œåˆ é™¤çŠ¶æ€ã€‚ 3ã€ä»»ä½•äº‹æƒ…éƒ½æœ‰åˆ©å¼Šï¼ŒçŠ¶æ€æ¨¡å¼ä¹Ÿä¸ä¾‹å¤–ã€‚å…¶æœ€æ˜¾è‘—çš„é—®é¢˜æ˜¯ï¼Œæ¯ä¸ªçŠ¶æ€éƒ½è¦å¯¹åº”ä¸€ä¸ªç±»ï¼Œå½“çŠ¶æ€è¿‡å¤šæ—¶ä¼šäº§ç”Ÿå¤§é‡çš„ç±»ï¼Œä»è€ŒåŠ å¤§ç»´æŠ¤æˆæœ¬ã€‚ 4ã€åº”ç”¨åœºæ™¯ï¼šå½“ä¸€ä¸ªéœ€æ±‚æœ‰å¾ˆå¤šçŠ¶æ€ï¼Œå¹¶ä¸”çŠ¶æ€ä¹‹é—´ä¼šè¿›è¡Œè½¬æ¢ï¼Œä¸åŒçŠ¶æ€è¿˜å¯¹åº”ä¸åŒçš„è¡Œä¸ºæ—¶å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨â€œçŠ¶æ€æ¨¡å¼â€ã€‚","tags":["è®¾è®¡æ¨¡å¼"],"categories":["è®¾è®¡æ¨¡å¼"]},{"title":"Google å¼€æºçš„ Guava å·¥å…·åº“","path":"/2023/12/24/Google-å¼€æºçš„-Guava-å·¥å…·åº“/","content":"ç›®å‰Google Guavaåœ¨å®é™…åº”ç”¨ä¸­éå¸¸å¹¿æ³›ï¼Œæœ¬ç¯‡åšå®¢å°†ä»¥åšä¸»å¯¹Guavaä½¿ç”¨çš„è®¤è¯†ä»¥åŠåœ¨é¡¹ç›®ä¸­çš„ç»éªŒæ¥ç»™å¤§å®¶åˆ†äº«ï¼æ­£å¦‚æ ‡é¢˜æ‰€è¨€ï¼Œå­¦ä¹ ä½¿ç”¨Google Guavaå¯ä»¥è®©ä½ å¿«ä¹ç¼–ç¨‹ï¼Œå†™å‡ºä¼˜é›…çš„JAVAä»£ç ï¼ ä»¥é¢å‘å¯¹è±¡æ€æƒ³å¤„ç†å­—ç¬¦ä¸²:Joiner&#x2F;Splitter&#x2F;CharMatcher JDKæä¾›çš„Stringè¿˜ä¸å¤Ÿå¥½ä¹ˆï¼Ÿ ä¹Ÿè®¸è¿˜ä¸å¤Ÿå‹å¥½ï¼Œè‡³å°‘è®©æˆ‘ä»¬ç”¨èµ·æ¥è¿˜ä¸å¤Ÿçˆ½ï¼Œè¿˜å¾—æ“å¿ƒï¼ ä¸¾ä¸ªæ —å­ï¼Œæ¯”å¦‚Stringæä¾›çš„splitæ–¹æ³•ï¼Œæˆ‘ä»¬å¾—å…³å¿ƒç©ºå­—ç¬¦ä¸²å§ï¼Œè¿˜å¾—è€ƒè™‘è¿”å›çš„ç»“æœä¸­å­˜åœ¨nullå…ƒç´ å§ï¼Œåªæä¾›äº†å‰åtrimçš„æ–¹æ³•ï¼ˆå¦‚æœæˆ‘æƒ³å¯¹ä¸­é—´å…ƒç´ è¿›è¡Œtrimå‘¢ï¼‰ã€‚ é‚£ä¹ˆï¼Œçœ‹ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ï¼Œguavaè®©ä½ ä¸å¿…åœ¨æ“å¿ƒè¿™äº›ï¼š 123456789101112131415// è¿æ¥å™¨private static final Joiner joiner = Joiner.on(&quot;,&quot;).skipNulls();// åˆ†å‰²å™¨private static final Splitter splitter = Splitter.on(&quot;,&quot;).trimResults().omitEmptyStrings();public static void main(String[] args) &#123; // æŠŠé›†åˆ/æ•°ç»„ä¸­çš„å…ƒç´  join åœ¨ä¸€èµ· String join = joiner.join(Lists.newArrayList(&quot;a&quot;, null, &quot;b&quot;)); System.out.println(&quot;join=&quot; + join); for(String tmp : splitter.split(&quot;a, ,b,,&quot;)) &#123; System.out.println(&quot;|&quot; + tmp + &quot;|&quot;); &#125;&#125; Joiner&#x2F;Splitter Joineræ˜¯è¿æ¥å™¨ï¼ŒSplitteræ˜¯åˆ†å‰²å™¨ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæŠŠå®ƒä»¬å®šä¹‰ä¸ºstatic finalï¼Œåˆ©ç”¨onç”Ÿæˆå¯¹è±¡ååœ¨åº”ç”¨åˆ°Stringè¿›è¡Œå¤„ç†ï¼Œè¿™æ˜¯å¯ä»¥å¤ç”¨çš„ã€‚è¦çŸ¥é“apache commons StringUtilsæä¾›çš„éƒ½æ˜¯static methodã€‚ æ›´åŠ é‡è¦çš„æ˜¯ï¼Œguavaæä¾›çš„Joiner&#x2F;Splitteræ˜¯ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œå®ƒçš„ç¨³å®šæ€§å’Œæ•ˆç‡è¦æ¯”apacheé«˜å‡ºä¸å°‘ï¼Œè¿™ä¸ªä½ å¯ä»¥è‡ªè¡Œæµ‹è¯•ä¸‹~ å‘ç°æ²¡æœ‰æˆ‘ä»¬æƒ³å¯¹Stringåšä»€ä¹ˆæ“ä½œï¼Œå°±æ˜¯ç”Ÿæˆè‡ªå·±å®šåˆ¶åŒ–çš„Joiner&#x2F;Splitterï¼Œå¤šä¹ˆç›´ç™½ï¼Œç®€å•ï¼Œæµç•…çš„APIï¼ å¯¹äºJoinerï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯ è·³è¿‡NULLå…ƒç´ ï¼šskipNulls() &#x2F; å¯¹äºNULLå…ƒç´ ä½¿ç”¨å…¶ä»–æ›¿ä»£ï¼šuseForNull(String) å¯¹äºSplitterï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯ï¼štrimResults()&#x2F;omitEmptyStrings()ã€‚æ³¨æ„æ‹†åˆ†çš„æ–¹å¼ï¼Œæœ‰å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰æ­£åˆ™ï¼Œè¿˜æœ‰å›ºå®šé•¿åº¦åˆ†å‰²ï¼ˆå¤ªè´´å¿ƒäº†ï¼ï¼‰ å…¶å®é™¤äº†Joiner&#x2F;Splitterå¤–ï¼Œguavaè¿˜æä¾›äº†å­—ç¬¦ä¸²åŒ¹é…å™¨ï¼šCharMatcher 123456789101112private static final CharMatcher charMatcherDigit = CharMatcher.DIGIT;private static final Charmatcher charMatcherAny = CharMatcher.ANY;public static void main(String[] args) &#123; // åªä¿ç•™åŒ¹é…çš„å­—ç¬¦ï¼Œå…¶ä»–ç§»é™¤ System.out.println(charMatcherDigit.retainFrom(&quot;abc2def134f~&quot;)); // ç§»é™¤åŒ¹é…çš„å­—ç¬¦ System.out.println(charMatcherDigit.removeFrom(&quot;yes,i love you 1314&quot;)); System.out.println(charMatcherAny.inRange(&#x27;a&#x27;, &#x27;f&#x27;).or(charMatcherAny.is(&#x27;a&#x27;)).replaceFrom(&quot;abcdefg&quot;,&quot;*&quot;));&#125; CharMatcher CharMatcherï¼Œå°†å­—ç¬¦çš„åŒ¹é…å’Œå¤„ç†è§£è€¦ï¼Œå¹¶æä¾›ä¸°å¯Œçš„æ–¹æ³•ä¾›ä½ ä½¿ç”¨ï¼ å¯¹åŸºæœ¬ç±»å‹è¿›è¡Œæ”¯æŒ guavaå¯¹JDKæä¾›çš„åŸç”Ÿç±»å‹æ“ä½œè¿›è¡Œäº†æ‰©å±•ï¼Œä½¿å¾—åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼ 1234567891011121314151617// å¿«é€Ÿå®Œæˆåˆ°é›†åˆçš„è½¬æ¢List&lt;Integer&gt; list = Ints.asList(1, 3, 5, 7, 9);System.out.println(Ints.join(&quot;,&quot;, 1, 3, 1, 4));// åŸç”Ÿç±»å‹æ•°æ®å¿«é€Ÿåˆå¹¶int[] newIntArray = Ints.concat(new int[]&#123;1, 2&#125;, new int[]&#123;2, 3, 4&#125;);System.out.println(newIntArray.length);// æœ€å¤§/æœ€å°System.out.println(Ints.max(newIntArray) + &quot;,&quot; + Ints.min(newIntArray));// æ˜¯å¦åŒ…å«System.out.println(Ints.contains(newArray, 6));// é›†åˆåˆ°æ•°ç»„çš„è½¬æ¢int[] someArray = Ints.toArray(list); Ints guavaæä¾›äº† Bytes&#x2F;Shorts&#x2F;Ints&#x2F;Iongs&#x2F;Floats&#x2F;Doubles&#x2F;Chars&#x2F;Booleans è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹çš„æ‰©å±•æ”¯æŒï¼Œåªæœ‰ä½ æƒ³ä¸åˆ°çš„ï¼Œæ²¡æœ‰å®ƒæ²¡æœ‰çš„ï¼ å¯¹JDKé›†åˆçš„æœ‰æ•ˆè¡¥å……ç°è‰²åœ°å¸¦:Multiset JDKçš„é›†åˆï¼Œæä¾›äº†æœ‰åºä¸”å¯ä»¥é‡å¤çš„Listï¼Œæ— åºä¸”ä¸å¯ä»¥é‡å¤çš„Setã€‚é‚£è¿™é‡Œå…¶å®å¯¹äºé›†åˆæ¶‰åŠåˆ°äº†2ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªorderï¼Œä¸€ä¸ªdupsã€‚é‚£ä¹ˆList vs Setï¼Œand then some ? Multiset Multisetæ˜¯ä»€ä¹ˆï¼Œæˆ‘æƒ³ä¸Šé¢çš„å›¾ï¼Œä½ åº”è¯¥äº†è§£å®ƒçš„æ¦‚å¿µäº†ã€‚Multisetå°±æ˜¯æ— åºçš„ï¼Œä½†æ˜¯å¯ä»¥é‡å¤çš„é›†åˆï¼Œå®ƒå°±æ˜¯æ¸¸ç¦»åœ¨List&#x2F;Setä¹‹é—´çš„â€œç°è‰²åœ°å¸¦â€ï¼ï¼ˆè‡³äºæœ‰åºçš„ï¼Œä¸å…è®¸é‡å¤çš„é›†åˆå˜›ï¼Œguavaè¿˜æ²¡æœ‰æä¾›ï¼Œå½“ç„¶åœ¨æœªæ¥åº”è¯¥ä¼šæä¾›UniqueListï¼Œæˆ‘çŒœçš„ï¼Œå“ˆå“ˆï¼‰ æ¥çœ‹ä¸€ä¸ªMultisetçš„ç¤ºä¾‹ï¼š 12345678910Multiset&lt;String&gt; multiset = HashMultiset.create();multiset.add(&quot;a&quot;);multiset.add(&quot;a&quot;);multiset.add(&quot;b&quot;);multiset.add(&quot;c&quot;);multiset.add(&quot;b&quot;);System.out.println(multiset.size());System.out.println(multiset.count(&quot;a&quot;)); Multiset Code Multisetè‡ªå¸¦ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ï¼Œå°±æ˜¯å¯ä»¥è·Ÿè¸ªæ¯ä¸ªå¯¹è±¡çš„æ•°é‡ã€‚ Immutable vs unmodifiableæ¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªunmodifiableçš„ä¾‹å­ï¼š 1234567891011121314// List çš„ä¸å¯å˜è®¾ç½®List&lt;String&gt; list = new ArrayList&lt;String&gt;();list.add(&quot;a&quot;);list.add(&quot;b&quot;);// è¿™ç§è§†å›¾ï¼Œä¸å¤Ÿå®‰å…¨ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¿«ç…§ï¼Œæ€ä¹ˆèƒ½éšç€è€Œå˜åŒ–å‘¢ï¼ŸList&lt;String&gt; readOnlyList = Collections.unmodifiableList(list);// readOnlyList.add(&quot;c&quot;);// æŠ›å¼‚å¸¸ï¼šjava.lang.UnsupportedOperationExceptionlist.acc(&quot;c&quot;);System.out.println(reaOnlyList.size()); // 3 unmodifiable ä½ çœ‹åˆ°JDKæä¾›çš„unmodifiableçš„ç¼ºé™·äº†å—ï¼Ÿ å®é™…ä¸Šï¼ŒCollections.unmodifiableXxxæ‰€è¿”å›çš„é›†åˆå’Œæºé›†åˆæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªä¸è¿‡å¯ä»¥å¯¹é›†åˆåšå‡ºæ”¹å˜çš„APIéƒ½è¢«overrideï¼Œä¼šæŠ›å‡ºUnsupportedOperationExceptionã€‚ ä¹Ÿå³æ˜¯è¯´æˆ‘ä»¬æ”¹å˜æºé›†åˆï¼Œå¯¼è‡´ä¸å¯å˜è§†å›¾ï¼ˆunmodifiable Viewï¼‰ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œoh my god! å½“ç„¶ï¼Œåœ¨ä¸ä½¿ç”¨guavaçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯æ€ä¹ˆé¿å…ä¸Šé¢çš„é—®é¢˜çš„å‘¢ï¼Ÿ 1234567// List çš„ä¸å¯å˜æ€§è®¾ç½®List&lt;String&gt; list = new ArrayList&lt;~&gt;();list.add(&quot;a&quot;);list.add(&quot;b&quot;);// new Object ; CopyList&lt;String&gt; readOnList = Collections.unmodifiableList(new ArrayList&lt;String&gt;(list)); defensive copies ä¸Šé¢æ­ç¤ºäº†ä¸€ä¸ªæ¦‚å¿µï¼šDefensive Copiesï¼Œä¿æŠ¤æ€§æ‹·è´ã€‚ OKï¼Œunmodifiableçœ‹ä¸Šå»æ²¡æœ‰é—®é¢˜å‘¢ï¼Œä½†æ˜¯guavaä¾ç„¶è§‰å¾—å¯ä»¥æ”¹è¿›ï¼Œäºæ˜¯æå‡ºäº†Immutableçš„æ¦‚å¿µï¼Œæ¥çœ‹ï¼š 12345678910// guava æ˜¯å¦‚ä½•åšçš„å‘¢ï¼ŸList&lt;String&gt; immutable = ImmutabeList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);// immutable.add(&quot;d&quot;);// æŠ›å¼‚å¸¸ï¼šjava.lang.UnsupportedOperationExceptionList&lt;String&gt; immutable2 = ImmutableList.copyOf(list);list.add(&quot;d&quot;);// è§†å›¾ä¸éšç€æºè€Œæ”¹å˜ guava åªè¯»è®¾ç½®å®‰å…¨å¯é  ç®€å•æ˜“ç”¨System.out.println(&quot;list size:&quot; + list.size() + &quot; immutable2.size:&quot; + immutables.size()); Immutable å°±ä¸€ä¸ªcopyOfï¼Œä½ ä¸ä¼šå¿˜è®°ï¼Œå¦‚æ­¤cheap~ ç”¨Googleå®˜æ–¹çš„è¯´æ³•æ˜¯ï¼šweâ€™re using just one class,just say exactly what we meanï¼Œå¾ˆäº†ä¸èµ·å—ï¼ˆä¸ä»…ä»…æ˜¯ä¸ªæ¦‚å¿µï¼ŒImmutableåœ¨COPYé˜¶æ®µè¿˜è€ƒè™‘äº†çº¿ç¨‹çš„å¹¶å‘æ€§ç­‰ï¼Œå¾ˆæ™ºèƒ½çš„ï¼ï¼‰ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ guavaæä¾›äº†å¾ˆå¤šImmutableé›†åˆï¼Œæ¯”å¦‚ ImmutableList&#x2F;ImmutableSet&#x2F;ImmutableSortedSet&#x2F;ImmutableMap&#x2F;â€¦â€¦ çœ‹ä¸€ä¸ªImmutableMapçš„ä¾‹å­ï¼š 123ImmutableMap&lt;String, String&gt; immutableMap = ImmutableMap.of(&quot;name&quot;, &quot;hubert&quot;, &quot;sex&quot;, &quot;man&quot;);immutableMap.put(&quot;wife&quot;, &quot;no...&quot;); // UnsupportedOperationException ImmutableMap å¯ä¸å¯ä»¥ä¸€å¯¹å¤šï¼šMultimap JDKæä¾›ç»™æˆ‘ä»¬çš„Mapæ˜¯ä¸€ä¸ªé”®ï¼Œä¸€ä¸ªå€¼ï¼Œä¸€å¯¹ä¸€çš„ï¼Œé‚£ä¹ˆåœ¨å®é™…å¼€å‘ä¸­ï¼Œæ˜¾ç„¶å­˜åœ¨ä¸€ä¸ªKEYå¤šä¸ªVALUEçš„æƒ…å†µï¼ˆæ¯”å¦‚ä¸€ä¸ªåˆ†ç±»ä¸‹çš„ä¹¦æœ¬ï¼‰ï¼Œæˆ‘ä»¬å¾€å¾€è¿™æ ·è¡¨è¾¾ï¼šMap&lt;k,List&lt;v&gt;&gt;ï¼Œå¥½åƒæœ‰ç‚¹è‡ƒè‚¿ï¼è‡ƒè‚¿ä¹Ÿå°±ç®—äº†ï¼Œæ›´åŠ ä¸çˆ½çš„äº‹ï¼Œæˆ‘ä»¬è¿˜å¾—åˆ¤æ–­KEYæ˜¯å¦å­˜åœ¨æ¥å†³å®šæ˜¯å¦new ä¸€ä¸ªLISTå‡ºæ¥ï¼Œæœ‰ç‚¹éº»çƒ¦ï¼æ›´åŠ éº»çƒ¦çš„äº‹æƒ…è¿˜åœ¨åå¤´ï¼Œæ¯”å¦‚éå†ï¼Œæ¯”å¦‚åˆ é™¤ï¼Œso hardâ€¦â€¦ æ¥çœ‹guavaå¦‚ä½•æ›¿ä½ è§£å†³è¿™ä¸ªå¤§éº»çƒ¦çš„ï¼š 1234567Multimap&lt;String, String&gt; multiMap = ArrayListMultimap.create();multiMap.put(&quot;hubert&quot;, &quot;man&quot;);multiMap.put(&quot;hubert&quot;, &quot;yes&quot;);multiMap.put(&quot;lucy&quot;, &quot;woman&quot;);System.out.println(multiMap.get(&quot;hubert&quot;)); //collection Multimap å‹æƒ…æç¤ºä¸‹ï¼Œguavaæ‰€æœ‰çš„é›†åˆéƒ½æœ‰createæ–¹æ³•ï¼Œè¿™æ ·çš„å¥½å¤„åœ¨äºç®€å•ï¼Œè€Œä¸”æˆ‘ä»¬ä¸å¿…åœ¨é‡å¤æ³›å‹ä¿¡æ¯äº†ã€‚ get()&#x2F;keys()&#x2F;keySet()&#x2F;values()&#x2F;entries()&#x2F;asMap()éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„è¿”å›view collectionçš„æ–¹æ³•ã€‚ Multimapçš„å®ç°ç±»æœ‰ï¼š ArrayListMultimap&#x2F;HashMultimap&#x2F;LinkedHashMultimap&#x2F;TreeMultimap&#x2F;ImmutableMultimap&#x2F;â€¦â€¦ å¯ä¸å¯ä»¥åŒå‘ï¼šBiMap JDKæä¾›çš„MAPè®©æˆ‘ä»¬å¯ä»¥find value by keyï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½é€šè¿‡find key by valueå‘¢ï¼Œèƒ½ä¸èƒ½KEYå’ŒVALUEéƒ½æ˜¯å”¯ä¸€çš„å‘¢ã€‚è¿™æ˜¯ä¸€ä¸ªåŒå‘çš„æ¦‚å¿µï¼Œå³forward+backwardã€‚ åœ¨å®é™…åœºæ™¯ä¸­æœ‰è¿™æ ·çš„éœ€æ±‚å—ï¼Ÿæ¯”å¦‚é€šè¿‡ç”¨æˆ·IDæ‰¾åˆ°mailï¼Œä¹Ÿéœ€è¦é€šè¿‡mailæ‰¾å›ç”¨æˆ·åã€‚æ²¡æœ‰guavaçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦create forward map AND create backward mapï¼Œand now just let guava do that for you. 12345678910111213BiMap&lt;String, String&gt; biMap = HashBiMap.create();biMap.put(&quot;name&quot;, &quot;hubert&quot;);// java.lang.IllegaArgumentException: value already present: hubert// value é‡å¤ä¼šæŠ¥é”™biMap.put(&quot;nick&quot;, &quot;hubert&quot;);// å¼ºåˆ¶è¦†ç›– name:hubertbiMap.forcePut(&quot;nick&quot;, &quot;hubert&quot;);biMap.put(&quot;123&quot;, &quot;hubertwongcn@163.com&quot;);System.out.println(biMap.inverse().get(&quot;hubertwongcn@163.com&quot;)); // 123 BiMap biMap &#x2F; biMap.inverse() &#x2F; biMap.inverse().inverse() å®ƒä»¬æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ ä½ å¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹BiMapçš„æºç å®ç°ï¼Œå®é™…ä¸Šï¼Œå½“ä½ åˆ›å»ºBiMapçš„æ—¶å€™ï¼Œåœ¨å†…éƒ¨ç»´æŠ¤äº†2ä¸ªmapï¼Œä¸€ä¸ªforward mapï¼Œä¸€ä¸ªbackward mapï¼Œå¹¶ä¸”è®¾ç½®äº†å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ å› æ­¤ï¼ŒbiMap.inverse() !&#x3D; biMap ï¼›biMap.inverse().inverse() &#x3D;&#x3D; biMap å¯ä¸å¯ä»¥å¤šä¸ªKEYï¼šTable æˆ‘ä»¬çŸ¥é“æ•°æ®åº“é™¤äº†ä¸»é”®å¤–ï¼Œè¿˜æä¾›äº†å¤åˆç´¢å¼•ï¼Œè€Œä¸”å®é™…ä¸­è¿™æ ·çš„å¤šçº§å…³ç³»æŸ¥æ‰¾ä¹Ÿæ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åµŒå¥—çš„Mapæ¥å®ç°ï¼šMap&lt;k1,Map&lt;k2,v2&gt;&gt;ã€‚ä¸ºäº†è®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥ä¸é‚£ä¹ˆä¸‘é™‹ï¼Œguavaä¸ºæˆ‘ä»¬æä¾›äº†Tableã€‚ 1234567Table&lt;String, String, Integer&gt; table = HashBaseTable.create();table.put(&quot;å¼ ä¸‰&quot;, &quot;è®¡ç®—æœº&quot;, 80);table.put(&quot;å¼ ä¸‰&quot;, &quot;æ•°å­¦&quot;, 90);table.put(&quot;å¼ ä¸‰&quot;, &quot;è¯­æ–‡&quot;, 70);table.put(&quot;æå››&quot;, &quot;è®¡ç®—æœº&quot;, 70);table.put(&quot;æå››&quot;, &quot;æ•°å­¦&quot;, 60);table.put(&quot;æå››&quot;, &quot;è¯­æ–‡&quot;, 100); Table Tableæ¶‰åŠåˆ°3ä¸ªæ¦‚å¿µï¼šrowKey,columnKey,valueï¼Œå¹¶æä¾›äº†å¤šç§è§†å›¾ä»¥åŠæ“ä½œæ–¹æ³•è®©ä½ æ›´åŠ è½»æ¾çš„å¤„ç†å¤šä¸ªKEYçš„åœºæ™¯ã€‚ å‡½æ•°å¼ç¼–ç¨‹ï¼šFunctions12345678910111213141516171819202122List&lt;String&gt; list = Lists.newArrayList(&quot;hello world&quot;, &quot;yes&quot;, &quot;hubert&quot;);Function&lt;String, String&gt; f1 = new Function&lt;String, String&gt;() &#123; @Override public String apply(String s) &#123; return s.length() &lt;= 5 ? s : s.substring(0, 5); &#125;&#125;;Function&lt;String, String&gt; f2 = new Function&lt;String, String&gt;() &#123; @Override public String apply(String s) &#123; return s.toUpperCase(); &#125;&#125;;Function&lt;String, String&gt; f3 = Functions.compose(f1, f2);Collection&lt;String&gt; collection = Collections2.transform(list, f3);for(String s : collection) &#123; System.out.println(s);&#125; Functions ä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†å®Œæˆå°†Listé›†åˆä¸­çš„å…ƒç´ ï¼Œå…ˆæˆªå–5ä¸ªé•¿åº¦ï¼Œç„¶åè½¬æˆå¤§å†™ã€‚ å‡½æ•°å¼ç¼–ç¨‹çš„å¥½å¤„åœ¨äºåœ¨é›†åˆéå†æ“ä½œä¸­æä¾›è‡ªå®šä¹‰Functionçš„æ“ä½œï¼Œæ¯”å¦‚transformè½¬æ¢ã€‚æˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦ä¸€ééçš„éå†é›†åˆï¼Œæ˜¾è‘—çš„ç®€åŒ–äº†ä»£ç ï¼ 12345678910Iterables.transform(Iterable, Function);Iterators.transform(Iterator, Function);Collections2.transform(Collection, Function);Lists.transform(List, Function);Maps.transformValues(Map, Function);Multimaps.transformValues(Multimap, Function);Multimaps.transformValues(ListMultimap, Funtion);Tables.transformValues(Table, Function);Maps.transformEntries(Map, EntryTransformer);// ... å¯¹é›†åˆçš„transformæ“ä½œå¯ä»¥é€šè¿‡Functionå®Œæˆ æ–­è¨€ï¼šPredicate12345678910111213List&lt;String&gt; list = Lists.newArrayList(&quot;moom&quot;, &quot;dad&quot;, &quot;refer&quot;, &quot;yes&quot;);Collection&lt;String&gt; collection = Collections2.filter(list, new Predicate&lt;String&gt;)) &#123; @Override public boolean apply(String s) &#123; // ä¸šåŠ¡é€»è¾‘ return new StringBuilder(s).reverse().toString().equals(s); &#125;&#125;;for(String s : collection) &#123; System.out.println(s);&#125; Predicateæœ€å¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯è¿ç”¨åœ¨é›†åˆçš„è¿‡æ»¤å½“ä¸­ï¼ 12345678Iterables.filter(Iterable, Predicate);Iterators.filter(Iterator, Predicate);Collectios2.filter(Collection, Predicate);Sets.filter(Set, Predicate);Sets.filter(SortedSet, Predicate);Maps.filterKeys(Map, Predicate);Multimaps.filterKeys(Multimap, Predicate);// ... filter éœ€è¦æ³¨æ„çš„æ˜¯Listså¹¶æ²¡æœ‰æä¾›filteræ–¹æ³•ï¼Œä¸è¿‡ä½ å¯ä»¥ä½¿ç”¨Collections2.filterå®Œæˆï¼ check null and otherï¼šOptionalã€Preconditionsåœ¨guavaä¸­ï¼Œå¯¹äºnullçš„å¤„ç†æ‰‹æ®µæ˜¯å¿«é€Ÿå¤±è´¥ï¼Œä½ å¯ä»¥çœ‹çœ‹guavaçš„æºç ï¼Œå¾ˆå¤šæ–¹æ³•çš„ç¬¬ä¸€è¡Œå°±æ˜¯ï¼šPreconditions.checkNotNull(elements); è¦çŸ¥é“nullæ˜¯æ¨¡ç³Šçš„æ¦‚å¿µï¼Œæ˜¯æˆåŠŸå‘¢ï¼Œè¿˜æ˜¯å¤±è´¥å‘¢ï¼Œè¿˜æ˜¯åˆ«çš„ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ 12345678910111213public static void test(String name, int age, Map&lt;String, String&gt; extInfo) &#123; Preconditions.checkNotNull(name, &quot;name must be given!&quot;); Preconditions.checkArgument(age &gt;= 18, &quot;the game you can not play it, your age is under 18!&quot;); Map&lt;String, String&gt; defaulExtInfo = Maps.newHashMap(); defaultExtInfo.put(&quot;sex&quot;, &quot;man&quot;); extInfo = Optional.fromNullable(extInfo).or(defaultExtInfo); for(Map.Entry&lt;String, Stirng&gt; entry : extInfo.entrySet())) &#123; System.out.println(entry.getKey() + &quot;:&quot; + entry.getValue()); &#125;&#125; Preconditions&#x2F;Optional Cache is king å¯¹äºå¤§å¤šæ•°äº’è”ç½‘é¡¹ç›®è€Œè¨€ï¼Œç¼“å­˜çš„é‡è¦æ€§ï¼Œä¸è¨€è€Œå–»ï¼ å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç³»ç»Ÿï¼Œå¹¶ä¸æƒ³ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹ç¼“å­˜ç»„ä»¶ï¼ˆå¦‚redisï¼‰ï¼Œæˆ‘ä»¬ä»…ä»…æƒ³åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªåŠŸèƒ½è¶³å¤Ÿå¼ºå¤§çš„ç¼“å­˜ï¼Œå¾ˆå¯æƒœJDKæä¾›çš„é‚£äº›SET&#x2F;MAPè¿˜ä¸è¡Œï¼ 12345678910111213141516171819202122232425// å®šä¹‰ç¼“å­˜çš„å®ç°private static final CacheLoader&lt;Long, User&gt; userCacheLoader = new CacheLoader&lt;Long, User&gt;() &#123; @Override public User load(Long along) throws Exception &#123; // æ¨¡æ‹Ÿä»æ•°æ®åº“/Redis/ç¼“å­˜ä¸­åŠ è½½æ•°æ® User user = new User(); user.setId(along); user.setName(Thread.currentThread().getName() + &quot;-&quot; new SimpleDateFormat(&quot;yyyy-MM-dd hh:mm:ss&quot;).format(new Date()) + &quot;-&quot; + along); System.out.println(&quot;load:&quot; + user); return user; &#125;&#125;;// å®šä¹‰ç¼“å­˜çš„ç­–ç•¥ï¼Œæä¾›å¯¹å¤–è®¿é—®ç¼“å­˜private static final LoadingCache&lt;Long, User&gt; userCacheData = CacheBuilder.newBuilder() .expireAfterAccess(2, TimeUnit.SECONDS) .expireAfterWrite(2, TimeUnit.SECONDS) .refreshAfterWrite(3, TimeUnit.SECONS) .maximumSize(10000L) .bulid(userCacheLoader); CacheLoader é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ä¸ªæœ¬åœ°ç¼“å­˜ï¼Œguavaæä¾›çš„cacheæ˜¯ä¸€ä¸ªç®€æ´ã€é«˜æ•ˆï¼Œæ˜“äºç»´æŠ¤çš„ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºå¹¶æ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç”¨äºåˆ·æ–° OR æ¸…ç†cacheï¼Œå¯¹äºcacheçš„æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡è®¿é—®&#x2F;è¯»å†™å¸¦æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¯»å†™ä¸­å®Œæˆç¼“å­˜çš„åˆ·æ–°æ“ä½œï¼ å…¶æ¬¡ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ï¼Œæˆ‘ä»¬éå¸¸é€šä¿—çš„å‘Šè¯‰cacheï¼Œæˆ‘ä»¬çš„ç¼“å­˜ç­–ç•¥æ˜¯ä»€ä¹ˆï¼ŒSO EASYï¼åœ¨å¦‚æ­¤ç®€å•çš„èƒŒåï¼Œæ˜¯guavaå¸®åŠ©æˆ‘ä»¬åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚çº¿ç¨‹å®‰å…¨ã€‚ è®©å¼‚æ­¥å›è°ƒæ›´åŠ ç®€å• JDKä¸­æä¾›äº†Future&#x2F;FutureTask&#x2F;Callableæ¥å¯¹å¼‚æ­¥å›è°ƒè¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯è¿˜æ˜¯çœ‹ä¸Šå»æŒºå¤æ‚çš„ï¼Œèƒ½ä¸èƒ½æ›´åŠ ç®€å•å‘¢ï¼Ÿæ¯”å¦‚æ³¨å†Œä¸€ä¸ªç›‘å¬å›è°ƒã€‚ 12345678910111213141516171819202122232425262728// JDK æ‰€æä¾›çš„çº¿ç¨‹æ± ExecutorService es = Executors.newFixedThreadPool(3);// ç»è¿‡guavaå°è£…çš„å¸¦æœ‰ç›‘å¬å›è°ƒåŠŸèƒ½çš„çº¿ç¨‹æ± ListeningExecutorService listeningExecutorService = MoreExecutors.listeningDecorator(es);ListenableFuture listenableFuture = listeningExecutorService.submit(new Callable&lt;Integer&gt;() &#123; @Override public Integer call() throws Exception &#123; if (new Random().nextInt(3) == 2) &#123; throw new NullPointerException(); &#125; return 1; &#125;&#125;);FutureCallback futureCallback = new FutureCallback&lt;Integer&gt; &#123; @Override public void onSuccess(final Integer o) &#123; System.out.println(&quot;------&quot; + o); &#125; @Override public void onFailure(final Throwable throwable) &#123; System.out.println(&quot;======&quot; + throwable.getMessage()); &#125;&#125;;Futures.addCallback(listenableFuture, futureCallback); å¼‚æ­¥å›è°ƒ æˆ‘ä»¬å¯ä»¥é€šè¿‡guavaå¯¹JDKæä¾›çš„çº¿ç¨‹æ± è¿›è¡Œè£…é¥°ï¼Œè®©å…¶å…·æœ‰å¼‚æ­¥å›è°ƒç›‘å¬åŠŸèƒ½ï¼Œç„¶ååœ¨è®¾ç½®ç›‘å¬å™¨å³å¯ï¼ Summaryåˆ°è¿™é‡Œï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿåªä»‹ç»äº†guavaçš„å†°å±±ä¸€è§’ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šå†…å®¹ï¼š guava package æ¯”å¦‚åå°„ã€æ³¨è§£ã€ç½‘ç»œã€å¹¶å‘ã€IOç­‰ç­‰","tags":["å·¥å…·","å¼€æº","Google"],"categories":["å·¥å…·"]}]